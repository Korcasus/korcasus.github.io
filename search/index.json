[{"content":"Introduction Kubernetesì—ì„œëŠ” Batchì„±ê²©ì˜ Applicationë“¤ì„ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nJob, CronJobì´ë¼ëŠ” í˜•íƒœë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì‹¤í–‰ì´ë ¥ì„ ê´€ë¦¬í•˜ê±°ë‚˜, ì—¬ëŸ¬ jobë“¤ì˜ ì˜ì¡´ì„±ì„ ì„¤ì •í•˜ì—¬ ì‹¤í–‰í•˜ê¸°ì—ëŠ” ê¸°ëŠ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. Argo Workflowì™€ Argo Eventê°€ ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì„ ì¶©ë¶„íˆ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´, ì„¤ì¹˜í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\nInstall Argo-Event ì¶”í›„ ì‚¬ìš©ì„ ê³ ë ¤í•´ì„œ, namespaceë‹¨ìœ„ ì„¤ì¹˜ê°€ ì•„ë‹Œ cluster-wideë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.\nnamespace ìƒì„± 1 kubectl create namespace argo-events Deploy Argo Events, SA, ClusterRoles, Sensor Controller, EventBus Controller and EventSource Controller. 1 2 3 kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-events/stable/manifests/install.yaml # Install with a validating admission controller kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-events/stable/manifests/install-validating-webhook.yaml Deploy Eventbus 1 kubectl apply -n argo-events -f https://raw.githubusercontent.com/argoproj/argo-events/stable/examples/eventbus/native.yaml Argo-workflow Controller And Server 1 2 kubectl create namespace argo kubectl apply -n argo -f https://github.com/argoproj/argo-workflows/releases/download/v3.3.0/install.yaml getting-startedë¥¼ ë³´ê³  ì„¤ì¹˜ë¥¼ ì§„í–‰í•˜ê²Œë˜ë©´, namespaceì— í•œì •ë˜ì–´ ì„¤ì¹˜ë©ë‹ˆë‹¤.\nì´ëŠ” argo-event ì‚¬ìš© ë¶ˆí¸ì„ ì´ˆë˜í•˜ê¸°ì—, íŠ¹ë³„í•œ ì´ìœ ê°€ ì—†ë‹¤ë©´ cluster-wideë¡œ ì„¤ì¹˜í•˜ëŠ”ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.\nInstall CLI 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Download the binary curl -sLO https://github.com/argoproj/argo-workflows/releases/download/v3.3.0/argo-darwin-amd64.gz # Unzip gunzip argo-darwin-amd64.gz # Make binary executable chmod +x argo-darwin-amd64 # Move binary to path mv ./argo-darwin-amd64 /usr/local/bin/argo # Test installation argo version Port-Forwarding (local) 1 kubectl -n argo port-forward deployment/argo-server 2746:2746 Remote Clusterë¥¼ ì‚¬ìš©í• ê²½ìš° ë§í¬ë¥¼ ë³´ê³  Routing ì„¤ì •ì„ í•´ì£¼ë©´ ë©ë‹ˆë‹¤. Localì—ì„œëŠ” Load Balanceríƒ€ì…ìœ¼ë¡œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤.\nAuthorization ë§í¬ ë°©ë²•ì„ ì‘ìš©í•´ì„œ ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ tokenì„ íšë“í›„, ë¡œê·¸ì¸ì— ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\nConcept Architecture Event Source ì™¸ë¶€ì—ì„œ ì˜¤ëŠ” ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ê¸°ìœ„í•œ Resourceì…ë‹ˆë‹¤.\nSensor ì„¼ì„œëŠ” Event Dependency Setì„ Inputìœ¼ë¡œ, TriggerëŠ” Output ì •ì˜í•©ë‹ˆë‹¤. EventBusë¥¼ í†µí•´ì„œ Eventë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” Event Dependency Managerë¡œì„œ í–‰ë™í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Triggerë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.\nEventbus EventSourcesì™€ Sensorë¥¼ ì—°ê²°í•´ì£¼ëŠ” TransportLayerë¡œì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤.\nEventSourcesê°€ Eventë¥¼ Publishí•˜ëŠ”ë°˜ë©´, SensorëŠ” Eventë¥¼ Subscribeí•˜ì—¬ Triggerë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.\nTrigger Sensorì— ì˜í•´ì„œ í•œë²ˆ Event Dependenciesê°€ í•´ê²°ë˜ë©´, ì‹¤í–‰ë˜ëŠ” Resource/Workloadë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.\ní…ŒìŠ¤íŠ¸í•œ ê¸°ëŠ¥ calendar webhook-workflow webhook-k8s-object cross-namespace webhook-auth RBAC ì„¤ì • argo-workflowì™€ argo-eventsë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ì „ì œí•˜ì— ì„¤ëª…í•©ë‹ˆë‹¤.\nargo-workflowì—ì„œ ì‹¤í–‰í•œ pod ìƒíƒœ, ë¡œê·¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ê¶Œí•œì„ ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: workflow-role namespace: argo-events rules: - apiGroups: - \u0026#34;\u0026#34; resources: - pods verbs: - get - watch - patch - apiGroups: - \u0026#34;\u0026#34; resources: - pods/log verbs: - get - watch --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: workflow-role-binding roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: workflow-role subjects: - kind: ServiceAccount name: default Argo Eventsì—ì„œ Triggerë¡œì„œ Argo-Workflowë¥¼ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´ í•„ìš”í•œ ì„¤ì •ì…ë‹ˆë‹¤.\nTriggerë¡œ ìƒì„±ë˜ëŠ” ê°ì²´ê°€ Workflowì´ê¸° ë•Œë¬¸ì—, í•´ë‹¹ íƒ€ì…ì˜ api-resourceë¥¼ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 apiVersion: v1 kind: ServiceAccount metadata: name: operate-workflow-sa namespace: argo-events --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: operate-workflow-role namespace: argo-events rules: - apiGroups: - argoproj.io verbs: - \u0026#34;*\u0026#34; resources: - workflows - workflowtemplates - cronworkflows - clusterworkflowtemplates --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: operate-workflow-role-binding roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: operate-workflow-role subjects: - kind: ServiceAccount name: operate-workflow-sa webhook-workflow Webhookì„ EventSourceë¡œ ì‚¬ìš©í•˜ë©°, SensorëŠ” argo-workflowë¥¼ Triggerë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ì— ë”°ë¼, ë™ì‘ì„ ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” argo-workflow cluster wideë¡œ ì‚¬ì „ ì„¤ì¹˜ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: webhook spec: service: ports: - port: 12000 targetPort: 12000 webhook: example: port: \u0026#34;12000\u0026#34; endpoint: /example method: POST 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: webhook spec: template: serviceAccountName: operate-workflow-sa dependencies: - name: test-dep eventSourceName: webhook eventName: example triggers: - template: name: webhook-workflow-trigger k8s: operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: webhook- spec: entrypoint: whalesay arguments: parameters: - name: message value: hello world templates: - name: whalesay inputs: parameters: - name: message container: image: docker/whalesay:latest command: [cowsay] args: [\u0026#34;{{inputs.parameters.message}}\u0026#34;] parameters: - src: dependencyName: test-dep dataKey: body dest: spec.arguments.parameters.0.value calendar Timer, CronJobì„ ëª¨ë‘ êµ¬ë™ì‹œí‚¬ìˆ˜ ìˆëŠ” í˜•íƒœì˜ EventSourceì…ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: calendar spec: calendar: example-with-interval: interval: 10s # schedule: \u0026#34;30 * * * *\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: calendar spec: template: serviceAccountName: operate-workflow-sa dependencies: - name: test-dep eventSourceName: calendar eventName: example-with-interval triggers: - template: name: calendar-workflow-trigger k8s: operation: create source: resource: apiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: calendar-workflow- spec: entrypoint: whalesay arguments: parameters: - name: message value: hello world templates: - name: whalesay inputs: parameters: - name: message container: image: docker/whalesay:latest command: [cowsay] args: [\u0026#34;{{inputs.parameters.message}}\u0026#34;] parameters: - src: dependencyName: test-dep dataKey: eventTime dest: spec.arguments.parameters.0.value retryStrategy: steps: 3 webhook-k8s-object Webhook-Workflowì™€ ìœ ì‚¬í•©ë‹ˆë‹¤. ë‹¤ë¥¸ì ì€ Sensorì—ì„œ Triggerí•˜ëŠ” ëŒ€ìƒì´ k8s object ë¼ëŠ” ì ì…ë‹ˆë‹¤.\nPod, Deployment, Job, CronJobì™€ ê°™ì€ Custom Resourcesë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê°€ëŠ¥í•œ ë™ì‘ì€ Create, Update, Patch, Deleteì…ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: k8s-webhook spec: service: ports: - port: 12000 targetPort: 12000 webhook: example: port: \u0026#34;12000\u0026#34; endpoint: /example method: POST 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: k8s-webhook spec: template: serviceAccountName: operate-k8s-sa dependencies: - name: test-dep eventSourceName: k8s-webhook eventName: example triggers: - template: name: webhook-pod-trigger k8s: operation: create source: resource: apiVersion: v1 kind: Pod metadata: generateName: hello-world- spec: containers: - name: hello-container args: - \u0026#34;hello-world\u0026#34; command: - cowsay image: \u0026#34;docker/whalesay:latest\u0026#34; parameters: - src: dependencyName: test-dep dataKey: body dest: spec.containers.0.args.0 Kubernetes Objectë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì¶”ê°€ì ì¸ RBACê°€ í•„ìš”í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 apiVersion: v1 kind: ServiceAccount metadata: name: operate-k8s-sa namespace: argo-events --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: operate-k8s-role namespace: argo-events rules: - apiGroups: - \u0026#34;\u0026#34; verbs: - \u0026#34;*\u0026#34; resources: - pods --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: operate-k8s-role-binding roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: operate-k8s-role subjects: - kind: ServiceAccount name: operate-k8s-sa cross-namespace ì§€ê¸ˆê¹Œì§€ ì‚¬ìš©í•œ RBACëŠ” namespace í•œì •í•´ì„œ ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì‚¬ìš©ìë“¤ì´ ëª¨ë‘ ì‚¬ìš©ë²•ì„ ì•Œì•„ì•¼ í•˜ëŠ” ë‹¨ì ì´ ìˆì–´, ì‚¬ìš©ìë¡œì„œëŠ” ë¶ˆí¸í•  ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.\nCross-Namespaceë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ê¸°ì¡´ì— Roleë¡œ ì •ì˜ë˜ì–´ìˆë˜ ë‚´ìš©ë“¤ì„ ëª¨ë‘ ClusteRoleìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 apiVersion: v1 kind: ServiceAccount metadata: name: operate-k8s-cluster-sa namespace: argo-events --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: operate-k8s-clusterrole namespace: argo-events rules: - apiGroups: - \u0026#34;\u0026#34; verbs: - \u0026#34;*\u0026#34; resources: - pods --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: operate-k8s-clusterrole-binding namespace: argo-events roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: operate-k8s-clusterrole subjects: - kind: ServiceAccount name: operate-k8s-cluster-sa namespace: argo-events ì˜ˆì œë¡œ ì²¨ë¶€í•œ ClusterRoleì€ podë§Œ ìƒì„±ê°€ëŠ¥í•œë°, í•„ìš”í•  ê²½ìš° ë‹¤ë¥¸ Resourceë¥¼ ì¶”ê°€í•œë’¤ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\nwebhook-auth ë³´ì•ˆìƒì˜ ë¬¸ì œë¡œ Webhookì„ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œ ì¸ì¦ í† í°ì„ ì¶”ê°€í•´ì•¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ ë°©ë²•ì€ ì¸ì¦ìš© í† í°ì„ ìƒì„±í•œë’¤, k8s objectì¸ Secretìœ¼ë¡œ ë“±ë¡ í›„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\nSecret ê°ì²´ ì´ë¦„ì„ ì§€ì •í•´ì£¼ë©´ Webhookì—ì„œ ì¸ì¦ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 echo -n \u0026#39;af3qqs321f2ddwf1e2e67dfda3fs\u0026#39; \u0026gt; ./token.txt kubectl create secret generic my-webhook-token --from-file=my-token=./token.txt 1 2 3 4 5 6 7 8 9 10 11 12 13 apiVersion: argoproj.io/v1alpha1 kind: EventSource metadata: name: secret-webhook spec: webhook: example: port: \u0026#34;12000\u0026#34; endpoint: /example method: POST authSecret: name: my-webhook-token key: my-token 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 apiVersion: argoproj.io/v1alpha1 kind: Sensor metadata: name: k8s-webhook spec: template: serviceAccountName: operate-k8s-sa dependencies: - name: test-dep eventSourceName: secret-webhook eventName: example triggers: - template: name: webhook-pod-trigger k8s: operation: create source: resource: apiVersion: v1 kind: Pod metadata: generateName: hello-world- spec: containers: - name: hello-container args: - \u0026#34;hello-world\u0026#34; command: - cowsay image: \u0026#34;docker/whalesay:latest\u0026#34; parameters: - src: dependencyName: test-dep dataKey: body dest: spec.containers.0.args.0 Summary í…ŒìŠ¤íŠ¸ í•œ ë‚´ìš©ë“¤ì„ ë³´ì‹œë©´, ìš´ì˜ì ì¸ ìš”ì†Œë³´ë‹¤ëŠ” ê¸°ëŠ¥ì ì¸ ìš”ì†Œë¡œì„œ ì§€ì›ì—¬ë¶€ë¥¼ ìœ„ì£¼ë¡œ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.\nBatchë¥¼ ì‚¬ìš©í•˜ê¸°ìœ„í•´ í•„ìš”í•œ Resourceë“¤ì´ ëª¨ë‘ yamlë¡œ ì •ì˜ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, GitOpsë¡œ ìš´ì˜ì´ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  Argo Eventì—ì„œ ë‹¤ì–‘í•œ Event Sourceë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì—, Webhookê³¼ Cronì„ í•„ìš”í•œ ë§Œí¼ ì¶©ë¶„íˆ ì‚¬ìš©ê°€ëŠ¥ í•œ ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.\në‹¤ìŒ ê¸€ì—ì„œëŠ” ìš´ì˜ì ì¸ ìš”ì†Œì—ì„œ í•„ìš”í•œ Needsì™€ ê·¸ê²ƒë“¤ì„ í™•ì¸í•´ ë‚˜ê°„ ê³¼ì •ì— ëŒ€í•´ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.\n","date":"2023-09-10T16:46:32+09:00","permalink":"https://korcasus.github.io/p/argo-events-getting-start/","title":"Argo Events Getting Start"},{"content":"Introduction Synologyì— Docker Registryë¥¼ Containerë¡œ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.\nê°œì¸ ìš©ë„ë¡œ ë§Œë“  ì´ë¯¸ì§€ë¥¼ ììœ ë¡­ê²Œ ì €ì¥í•  ìˆ˜ ìˆê²Œ ë˜ì–´ í¸í•˜ê²Œ ì‚¬ìš©í•˜ê³ ìˆì—ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì–´ë–¤ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³ ìˆëŠ”ì§€, tagê°€ ì–´ë–¤ê²Œ ìˆëŠ”ì§€ë¥¼ ë³´ê¸°ê°€ ì–´ë µë”ë¼êµ¬ìš”.\në¬¼ë¡  APIë¥¼ ì‚¬ìš©í•´ì„œ ì¡°íšŒí•˜ë©´ ë³¼ìˆ˜ì•¼ ìˆê² ì§€ë§Œ, ì €ì—ê²ŒëŠ” ë¶ˆí¸í•˜ê²Œ ë‹¤ê°€ì™”ìŠµë‹ˆë‹¤.\nê·¸ë˜ì„œ WebUIë¥¼ ì„¤ì¹˜í•˜ëŠ” ë°©ì•ˆì„ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.\nCandidate ê²€ìƒ‰í•´ë³´ê¸°ë„ í•˜ê³ , ì°¸ê³ í–ˆì„ë•Œ, ì•„ë˜ì˜ 2ê°œê°€ ì í•©í•´ë³´ì˜€ìŠµë‹ˆë‹¤.\nhttps://github.com/Joxit/docker-registry-ui https://github.com/goharbor/harbor harborëŠ” ê¸°ëŠ¥ì´ í’ë¶€í•˜ê³  CNCFë¡œ ê´€ë¦¬ë˜ë‹¤ë³´ë‹ˆ, ë” ì¢‹ê¸´í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ Registryë¥¼ ì´ë¯¸ ì„¤ì¹˜í•´ë‘ì—ˆê³ , web-uië§Œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ê±°ë¼ Joxit docker regisry uiê°€ ë‚«ê² ë‹¤ ìƒê°í–ˆìŠµë‹ˆë‹¤.\nInstall ë‚´ë¶€ë§ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œë” ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.\nì™¸ë¶€ë§ì—ì„œëŠ” ë‹¤ë¥¸ ì„¤ì •ì´ ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë©°, ë³´ì•ˆì´ ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ë•ŒëŠ” harborë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ë” ë‚˜ì„ê²ë‹ˆë‹¤.)\nê³µì‹ë¬¸ì„œì—ì„œëŠ” Recommended Docker Registry Configurationì„ ì•ˆë‚´í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.\nì´ëŒ€ë¡œ í•˜ë©´ ì¢‹ê² ì§€ë§Œ, ì œê°€ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì— ë§ê²Œ ì¶”ê°€ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼í–ˆê¸° ë•Œë¬¸ì— ì°¸ê³ ë§Œ í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ëª©ë¡ì€ ê³ ë ¤í•´ì•¼í–ˆë˜ ì‚¬í•­ë“¤ ì…ë‹ˆë‹¤.\nì„¤ì¹˜í•´ë‘” RegistryëŠ” ë¶„ì‚°ì„¤ì¹˜ ëœê²Œ ì•„ë‹ˆë©°, NAS í•˜ë‚˜ì—ë§Œ ì„¤ì¹˜ë˜ì–´ìˆë‹¤. RegistryëŠ” ë³´ì•ˆì„¤ì •ì„ í•´ë‘ì—ˆë‹¤. Web-uiì—ì„œ ì´ë¯¸ì§€ ì‚­ì œê°€ ê°€ëŠ¥í•´ì•¼í•œë‹¤. Imageì˜ ìƒì„¸ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆì–´ì•¼í•œë‹¤. ë‚´ë¶€ë§ì—ì„œ ì‚¬ìš©í•˜ëŠ” hostëª…ì´ ë³„ë„ë¡œ ìˆë‹¤.(CORSì„¤ì •) ìœ„ ì‚¬í•­ë“¤ì„ ê³ ë ¤í–ˆì„ë•Œ, ì•„ë˜ì˜ ì„¤ì •ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼í–ˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 web-ui: SINGLE_REGISTRY: true REGISTRY_SECURED: true DELETE_IMAGES: true SHOW_CONTENT_DIGEST: true REGISTRY_URL: \u0026#34;http://xxxxx:1234\u0026#34; registry: REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: \u0026#39;[http://xxxxx:1234]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: \u0026#39;[HEAD,GET,OPTIONS,DELETE]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials: \u0026#39;[true]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: \u0026#39;[Authorization,Accept,Cache-Control]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers: \u0026#39;[Docker-Content-Digest]\u0026#39; ì—¬ê¸°ê¹Œì§€ ì„¤ì •í•˜ë‹ˆ, íŠ¹ë³„íˆ ë¬¸ì œì—†ì´ web-uiê°€ ë¬¸ì œì—†ê¸° ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\nì •ìƒ ë™ì‘í•˜ëŠ”ì§€ ë“¤ì–´ê°€ë³´ë‹ˆ, ë©”ì¸ í˜ì´ì§€ëŠ” Image ë¦¬ìŠ¤íŠ¸ë¥¼ ì˜ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ë¯¸ì§€ ìƒì„¸ì •ë³´ í˜ì´ì§€ì— ë“¤ì–´ê°€ë‹ˆ, CORS ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.\nCORS TroubleShooting Consoleì— ì¶œë ¥ë˜ëŠ” ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë³´ë‹ˆ, Preflightê°€ ì›¹ ë¸Œë¼ìš°ì €ì— ì˜í•´ ê±°ì ˆë˜ì–´ ì‹¤íŒ¨í•˜ë˜ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.\nìƒê°í•´ë³¼ ìˆ˜ ìˆëŠ” ì›ì¸ì€ CORSì˜€ëŠ”ë°, ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆë‹¤ë©´ ë©”ì¸í˜ì´ì§€ì—ì„œë„ ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼ í–ˆì—ˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì›ì¸ì´ ìˆì„ ìˆ˜ ìˆê² ë‹¤ ì‹¶ì–´, ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•´ë³´ë‹ˆ FAQì— ë“±ë¡ë˜ì–´ìˆì—ˆìŠµë‹ˆë‹¤.\n1 2 3 Why OPTIONS (aka preflight requests) and DELETE fails with 401 status code (using Basic Auth) ? This is caused by a bug in docker registry, it returns 401 status requests on preflight requests, this breaks W3C preflight-request specification. I suggest to have your UI on the same domain than your registry e.g. registry.example.com/ui/ or use NGINX_PROXY_PASS_URL or configure a nginx/apache/haproxy in front of your registry that returns 200 on each OPTIONS requests. (see #104, #204, #207, #214, #266). 3ê°€ì§€ ë°©ë²•ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë¼ê³  ì•Œë ¤ì£¼ê³  ìˆìŠµë‹ˆë‹¤.\nweb-uiì˜ domainì„ registryì™€ ë™ì¼í•˜ê²Œ í•œë‹¤. NGINX_PROXY_PASS_URLì„ ì„¤ì •í•œë‹¤. nginxì— OPTIONS methodì— 200ì‘ë‹µì„ ë³´ë‚¸ë‹¤. 2ë²ˆì´ ê°€ì¥ ê°„ë‹¨í•˜ê¸°ë„ í•˜ê³ , ë‹¤ë¥¸ ë°©ë²•ì— ë¹„í•´ ê°€ì¥ ë‚˜ì„ ì„ íƒì§€ë¡œ ë³´ì—¬ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.\nì„¤ì •ì€ ì•„ë˜ì²˜ëŸ¼ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 web-ui: SINGLE_REGISTRY: true REGISTRY_SECURED: true DELETE_IMAGES: true SHOW_CONTENT_DIGEST: true NGINX_PROXY_PASS_URL: \u0026#34;http://xxxxx:1234\u0026#34; registry: REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: \u0026#39;[http://xxxxx:1234]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: \u0026#39;[HEAD,GET,OPTIONS,DELETE]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials: \u0026#39;[true]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: \u0026#39;[Authorization,Accept,Cache-Control]\u0026#39; REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers: \u0026#39;[Docker-Content-Digest]\u0026#39; ì´ë ‡ê²Œí•˜ë‹ˆ ë” ì´ìƒì˜ CORS ë¬¸ì œê°€ ë°œìƒí•˜ì§€ì•Šê³ , ì •ìƒë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.\nConclusion NASì— ê°œì¸ìš©ë„ë¡œ ì‚¬ìš©í•  registry web-uië¥¼ ì„¤ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.\nê°„ë‹¨í•˜ê²Œ Registryì— ì €ì¥ëœ ë„ì»¤ì´ë¯¸ì§€ë¥¼ ê´€ë¦¬í•˜ê¸°ì—ëŠ” ì¶©ë¶„í•´ ë³´ì…ë‹ˆë‹¤.\nì €ì²˜ëŸ¼ ì‚¬ì ìœ¼ë¡œ Registryì— ì €ì¥í•´ë‘” ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ê´€ë¦¬í•  ë‹ˆì¦ˆê°€ ìˆìœ¼ì‹  ë¶„ë“¤ì—ê²ŒëŠ” ì¶”ì²œ ë“œë¦½ë‹ˆë‹¤.\n","date":"2023-09-03T21:42:24+09:00","permalink":"https://korcasus.github.io/p/install-docker-registry-ui/","title":"Install Docker Registry Ui for Synology"},{"content":"Introduction Synologyì—ì„œ ì—¬ëŸ¬ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ Dockerë¥¼ ì• ìš©í•©ë‹ˆë‹¤.\nDockerë¡œ Jenkins ë¥¼ ì‚¬ìš©ì¤‘ì¸ë°, Jenkinsì—ì„œë„ Dockerë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ìƒê²¨ ì§„í–‰í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nSynologyê°€ ì•„ë‹Œ ë‹¤ë¥¸ Machineì—ì„œë„ ë¹„ìŠ·í•˜ê²Œ ì§„í–‰ë˜ì§€ë§Œ, ì´ë²ˆ ì„¤ëª…ì€ Synologyë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nì„¤ëª…í•œ ë°©ë²•ì€ Hostì˜ docker sockì„ ê³µìœ í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.\nPrerequisite Jenkins Container Using Official Image Progress ìƒê°ë³´ë‹¤ ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤. ì°¨ê·¼ì°¨ê·¼íˆ ì§„í–‰í•˜ë©´ ì‰½ìŠµë‹ˆë‹¤.\nDSM 7.2ë¡œ ì—…ë°ì´íŠ¸í•œ í›„ì— ì§„í–‰í•œ ì‘ì—…ì´ë¼, ìº¡ì²˜í•œ ì´ë¯¸ì§€ê°€ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1. Docker sock ê³µìœ  Synologyì— ì„¤ì¹˜í•´ì¤€ Docker sockê³¼ containerì—ì„œ ì‚¬ìš©í•  Docker sockì„ binding í•˜ëŠ” ì‘ì—…ì„ í•´ì•¼í•©ë‹ˆë‹¤. ì•„ë˜ì˜ ëª…ë ¹ì–´ëŒ€ë¡œ ì„¤ì •í•´ ì£¼ë©´ ë©ë‹ˆë‹¤.\n1 2 3 4 docker run -p ${webPort}:8080 -p ${agentPort}:50000 -d -v /var/run/docker.sock:/var/run/docker.sock -v ${hostJenkinsDir}:/var/jenkins_home jenkins/jenkins:lts # ì˜ˆì‹œë¡œ ë“¤ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. docker run -p 8080:8080 -p 50000:50000 -d -v /var/run/docker.sock:/var/run/docker.sock -v /docker/jenkins/home:/var/jenkins_home jenkins/jenkins:lts í•˜ì§€ë§Œ Synologyì—ì„œëŠ” / directory ì„¤ì •í•  ìˆ˜ ì—†ê¸°ë–„ë¬¸ì—, SSHë¡œ ì ‘ì†í•´ì„œ ì„¤ì •í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nSSHë¡œ ì ‘ì†í•´ì„œ Docker commandë¥¼ ì‚¬ìš©í•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” ìœ„ì˜ ì´ë¯¸ì§€ì²˜ëŸ¼ containerì˜ volumeì„ updateí•  ìˆ˜ ìˆëŠ” ì„¤ì •ì´ ìˆìŠµë‹ˆë‹¤.\nê·¸ë˜ì„œ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ volume binding í•˜ì˜€ìŠµë‹ˆë‹¤.\n1 docker container update -v /var/run/docker.sock:/var/run/docker.sock -v /docker/jenkins/home:/var/jenkins_home ${containerId} ì´ë ‡ê²Œ ë³€ê²½í•œ volume bindingì€ synology web uiìƒì—ì„œëŠ” ë³´ì´ì§€ ì•Šê¸° ë•Œë¬¸ì—, ëª…ë ¹ì–´ë¥¼ í†µí•´ ì˜ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 docker container inspect ${containerId} { ..., \u0026#34;Mounts\u0026#34;: [ { \u0026#34;Type\u0026#34;: \u0026#34;bind\u0026#34;, \u0026#34;Source\u0026#34;: \u0026#34;/volume1/docker/jenkins/home\u0026#34;, \u0026#34;Destination\u0026#34;: \u0026#34;/var/jenkins_home\u0026#34;, \u0026#34;Mode\u0026#34;: \u0026#34;rw\u0026#34;, \u0026#34;RW\u0026#34;: true, \u0026#34;Propagation\u0026#34;: \u0026#34;rprivate\u0026#34; }, { \u0026#34;Type\u0026#34;: \u0026#34;bind\u0026#34;, \u0026#34;Source\u0026#34;: \u0026#34;/var/run/docker.sock\u0026#34;, \u0026#34;Destination\u0026#34;: \u0026#34;/var/run/docker.sock\u0026#34;, \u0026#34;Mode\u0026#34;: \u0026#34;rw\u0026#34;, \u0026#34;RW\u0026#34;: true, \u0026#34;Propagation\u0026#34;: \u0026#34;rprivate\u0026#34; } ], ... } ìœ„ì²˜ëŸ¼ docker.sockì´ ì¶”ê°€ë˜ì—ˆë‹¤ë©´, ì •ìƒì ìœ¼ë¡œ ëœ ê²ƒì…ë‹ˆë‹¤.\ní˜¹ì‹œ docker container update ëª…ë ¹ì–´ë¥¼ í†µí•´ volume bindingì„ í•  ìˆ˜ ì—†ë‹¤ë©´, ìƒˆë¡œ containerë¥¼ ë§Œë“œëŠ”ê²ƒì´ í¸í•˜ê² ìŠµë‹ˆë‹¤.\nì§ì ‘ í•˜ì§„ì•Šì•˜ì§€ë§Œ ì•„ë˜ì˜ ëª…ë ¹ì–´ì²˜ëŸ¼ ì…ë ¥í•˜ë©´ ë˜ì§€ì•Šì„ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.\n1 2 3 4 docker run --restart ${policy} --name ${jenkins} -p ${webPort}:8080 -p ${agentPort}:50000 -d -v /var/run/docker.sock:/var/run/docker.sock -v ${hostJenkinsDir}:/var/jenkins_home jenkins/jenkins:lts # ì˜ˆì‹œë¡œ ë“¤ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. docker run --restart always --name jenkins -p 8080:8080 -p 50000:50000 -d -v /var/run/docker.sock:/var/run/docker.sock -v /docker/jenkins/home:/var/jenkins_home jenkins/jenkins:lts í•­ìƒ ì¬ì‹œì‘ í•˜ëŠ” ì˜µì…˜ì„ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.\në³¸ì¸ì˜ í•„ìš”ì— ë”°ë¼ ì„¤ì •í•´ì£¼ì„¸ìš”.\n2. Jenkinsì— Docker ì„¤ì¹˜ Dockerfileì„ ìƒˆë¡œ ë§Œë“¤ì–´, Dockerë¥¼ ì„¤ì¹˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìƒˆë¡œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ê´€ë¦¬í•˜ëŠ”ê±´ ë²ˆê±°ë¡­ê¸°ë„í•˜ê³ , volume bindingì„ í•´ì„œ ë°ì´í„°ê°€ ìœ ì§€ë˜ëŠ” ìƒí™©ì´ë‹ˆ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì €ì¥í•´ë‘ëŠ”ê²Œ ì¢‹ë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\n(Jenkinsë¥¼ ì—…ê·¸ë ˆì´ë“œí•˜ê±°ë‚˜ Containerê°€ ì‚­ì œëœë‹¤ë©´, ì„¤ì¹˜ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒˆë¡œ ì‹¤í–‰í•´ì£¼ê¸´ í•´ì•¼í•˜ì§€ë§Œìš”.)\nì•„ë˜ì˜ ë‚´ìš©ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ hostì˜ /docker/jenkins/home/install_jenkins.shë¡œ ë§Œë“¤ì–´ ì£¼ì—ˆìŠµë‹ˆë‹¤.\n1 2 3 #!/bin/bash curl https://get.docker.com/ \u0026gt; dockerinstall \u0026amp;\u0026amp; chmod 777 dockerinstall \u0026amp;\u0026amp; ./dockerinstall chmod 666 /var/run/docker.sock ì„¤ì¹˜í•˜ëŠ”ë° ì¡°ê¸ˆ ì‹œê°„ì´ ê±¸ë¦¬ê¸´í•©ë‹ˆë‹¤. ê¸°ë‹¤ë¦¬ë©´, ì„¤ì¹˜ê°€ ì™„ë£Œëœê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n3. ë™ì‘ í™•ì¸ Jenkins Containerì™€ Web UIì—ì„œ Docker commandê°€ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. ìš°ì„ ì€ Containerì—ì„œ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 docker exec -it ${containerId} /bin/bash # ì˜ˆì‹œ docker exec -it f0f5398c9a62 /bin/bash --- docker container ls --all ìœ„ì˜ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•˜ë©´ Containerì— ì ‘ì†í•˜ì˜€ê³ , ì‹œë†€ë¡œì§€ì—ì„œ êµ¬ë™ì¤‘ì¸ Container ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤. êµ¬ë™ì¤‘ì¸ Containerê°€ ì—†ì„ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ì—ëŸ¬ëŠ” ë°œìƒí•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤.\nìœ„ì—ê¹Œì§€ë§Œ í™•ì¸í•´ë„ ë¬¸ì œëŠ” ì—†ì„í…ë°, ì €ëŠ” í˜¹ì‹œë‚˜ ì‹¶ì–´ ë” í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\nì•„ë˜ì²˜ëŸ¼ Jenkins pipelineìœ¼ë¡œ ì‹¤í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 pipeline { agent any stages { stage(\u0026#39;Run Container\u0026#39;) { steps { script { // Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ docker.image(\u0026#34;hello-world:latest\u0026#34;).run() } } } } } ìœ„ì˜ ê²°ê³¼ê¹Œì§€ ë‚˜ì˜¤ë©´, jenkinsì—ì„œë„ dockerë¥¼ ë§ˆìŒê» ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nConclusion Dockerë¡œ êµ¬ë™í•œ Jenkinsì—ì„œ Dockerë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. Containerë¡œ ë§Œë“¤ì–´ì§„ Jenkinsì—ì„œ Hostì˜ Dockerì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤ëŠ”ê²Œ, í¸ë¦¬í•˜ê¸´ í•˜ì§€ë§Œ ë³´ì•ˆìƒìœ¼ë¡œëŠ” ì¢‹ì§€ì•Šì•„ ë³´ì…ë‹ˆë‹¤. ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ Containerì™€ Hostì˜ ë³´ì•ˆì„ ì¢€ ë” ì‹ ê²½ ì¨ì„œ ì‚¬ìš©í•´ì£¼ì‹œë©´, ì•ˆì „í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ë„¤ìš”. ê°ì‚¬í•©ë‹ˆë‹¤.\nReference https://faun.pub/how-to-install-docker-in-jenkins-container-4c49ba40b373 https://github.com/jenkinsci/docker/blob/master/README.md ","date":"2023-08-26T22:30:49+09:00","permalink":"https://korcasus.github.io/p/use-docker-in-jenkins-docker/","title":"Use Docker in Jenkins Docker"},{"content":"Introduction Hugoë¡œ ë¸”ë¡œê·¸ë¥¼ ë§Œë“¤ì–´ì„œ ìš´ì˜ì¤‘ì¸ë°ìš”. êµ¬ê¸€ ì„œì¹˜ì½˜ì†”ì— sitemap.xmlì„ ì œì¶œìˆ˜ ê²€ìƒ‰ì— ë…¸ì¶œë˜ê²Œë” ì„¤ì •í•´ë‘ì—ˆìŠµë‹ˆë‹¤.\nê·¸ëŸ°ë° ëª‡ë‹¬ì´ ì§€ë‚œ ì§€ê¸ˆë„ ìƒ‰ì¸ëœ í˜ì´ì§€ê°€ ëª‡ ê°œê°€ ë˜ì§€ì•ŠìŠµë‹ˆë‹¤.\nê¸€ì´ ì ì€ê±¸ ê³ ë ¤í•˜ë”ë¼ë„, ì´í•´í•˜ê¸° ì–´ë ¤ìš´ ìˆ˜ì¹˜ì—¬ì„œ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.\nìƒ‰ì¸ë˜ì§€ ì•Šì€ í˜ì´ì§€ë“¤ì€ ëŒ€ë‹¤ìˆ˜ê°€ categoriesì™€ tagsë¡œ ìƒì„±ëœ í˜ì´ì§€ ì˜€ìŠµë‹ˆë‹¤.\nëª‡ë‹¬ì§¸ ì´ ìƒíƒœê°€ ìœ ì§€ëœë‹¤ëŠ”ê±´, ìƒ‰ì¸ ëŒ€ìƒì—ì„œ ì œì™¸(?) ë˜ëŠ”ê±° ì•„ë‹ê¹Œ ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nì´ëŸ¬ë©´ ì •ìƒì ì¸ ê¸€ê¹Œì§€ë„ ìƒ‰ì¸ ë˜ì§€ì•Šê²Œ ë˜ëŠ”ê±°ë¼ ì¶”ê°€ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê¸°ë¡œ ë§ˆìŒ ë¨¹ì—ˆìŠµë‹ˆë‹¤.\nObjective êµ¬ê¸€ì—ì„œ ìˆ˜ì§‘í•  í˜ì´ì§€ë“¤ì„ ë³´ëŠ” í˜ì´ì§€(sitemap.xml)ì—ì„œ ë¶ˆí•„ìš”í•œ ê¸€ë“¤ì„ ëŒ€ìƒì—ì„œ ì œì™¸í•œë‹¤.\nHow HugoëŠ” ì‚¬ìš©ì¤‘ì¸ ì„¤ì •íŒŒì¼ì—ë§Œ ì¶”ê°€í•´ì£¼ë©´, sitemapì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì¤ë‹ˆë‹¤.\n(ì„¤ì •ì— ëŒ€í•œ ê°€ì´ë“œëŠ” ë§í¬ì—ì„œ í™•ì¸í•˜ì‹¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.)\nì´ ì„¤ì •ëŒ€ë¡œ ì‚¬ìš©í•  ê²½ìš°, categoriesì™€ tagsê°€ sitemap.xmlì— í¬í•¨ë˜ì–´ ì¶œë ¥ë˜ê¸° ë–„ë¬¸ì— customí•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\noverride built-in templateì„ ì½ì–´ë³´ë©´, custom í•˜ëŠ” ë°©ë²•ì„ ìƒì„¸íˆ ì•ˆë‚´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ 2ê°œ ì¤‘ í•˜ë‚˜ì˜ íŒŒì¼ë§Œ ë§Œë“¤ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.\n1 2 - layouts/sitemap.xml - layouts/_default/sitemap.xml ì €ì˜ ê²½ìš°ì—ëŠ” defaultë¡œ ë§Œë“œëŠ” ê²ƒì— ì™ ì§€ ëª¨ë¥¼ ê±°ë¶€ê°(?)ì´ ëŠê»´ì ¸ì„œ layouts/sitemap.xmlë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\në§Œë“  sitemap.xmlì—ì„œ ì–´ë–»ê²Œ ë‚´ìš©ì„ êµ¬ì„±í•˜ë©´ ë˜ëŠ”ì§€ ì‘ì„±í•´ì£¼ë©´ ë˜ëŠ”ë°ìš”. Hugoê°€ Golangìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œê¸° ë•Œë¬¸ì—, HTMLì„ ë§Œë“¤ê¸° ìœ„í•œ golang template language ë¬¸ë²•ì— ë§ê²Œ sitemap.xmlì„ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.\në²ˆê±°ë¡œìš°ë‹ˆê¹Œ ìš°ì„  ê²°ë¡ ë¶€í„° ì´ì•¼ê¸°í•˜ë©´ sitemap.xmlì€ ì•„ë˜ì˜ ë‚´ìš©ì²˜ëŸ¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 {{ printf \u0026#34;\u0026lt;?xml version=\\\u0026#34;1.0\\\u0026#34; encoding=\\\u0026#34;utf-8\\\u0026#34; standalone=\\\u0026#34;yes\\\u0026#34;?\u0026gt;\u0026#34; | safeHTML }} \u0026lt;urlset xmlns=\u0026#34;http://www.sitemaps.org/schemas/sitemap/0.9\u0026#34; xmlns:xhtml=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34;\u0026gt; {{ range .Pages }} {{ if not (in .Site.Params.taxonomiesExcludedFromSitemap .Data.Plural) }} \u0026lt;url\u0026gt; \u0026lt;loc\u0026gt;{{ .Permalink }}\u0026lt;/loc\u0026gt;{{ if not .Lastmod.IsZero }} \u0026lt;lastmod\u0026gt;{{ safeHTML ( .Lastmod.Format \u0026#34;2006-01-02T15:04:05-07:00\u0026#34; ) }}\u0026lt;/lastmod\u0026gt;{{ end }}{{ with .Sitemap.ChangeFreq }} \u0026lt;changefreq\u0026gt;{{ . }}\u0026lt;/changefreq\u0026gt;{{ end }}{{ if ge .Sitemap.Priority 0.0 }} \u0026lt;priority\u0026gt;{{ .Sitemap.Priority }}\u0026lt;/priority\u0026gt;{{ end }}{{ if .IsTranslated }}{{ range .Translations }} \u0026lt;xhtml:link rel=\u0026#34;alternate\u0026#34; hreflang=\u0026#34;{{ .Language.Lang }}\u0026#34; href=\u0026#34;{{ .Permalink }}\u0026#34; /\u0026gt;{{ end }} \u0026lt;xhtml:link rel=\u0026#34;alternate\u0026#34; hreflang=\u0026#34;{{ .Language.Lang }}\u0026#34; href=\u0026#34;{{ .Permalink }}\u0026#34; /\u0026gt;{{ end }} \u0026lt;/url\u0026gt; {{ end }} {{ end }} \u0026lt;/urlset\u0026gt; {{ if not (in .Site.Params.taxonomiesExcludedFromSitemap .Data.Plural) }} ë¼ëŠ” ë¶€ë¶„ì´ ë…¸ì¶œì œì–´í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.\nì²«ë²ˆì§¸ ë³€ìˆ˜(.Site.Params.taxonomiesExcludedFromSitemap)ëŠ” Site Variableì„ ì‚¬ìš©í•©ë‹ˆë‹¤. Site Variableì€ ì‰½ê²Œ ìƒê°í•˜ë©´ Global Variable ì—­í• ì„ ë§¡ëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.\nì—¬ê¸°ì„œ Paramsë¼ëŠ” ë³€ìˆ˜ê²Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œë° ê´€ë ¨ëœ ë‚´ìš©ì€ ë§í¬ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n.Site.Params ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ config íŒŒì¼ì— params ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ ë§ì€ paramsì— ìˆëŠ” taxonomiesExcludedFromSitemap ë³€ìˆ˜ì— ì ‘ê·¼í•˜ê² ë‹¤ëŠ” ëœ»ì´ì£ .\nconfig.yamlì— ì¶”ê°€í•œ ì ì´ ì—†ê¸° ë•Œë¬¸ì—, ë…¸ì¶œì œì–´ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ì¶”ê°€í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. (config.yamlë˜ëŠ” config.tomlì— ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”)\n1 2 3 4 params: taxonomiesExcludedFromSitemap: - \u0026#34;tags\u0026#34; - \u0026#34;categories\u0026#34; ë‘ë²ˆì§¸ ë³€ìˆ˜ëŠ” Taxonomy Variableì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\nì´ê±¸ ì°¾ì•„ë³¼ë•Œ ê¹Œì§€ Taxonomyê°€ ë¬´ì—‡ì¸ì§€ ëª°ëìŠµë‹ˆë‹¤\u0026hellip; ê°„ë‹¨íˆ ì •ë¦¬í•˜ë©´ Userê°€ ì •ì˜í•˜ëŠ” Grouping ë°©ë²•ì…ë‹ˆë‹¤.\n(ìì„¸íˆ ì•Œê³ ì‹¶ì€ ë¶„ì€ ë§í¬ë¥¼ í•œë²ˆ ì½ì–´ë³´ë©´ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.)\në³€ìˆ˜ ì„¤ëª…í˜ì´ì§€ë¥¼ ë³´ë©´ .Data.Pluralì€ ë¶„ë¥˜ë²•ì˜ ë³µìˆ˜ ì´ë¦„ì´ë¼ê³  ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.\në…¸ì¶œì œì–´í•˜ê³  ì‹¶ì€ í˜ì´ì§€ë“¤ì— í•´ë‹¹ë˜ëŠ” ë³€ìˆ˜ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nyamlíŒŒì¼ ìˆ˜ì •ê³¼ sitemap.xmlì¶”ê°€ê¹Œì§€ í–ˆë‹¤ë©´, í•„ìš”í•œ ì¡°ì¹˜ë“¤ì€ ëª¨ë‘ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. localì—ì„œ sitemapì´ ì˜ë„í•œ ëŒ€ë¡œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ë°°í¬í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.\nConclusion ìƒê°ë³´ë‹¤ ì–´ë ¤ìš´ ì‘ì—…ì€ ì•„ë‹ˆì—ˆì§€ë§Œ, Hugoì˜ ì„¤ì • ê´€ë ¨ ë¬¸ì„œë“¤ì„ ì°¾ê¸°ê°€ ì¡°ê¸ˆ ì–´ë ¤ì› ìŠµë‹ˆë‹¤.\nì•„ì§ì€ Document êµ¬ì„±ì´ ìµìˆ™í•˜ì§€ ì•Šì•„ ê·¸ëŸ°ê²ƒ ê°™ì•„, ì•ìœ¼ë¡œ ë¸”ë¡œê·¸ë¥¼ ìš´ì˜í•´ë‚˜ê°€ë©´ì„œ ìµìˆ™í•´ì ¸ ë‚˜ê°€ì•¼ê² ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\nReference Hugo Community article ","date":"2023-08-15T15:03:02+09:00","permalink":"https://korcasus.github.io/p/hugo-exclude-pages/","title":"Hugo Exclude Pages"},{"content":"Before to start ë§¥ì„ ì‚¬ìš©í•˜ì‹œëŠ”ë¶„ì´ë¼ë©´ Keychainì— ìµìˆ™í•˜ì‹¤ê²ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•´ì£¼ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ì£ .\nìš”ì¦˜ì—ëŠ” í¬ë¡¬ì´ë‚˜ ì—£ì§€ ë¸Œë¼ìš°ì €ì—ì„œë„ ì œê³µí•˜ê³ ìˆìŠµë‹ˆë‹¤.\nì €ëŠ” ì›¹ ë¿ë§Œì´ ì•„ë‹ˆë¼, ë§¥ì—ì„œë„ í¸í•˜ê²Œ ì‚¬ìš©í• ìˆ˜ ìˆëŠ”ê²ƒì„ ì›í–ˆê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ íˆ´ì„ ì‚¬ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤.\në” ìì„¸íˆ ì´ì•¼ê¸°í•˜ë©´ ê¸¸ì–´ì§€ê¸° ë•Œë¬¸ì—, ì§§ê²Œ ì´ì•¼ê¸°í•˜ë©´ Valutwardenì´ë¼ëŠ” Bitwardenì˜ Compactë²„ì „ì„ synologyì— ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤.\nì´ë²ˆì— Valutwardenì´ 1.29.0 ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ ë˜ë©´ì„œ ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ ê°€ëŠ¥í•´ì¡Œë‹¤ëŠ” ì†Œì‹ì— ì—…ê·¸ë ˆì´ë“œë¥¼ ê²°ì‹¬í•˜ì˜€ìŠµë‹ˆë‹¤.\nObjective Valutwardenì„ 1.29.1ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ë©´ì„œ, í•„ìš”í•œ ì„¤ì •(ex. ì‹¤ì‹œê°„ ë™ê¸°í™”)ë“¤ì„ ì¶”ê°€í•œë‹¤.\nUpgrade Upgrade Guide ì°¾ê¸° ì—…ê·¸ë ˆì´ë“œ í•˜ê¸°ì „ê¹Œì§€ ì‚¬ìš©í•˜ë˜ docker imageë¥¼ latestë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì—, ëª‡ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆëŠ”ì§€ëŠ” ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìµœì‹ ë²„ì „ì´ 1.29.xë²„ì „ì´ê¸° ë•Œë¬¸ì— minor ë²„ì „ë§Œ ì‹ ê²½ì¨ì£¼ë©´ ë ê²ƒìœ¼ë¡œ ìƒê°í–ˆìŠµë‹ˆë‹¤.\nê³µì‹ Githubì— ë“¤ì–´ê°€ë³´ë©´ Updating valutwarden image Wikiê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì‚´í´ë³´ë‹ˆ ì»¨í…Œì´ë„ˆ í™˜ê²½ì—ì„œ ì—…ê·¸ë ˆì´ë“œë¥¼ í•˜ëŠ” ë°©ë²•ë§Œ ì„¤ëª…í•˜ì˜€ê³ , ë²„ì „ì´ ë°”ë€Œë©´ì„œ ë³€ê²½í•´ì•¼í•˜ëŠ” ì„¤ì •ì— ëŒ€í•´ì„œëŠ” ì–¸ê¸‰ì´ ì—†ìŠµë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” ì´ëŸ´ë•Œ Release Noteë¥¼ ì‚´í´ë´…ë‹ˆë‹¤. ì •ì„ì€ ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ì½ì–´ì•¼í•˜ì§€ë§Œ, ì„  ì—…ê·¸ë ˆì´ë“œ í›„ ë³€ê²½í•˜ê¸°ë¡œ ë§ˆìŒë¨¹ì—ˆìŠµë‹ˆë‹¤ ğŸ˜‡\nê·¸ë˜ë„ ì—…ê·¸ë ˆì´ë“œ í•˜ëŠ”ê²Œ 1.29.xì´ë‹ˆ 1.29.0ìœ¼ë¡œ ì˜¬ë¼ì˜¤ë©´ì„œ í° ë³€ê²½ì´ ì–´ë–¤ê±´ì§€ ë³´ì•˜ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 - WebSocket notifications now work via the default HTTP port. No need for `WEBSOCKET_ENABLED` and a separate port anymore. - The proxy examples still need to be updated for this. Support for the old websockets port 3012 will remain for the time being. - Mobile Client push notification support, see #3304 thanks @GeekCornerGH! - Web-Vault updated to v2023.5.0 (v2023.5.1 does not add any improvements for us) - The latest Bitwarden Directory Connector can be used now (v2022.11.0) - Storing passkeys is supported, though the clients are not yet released. So, it might be we need to make some changes once they are released. - See: #3593, thanks @GeekCornerGH! ì €í•œí…ŒëŠ” 3ê°€ì§€ê°€ ëˆˆì— ë“¤ì–´ì™”ìŠµë‹ˆë‹¤.\nWebSocket notifications now work via the default HTTP port. No need for WEBSOCKET_ENABLED and a separate port anymore. Mobile Client push notification support, see #3304 thanks @GeekCornerGH! Storing passkeys is supported, though the clients are not yet released. So, it might be we need to make some changes once they are released. 1ë²ˆì˜ ê²½ìš°ì—ëŠ” í°ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ì•±ì—ì„œ ë³€ê²½ì‚¬í•­ì´ ë°œìƒì‹œ, valutwarden ì„œë²„ì— ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œ í•„ìˆ˜ë¡œ ì„¤ì •í•´ì•¼í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. (ì•„ë‹ˆë©´ ì„œë²„ì™€ íœ´ëŒ€í°ì•±ì´ ë³„ë„ì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.) ì´ê²ƒ ë•Œë¬¸ì— 2ê°œì˜ í¬íŠ¸ë¥¼ ì—´ì–´ë‘ê³  ì‚¬ìš©í•˜ëŠ”ê²Œ í•„ìš”í–ˆì—ˆëŠ”ë°, ì´ë²ˆ ì—…ë°ì´íŠ¸ë¡œ 1ê°œë¡œ í†µí•©ë˜ì—ˆë‹¤ê³  í•˜ë„¤ìš”.\nê³µìœ ê¸°ì— ê°œë°©í•´ë‘” í¬íŠ¸ë¥¼ ì¤„ì¼ìˆ˜ ìˆì„ë¿ë”ëŸ¬, ì‹ ê²½ì¨ì•¼ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ê°€ í•˜ë‚˜ ì¤„ì—ˆìŠµë‹ˆë‹¤.\n2ë²ˆì˜ ê²½ìš°ì—ëŠ” ì‹¤ì‹œê°„ ë™ê¸°í™”ì…ë‹ˆë‹¤. ì´ê±°ëŠ” ë‚˜ì¤‘ì— ìì„¸íˆ ë³´ê² ìŠµë‹ˆë‹¤.\n3ë²ˆì€ Passkeyì— ê´€í•œ ë‚´ìš©ì…ë‹ˆë‹¤. ì• í”Œê³¼ êµ¬ê¸€ì—ì„œ ì§€ì›í•˜ê¸° ì‹œì‘í•œ ë³´ì•ˆ ë°©ë²•ì¤‘ í•˜ë‚˜ì¸ë°, ê³ ë„í™”ëœ ë³´ì•ˆí™˜ê²½ì„ ì œê³µí•œë‹¤ê³  í•©ë‹ˆë‹¤. ì €ë„ ìì„¸íˆ ì‚´í´ë³´ì§„ ì•Šì•„ì„œ,\u0026hellip; ì„¤ëª…ì€ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.\në³´ì•ˆì— ì‹ ê²½ì€ í•­ìƒ ì¨ì•¼í•˜ê¸°ë•Œë¬¸ì—, ì§€ì›ê°€ëŠ¥í•´ì§€ë©´ ì‚¬ìš©í•´ë³´ê³ ì‹¶ë„¤ìš”.\nì¶”ê°€í•  Configuration ë³´ê¸° ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬ í”„ë¡œê·¸ë¨ì„ ê°œì¸ ì„œë²„ì— ì˜¬ë ¤ì„œ ì‚¬ìš©í•œë‹¤ëŠ”ê±´, ì±…ì„ë„ ë³¸ì¸ì´ ì§„ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.\në”°ë¼ì„œ í•´í‚¹ë‹¹í•˜ì§€ì•Šë„ë¡ ë¬¸ì œì˜ ì†Œì§€ê°€ ë ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì€ ë‹«ì•„ë‘ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤. (ê¸°ë³¸ì€ ë‹«í˜€ìˆì„ê²ë‹ˆë‹¤.) ê·¸ë˜ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê¸°ëŠ¥ê³¼ ì‚¬ìš©í•  ê¸°ëŠ¥ë“¤ì„ ì‚´í´ë³´ê¸° ìœ„í•´ì„œ ë¬¸ì„œë¥¼ ì½ì–´ë³´ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.\nGithub wikië¥¼ ì½ì–´ë³´ë©´ ìì„¸í•˜ê²Œ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤. config.jsonë³´ë‹¤ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê¶Œê³ í•˜ë„¤ìš”.\në¦¬ìŠ¤íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\nì—¬ëŸ¬ ê´€ì‹¬ê°€ëŠ” ì„¤ì •ë“¤ì´ ë§ì§€ë§Œ, ì €ëŠ” 2,3,4ë²ˆ í•­ëª©ì´ ëˆˆì— ë“¤ì–´ì™”ê³  ë°˜ì˜í•˜ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.\n2ë²ˆí•­ëª©ì€ ì¶”ê°€ ì‚¬ìš©ì ê°€ì…ê¸ˆì§€ 3ë²ˆí•­ëª©ì€ ì´ˆëŒ€ë¥¼ í†µí•œ ì‚¬ìš©ì ê°€ì…ê¸ˆì§€ 4ë²ˆí•­ëª©ì€ adminê³„ì • ìš´ì˜ adminì„ ë³„ë„ë¡œ ê´€ë¦¬í•˜ê³ ì‹¶ì§€ì•Šì•˜ê¸°ì—, ê¸°ë³¸ê°’ì´ adminê³„ì • ë¹„í™œì„±í™”ì¸ì§€ ì‚´í´ë´¤ìŠµë‹ˆë‹¤. ìœ„ì— ë‚˜ì—´í•œ ë‚´ìš©ë“¤ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œ ì•„ë˜ì™€ ê°™ì´ ì„¤ì • í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n1 2 SIGNUPS_ALLOWED : false INVITATIONS_ALLOWED : false ê·¸ëŸ¬ê³ ë³´ë‹ˆ ì‹¤ì‹œê°„ ë™ê¸°í™”ë„ ì„¤ì •ì´ í•„ìš”í•˜ë„¤ìš”.\n7ë²ˆ í•­ëª©ì— ë“±ë¡ë˜ì–´ìˆìŠµë‹ˆë‹¤.\në¬¸ì„œë¥¼ ì‚´í´ë³´ë©´ ì•„ì‹œê² ì§€ë§Œ, 3ê°œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ ìš”êµ¬í•©ë‹ˆë‹¤.\n1 2 3 - PUSH_ENABLED=true - PUSH_INSTALLATION_ID= - PUSH_INSTALLATION_KEY= IDì™€ KEYëŠ” Bitwarden í™ˆí˜ì´ì§€ì—ì„œ ë°œê¸‰ë°›ìœ¼ë¼ê³  í•©ë‹ˆë‹¤.\nSelf Hostingì€ ì§€ì›í•˜ì§€ ì•ŠëŠ”ê±´ê°€? ì‹¶ì—ˆëŠ”ë°, ë‹¤í–‰íˆ ì§€ì›í•˜ë„¤ìš”.\nSelf Hostingì—ì„œ ì´ìš©ì¤‘ì¸ ì´ë©”ì¼ê³¼ Data Regionì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.\nData Regionì€ ë­”ê°€ì‹¶ê² ì§€ë§Œ, Wikiì— USë¡œ ë‘ê³  ì“°ë¼ê³  ì í˜€ìˆë„¤ìš”. Europeì€ ì•ˆë ìˆ˜ë„ìˆë‹¤ê³ \u0026hellip; ê·¸ë¦¬ê³  ì—…ê·¸ë ˆì´ë“œ ì§í›„ì— Appì—ì„œ ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ ì•ˆë ê²½ìš° ì¬ì„¤ì¹˜í•˜ë¼ê³  ê°€ì´ë“œí•˜ê³ ìˆìŠµë‹ˆë‹¤.\nì—…ê·¸ë ˆì´ë“œ ì™„ë£Œí•œ í›„ì—, í•œë²ˆ ì‹¤ì‹œê°„ ë™ê¸°í™” í•´ë³´ì‹œëŠ”ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤. (ì €ëŠ” ì§í›„ì— ë°”ë¡œí•´ë´¤ëŠ”ë° ì˜ë˜ë”ë¼êµ¬ìš”)\nUpgrade í•˜ê¸° ë³¸ì¸ Synologyì— Valutwardenì„ ì„¤ì¹˜í•˜ì‹  ë¶„ì´ë¼ë©´, ì—…ê·¸ë ˆì´ë“œ í•˜ëŠ” ê³¼ì •ì€ ë‹¤ ì•„ì‹¤ê±°ë¼ íŒë‹¨í•´ì„œ ê³¼ì •ì€ ìƒëµí–ˆìŠµë‹ˆë‹¤.\nì—…ê·¸ë ˆì´ë“œ ì™„ë£Œí•œ ì»¨í…Œì´ë„ˆ ì„¤ì •ê°’ì¸ë°, ì´ì „ê³¼ í° ì°¨ì´ëŠ” ì—†ìŠµë‹ˆë‹¤.\nì™„ë£Œí›„, docker container logí™•ì¸ê³¼ valutwarden webì— ì ‘ì†í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\nlogì—ëŠ” ì„œë²„ë¥¼ ì‹¤í–‰í•˜ëŠ”ë° ë¬¸ì œì—†ì—ˆê³ , webì— ì ‘ì†í•´ë³´ë‹ˆ ì—ëŸ¬í˜ì´ì§€ ëœ¨ì§€ì•Šê³  ê¸°ì¡´ ë°ì´í„°ë„ ì˜ ìˆìŠµë‹ˆë‹¤.\nì‹¤ì‹œê°„ ë™ê¸°í™”ë„ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ëŠ”ë°, ì¡°ê¸ˆ ì´ìƒí•˜ë”ë¼êµ¬ìš”. Webì—ì„œ ë³€ê²½í•œ ë‚´ìš©ì€ Appì—ì„œ ë³„ë„ì˜ ì•¡ì…˜ ì—†ì´ ì˜ ë°˜ì˜ë˜ì—ˆëŠ”ë°, Appì—ì„œ ë³€ê²½í•œ ë‚´ìš©ì€ Webì—ì„œ ìƒˆë¡­ê²Œ ë¡œë”©í•´ì£¼ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨í–ˆë‹¤ê°€ ë‹¤ì‹œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥í–ˆìŠµë‹ˆë‹¤ -ã……-)\ní° ì´ìŠˆê¹Œì§„ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, ì—…ê·¸ë ˆì´ë“œ ì˜ ë˜ì—ˆë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.\ní›„ê¸° Valutwardenì€ Bitwardenì˜ Compactë¥¼ ì¶”êµ¬í•˜ëŠ” ë§Œí¼ ê¼­ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ë§Œ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ì´ìœ ë•Œë¬¸ì— ì—…ê·¸ë ˆì´ë“œ í•˜ë”ë¼ë„ ë§ì´ ë³€ê²½í•˜ì§€ì•Šì•„ë„ ë˜ëŠ”ê²ƒì´ ì¢‹ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤.\në³„ë„ë¡œ ìš´ì˜ë˜ê¸° ë•Œë¬¸ì— ì—…ê·¸ë ˆì´ë“œë¥¼ í•˜ëŠ”ë° ê°œì¸ì˜ ë…¸ë ¥ì´ í•„ìš”í• ê²ë‹ˆë‹¤. í›„ì›ì„ ë°›ê¸´í•˜ì§€ë§Œ ì˜¤í”ˆì†ŒìŠ¤ í™˜ê²½ì—ì„œ ìë°œì ìœ¼ë¡œ í•´ì£¼ì‹œëŠ” ë¶„ë“¤ì—ê²Œ ê°ì‚¬í•  ë”°ë¦„ì´ë„¤ìš”.\nì €ë„ ì–¸ì  ê°€ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ Contributeí•˜ëŠ” ìˆœê°„ì´ ì˜¤ê² ì£ ?? ê³§ ì˜¬ê±°ë¼ ë¯¿ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2023-08-14T23:09:01+09:00","permalink":"https://korcasus.github.io/p/upgrade-vaultwarden-1.29.1/","title":"Upgrade Vaultwarden 1.29.1"},{"content":"Introduction ESê°€ ê²€ìƒ‰ì—”ì§„ì´ë‹¤ë³´ë‹ˆ, ì„¤ì •í•œ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì¡°ê±´ìœ¼ë¡œ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒ‰ì¸í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ê³ , ìƒ‰ì¸ì„ í•˜ê¸°ìœ„í•´ì„œëŠ” ë§ì€ ë¦¬ì†ŒìŠ¤ê°€ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.\nì´ëŸ¬í•œ ì œì•½ì¡°ê±´ìœ¼ë¡œ ì¸í•´, ë§ì€ ì–‘ì˜ ë°ì´í„° ì†ì—ì„œ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ íš¨ìœ¨ì ìœ¼ë¡œ ì¶”ì¶œí•˜ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤.\në”°ë¼ì„œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì•¼í• í…ë°, ì´ëŸ¬í•œ ìƒí™©ì´ë¼ë©´ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° Hadoopì„ ì‚¬ìš©ì„ ê²€í† í•©ë‹ˆë‹¤.\në§Œì•½ Elasticsearchì— ì €ì¥í•  ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ì—­í• ì„ íŒ€ì› ë˜ëŠ” ë³¸ì¸ì´ë¼ë©´, ì ì ˆí•œ ë°©ë²•ìœ¼ë¡œ HDFSì— ê¸°ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ë°ì´í„° ì „ì†¡ì— ëŒ€í•œ ì œì–´ê¶Œì´ ì—†ê³ , Elasticsearchë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?\në‹¹ì—°íˆ Elasticsearchì—ì„œ ë°ì´í„° ì¶”ì¶œì„ ê²€í† í•´ì•¼í•  ê²ƒì…ë‹ˆë‹¤.\nì´ëŸ¬í•œ ìƒí™©ì— ì‚¬ìš©í•˜ê¸° ì í•©í•œ ë°©ë²•ì„ ì„¤ëª…í•˜ê³ ì í•©ë‹ˆë‹¤.\nSparkì—ì„œ libraryë¥¼ ì‚¬ìš©í•´, Elasticsearch ë°ì´í„°ë¥¼ ETLí•˜ëŠ” ê³¼ì •ì„ Getting Started ì •ë„ì˜ ë‚´ìš©ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.\nObjective ESì— ìƒ‰ì¸ë˜ì–´ìˆëŠ” íŠ¹ì • indexë¥¼ Hiveë¡œ ETLí•œë‹¤.\nRequired Sparkì— ì¡°ê¸ˆì˜ ì§€ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤. Elasticsearchì— ì¡°ê¸ˆì˜ ì§€ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤. Environment Scala : 2.12 Spark : 3.x Java : 8 ElasticSearch : 7.x Dependency elasticsearch-hadoop elasticsearch-spark-30_2.12 calcite-core ElasticSearch 8ë²„ì „ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ë©´, Release Noteë¥¼ ë³´ê³  ì ì ˆí•œ ë²„ì „ì„ ì°¾ëŠ”ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\nelastic-* ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” 7.17.0 ë²„ì „ ì´ìƒì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.\n7.17.0 ë²„ì „ì—ì„œ ì¤‘ìš”í•œ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡Œê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\ncalcite-coreëŠ” deserializeí• ë•Œ ì‚¬ìš©í–ˆë˜ê²ƒìœ¼ë¡œ ê¸°ì–µí•©ë‹ˆë‹¤.\nì¶”ê°€í•˜ì§€ì•Šìœ¼ë©´, Dataframeì„ ìƒì„±í•˜ëŠ” ê³¼ì •ì— ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.\nGetting Started Connect ê°€ì´ë“œëŒ€ë¡œ í•˜ë©´ Spark SQLì„ ì‚¬ìš©í•  ìˆ˜ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Spark SQLì€ êµ¬ì¡°í™”ëœ ë°ì´í„°ì´ë¯€ë¡œ, ë™ì¼í•œ ë°ì´í„°êµ¬ì¡°ë¥¼ ê°€ì§€ì§€ì•Šì„ê²½ìš° ë¬¸ì œê°€ ìƒê¸¸ìˆ˜ìˆìŠµë‹ˆë‹¤.\nêµ¬ë²„ì „ì€(Spark version \u0026lt; 3.x) ì„¤ëª…í•˜ì§„ ì•Šê² ìŠµë‹ˆë‹¤.\nSpark3ë²„ì „ë¶€í„°ëŠ” SparkSessionì„ ìƒì„±í•´ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.\nSessionì„ ìƒì„±í•˜ë©´ì„œ, ì—°ê²°í•˜ê³ ì í•˜ëŠ” esì˜ ì •ë³´ë“¤ì„ ì…ë ¥í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nConfigurationì„ ì½ìœ¼ë©´ ìƒì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nESì— ì—°ê²°í•˜ê¸°ìœ„í•´ì„œëŠ” ì•„ë˜ì˜ 2ê°œëŠ” í•„ìˆ˜ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\nes.nodes es.port ì¸ì¦ì´ í•„ìš”í•˜ê±°ë‚˜, httpsì—°ê²°ì´ í•„ìš”í•˜ì§€ì•Šì„ ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ì„¤ì •ì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤.\nes.net.http.auth.user es.net.http.auth.pass es.net.ssl ì¸ì¦ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì€ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. ì œí•œëœ í™˜ê²½ì¸ WANí™˜ê²½ì— êµ¬ì¶•ëœ ESë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²½ìš° ì¶”ê°€í•´ì£¼ì–´ì•¼í•˜ëŠ” íŒŒë¼ë¯¸í„°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•  ê²½ìš°, es.nodes ì— ëª…ì‹œëœ nodesë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë‹¤ë¥¸ nodeëŠ” íƒìƒ‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nes.nodes.wan.only ìƒì„¸ ë‚´ìš©ì€ ë§í¬ì—ì„œ ë³´ì‹¤ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì™€ê°™ì€ ì„¤ì • ì •ë³´ë“¤ì„ ëª¨ë‘ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 sparkSession = SparkSession.builder() .master(sparkConfiguration.getMaster()) .appName(sparkConfiguration.getAppName()) .config(\u0026#34;spark.es.nodes\u0026#34;, \u0026#34;es-nodes\u0026#34;) .config(\u0026#34;spark.es.port\u0026#34;, \u0026#34;es-port\u0026#34;) .config(\u0026#34;spark.es.net.http.auth.user\u0026#34;, \u0026#34;user\u0026#34;) .config(\u0026#34;spark.es.net.http.auth.pass\u0026#34;, \u0026#34;password\u0026#34;) .config(\u0026#34;spark.es.nodes.wan.only\u0026#34;, true) .config(\u0026#34;spark.es.net.ssl\u0026#34;, true) ElasticSearch hadoopì€ Sparkê°€ ì ‘ê·¼í•´ì˜¬ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ 4ê°€ì§€ ì œê³µí•˜ê³ ìˆìŠµë‹ˆë‹¤.\nNative RDD Spark Streaming Spark SQL Spark Structured Streaming ìœ„ 4ê°€ì§€ë¥¼ ì„±ê²©ì— ë”°ë¼ ë‚˜ëˆ„ì–´ ë³´ì•˜ìŠµë‹ˆë‹¤.\nStructured vs Unstructured Streaming vs Non-Streaming(Batch) Streamingì„ ê³ ë ¤í•´ì•¼í•œë‹¤ë©´, Spark Streamingì´ë‚˜ Spark Structured Streamingì„ ê²€í† í•´ë³¼ìˆ˜ìˆìŠµë‹ˆë‹¤.\nê·¸ê²Œì•„ë‹ˆë¼ë©´ Native RDDë‚˜ Spark SQLì„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ESë°ì´í„°ë¥¼ Hiveì—ì„œ ì‚¬ìš©í•  ëª©ì ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” í”„ë¡œì íŠ¸ì´ë¯€ë¡œ, Structure í˜•íƒœë¥¼ ê°€ì§ˆìˆ˜ ìˆëŠ” Spark SQLë¡œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. 1.5 ì´ìƒë¶€í„°ëŠ” ì•„ë˜ì²˜ëŸ¼ Dataframeì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (1.5 ì´ì „ ë²„ì „ì€ ê°€ì´ë“œ ë¬¸ì„œë¥¼ í†µí•´ í™•ì¸í•´ ì£¼ì„¸ìš”.)\n1 val df = sql.read.format(\u0026#34;es\u0026#34;).load(\u0026#34;spark/index\u0026#34;) ì˜ˆì‹œëŠ” Javaë„ ìˆê¸´í•˜ì§€ë§Œ, Scalaë¡œ ìœ„ì£¼ë¡œ ì„¤ëª…í•˜ëŠ”ê²Œ ëŒ€ë‹¤ìˆ˜ì…ë‹ˆë‹¤.\nìœ ì§€ ë³´ìˆ˜ë¥¼ ìœ„í•´ Java Projectë¡œ ì§„í–‰í•´ì•¼í–ˆê¸°ë•Œë¬¸ì—, ì‚¬ìš© ì˜ˆì‹œëŠ” ì•ìœ¼ë¡œ Javaë¡œ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n1 2 3 Dataset\u0026lt;Row\u0026gt; df = sparkSession.read() .format(\u0026#34;es\u0026#34;) .load(\u0026#34;template_data\u0026#34;); ìœ„ì™€ê°™ì€ ë°©ë²•ìœ¼ë¡œ DataFrame ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në§Œì•½ì— Java DataFrame ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 Map\u0026lt;String, String\u0026gt; cfg = Maps.newHashMap(); // cfgëŠ” configurationì„ ì¶”ê°€í•˜ê¸°ìœ„í•œ ê°ì²´ì…ë‹ˆë‹¤. cfg.put(\u0026#34;es.read.metadata\u0026#34;, \u0026#34;true\u0026#34;); Dataset\u0026lt;Row\u0026gt; df = JavaEsSparkSQL.esDF(sparkSession, \u0026#34;template_data\u0026#34;, cfg); Read from ES ì§€ê¸ˆê¹Œì§€ ì„¤ëª…ë“œë¦° ë°©ë²•ì„ í†µí•´ DataFrameì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ì œëŠ” ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ì‚¬ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nìš°ì„ ì€ DataFrameì— ì–´ë–¤ ë°ì´í„°ë“¤ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\nì•„ë˜ì™€ ê°™ì´ printSchema()í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´, DataFrameì´ ì–´ë–¤ êµ¬ì¡°ë¥¼ ê°–ì¶”ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 df.printSchema(); root |-- _class: string (nullable = true) |-- column1: long (nullable = true) |-- column2: string (nullable = true) ... indexì— ì„¤ì •ëœ mappingì •ë³´ë¥¼ í† ëŒ€ë¡œ DataFrameì˜ Schemaë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.\nì—¬ê¸°ê¹Œì§€ ì§ì ‘ ì§„í–‰í•´ë³´ì‹œë©´ ì•„ì‹œê² ì§€ë§Œ, document idì™€ ê°™ì€ metadataê°€ ì—†ìŠµë‹ˆë‹¤. ì´ë¶€ë¶„ì€ ì¢€ ì˜ì•„í•˜ê¸´ í•˜ì§€ë§Œ, ì„¤ì •ê°’ì„ ì¶”ê°€í•˜ë©´ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Dataset\u0026lt;Row\u0026gt; df = sparkSession.read() .format(\u0026#34;es\u0026#34;) .option(\u0026#34;es.read.metadata\u0026#34;, \u0026#34;true\u0026#34;) .load(\u0026#34;template_data\u0026#34;); df.printSchema(); root |-- _class: string (nullable = true) |-- column1: long (nullable = true) |-- column2: string (nullable = true) ... |-- _metadata: map (nullable = true) | |-- key: string | |-- value: string (valueContainsNull = true) ë˜ í•œê°€ì§€ ì˜ì•„í•œ ì ì´ ìˆì„ ê²ë‹ˆë‹¤. array í•„ë“œëŠ” ì–´ë–»ê²Œ ë˜ëŠ”ê±°ì§€? ğŸ¤”\nmappingì—ëŠ” array íƒ€ì…ì„ ì§€ì •í•´ì¤„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\nê°€ì´ë“œ ë¬¸ì„œë¥¼ ì‚´í´ë´ë„ elementì— ì‚¬ìš©ë˜ëŠ” ë°ì´í„° íƒ€ì…ì„ ëª…ì‹œí•˜ë„ë¡ ì•ˆë‚´í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nDataFrame Schemaê°€ ì˜ëª» ì§€ì •ë˜ì„œ, íŒŒì‹± ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ? ì§ˆë¬¸ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.\nì´ ë¶€ë¶„ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì„¤ì •ìœ¼ë¡œ í•´ê²°ê°€ëŠ¥í•˜ê²Œë” ë§Œë“¤ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.\nì €ë„ ì´ ë¬¸ì œë¥¼ ê²ªì—ˆë‹¤ë³´ë‹ˆ, ì„¤ì •ìœ¼ë¡œ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.\n1 2 3 4 5 Dataset\u0026lt;Row\u0026gt; df = sparkSession.read() .format(\u0026#34;es\u0026#34;) .option(\u0026#34;es.read.metadata\u0026#34;, \u0026#34;true\u0026#34;) .option(\u0026#34;es.read.field.as.array.include\u0026#34;, \u0026#34;productMapping,sellerMapping\u0026#34;) .load(\u0026#34;template_data\u0026#34;); ì–´ë–¤ í•„ë“œë¥¼ array ë¡œ íŒŒì‹±í•´ì•¼í•˜ëŠ”ì§€ ëª…ì‹œí•˜ì˜€ìŠµë‹ˆë‹¤.\nì´ê²ƒê³¼ ë°˜ëŒ€ë¡œ arrayë¡œ íŒŒì‹±í•˜ë©´ ì•ˆë˜ëŠ” í•„ë“œë¥¼ ëª…ì‹œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\nes.read.field.as.array.exclude ê°’ì„ ì„¤ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\nESì— ì €ì¥ëœ ë°ì´í„°ë“¤ê³¼ mappingì˜ ë°ì´í„° íƒ€ì…ì´ ë¶ˆì¼ì¹˜ í•˜ì§€ì•ŠëŠ” ì´ìƒ, ì—¬ê¸°ê¹Œì§€ ì§„í–‰í–ˆë‹¤ë©´ ESë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ”ë° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nDataFrameì„ ì§ì ‘ Handlingí•  ìˆ˜ë„ ìˆì§€ë§Œ, ì„ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  Viewë¥¼ ìƒì„±í•´ì£¼ë©´ ì•„ë˜ì²˜ëŸ¼ SQLì„ ì‚¬ìš©í•  ìˆ˜ë„ìˆìŠµë‹ˆë‹¤.\n1 2 df.createTempView(\u0026#34;tmp_front\u0026#34;); Dataset\u0026lt;Row\u0026gt; filtered_df = sparkSession.sql(\u0026#34;select _metadata, \u0026#34; + String.join(\u0026#34;,\u0026#34;, columns) + \u0026#34; from tmp_front\u0026#34;); Customize Field ESì— ìˆëŠ” ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼, ë³€í™˜ì„ ê±°ì³ ì‚¬ìš©í•´ì•¼í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ë“¤ë©´ Serialized Json Stringì´ í•„ë“œë¡œ ì¡´ì¬í•œë‹¤ë©´, Deserializeí•œ í›„ì— Mapìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.\në¬¼ë¡  ì˜ˆì‹œëŠ” ì €ì˜ ì‚¬ë¡€ì…ë‹ˆë‹¤. ã…\nProcessingì„ í•˜ê¸°ì— ì•ì„œ Sparkê°€ ì–´ë–»ê²Œ ì‹¤í–‰ë˜ëŠ”ì§€ ê°„ë‹¨íˆ ì´ì•¼ê¸°í•´ë³´ê² ìŠµë‹ˆë‹¤.\nìš°ë¦¬ê°€ ì‘ì„±í•œ í”„ë¡œê·¸ë¨ì€ Sparkì—ì„œ Driverë¼ê³  ë¶ˆë¦¬ë©°, ë‹¤ìˆ˜ì˜ ì›Œì»¤ ê´€ë¦¬ ë° ìš´ì˜í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ê´€ë¦¬ ë° ëª¨ë‹ˆí„°ë§ê³¼ ê°™ì€ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.\në°ì´í„° ì¡°íšŒì™€ ë¶„ì‚°ì²˜ë¦¬ì˜ ê²½ìš°ì—ëŠ” Worker(Executor)ê°€ í• ë‹¹ë˜ì–´ ì²˜ë¦¬í•˜ê²Œë©ë‹ˆë‹¤. ë‹¤ìˆ˜ì˜ Workerê°€ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— í° ê·œëª¨ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ë”ë¼ë„ ë¹ ë¥¸ì‹œê°„ì•ˆì— ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\në¬¼ë¡  Workerì—ì„œ ì²˜ë¦¬í•œ ë°ì´í„°ë¥¼ Driverì—ì„œ ì²˜ë¦¬í•˜ê²Œ í• ìˆ˜ëŠ” ìˆì§€ë§Œ, ìƒë‹¹íˆ ëŠë ¤ì§ˆ ê²ƒì…ë‹ˆë‹¤.\nSpark SQLë¡œ ë§Œë“  DataFrameì€ Sparkì˜ Workerì— ë¶„ì‚°ë˜ì–´ ì €ì¥ë˜ì–´ìˆìŠµë‹ˆë‹¤.\në”°ë¼ì„œ í•„ë“œì˜ Processingì„ ìœ„í•´ì„œëŠ” ë‹¤ìˆ˜ì˜ Workerì—ì„œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ì•¼í•©ë‹ˆë‹¤.\nì´ë¥¼ ìœ„í•´ì„œëŠ” Serializable Interfaceë¡œ êµ¬í˜„í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ë¯¸ ë§Œë“¤ì–´ì§„ Classë¥¼ Serializableë¡œ ë³€ê²½í•˜ëŠ” ì‘ì—…ì€ ì‰½ì§€ì•Šì„ ê²ë‹ˆë‹¤.\nëŒ€ì•ˆìœ¼ë¡œ static functionìœ¼ë¡œ ë§Œë“¤ì–´ì„œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì˜ˆì‹œë¡œ ë§ì”€ë“œë ¸ë˜ Deserializeí•œ í›„ ì»¬ëŸ¼ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê³¼ì •ì„ ë‚˜ì—´í•˜ë©´ ì•„ë˜ì™€ ìˆœì„œëŒ€ë¡œ ë˜ê² ìŠµë‹ˆë‹¤.\ní•„ë“œë¥¼ ê°€ê³µí•  ìˆ˜ ìˆëŠ” UDF(User Defined Function)ì„ static functionìœ¼ë¡œ ë§Œë“ ë‹¤. SparkSessionì— UDF ë“±ë¡ DataFrameì˜ ì»¬ëŸ¼ìœ¼ë¡œ ì¶”ê°€ ìœ„ì˜ 3ê°€ì§€ ê³¼ì •ì„ ì½”ë“œë¡œ ì‘ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 public static UDF1\u0026lt;String, HashMap\u0026lt;String, String\u0026gt;\u0026gt; jsonStringToMap = jsonStr -\u0026gt; { ObjectMapper mapper = new ObjectMapper(); return mapper.readValue(jsonStr, new TypeReference\u0026lt;HashMap\u0026lt;String, String\u0026gt;\u0026gt;() {}); }; @Override public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception { sparkSession.udf().register(\u0026#34;jsonStringToMap\u0026#34;, jsonStringToMap, DataTypes.createMapType(DataTypes.StringType, DataTypes.StringType)); df.createTempView(\u0026#34;tmp_front\u0026#34;); Dataset\u0026lt;Row\u0026gt; filtered_df = sparkSession.sql(\u0026#34;select _metadata, \u0026#34; + String.join(\u0026#34;,\u0026#34;, columns) + \u0026#34; from tmp_front\u0026#34;); filtered_df = filtered_df.withColumn(\u0026#34;dataFieldMap\u0026#34;, functions.callUDF(\u0026#34;jsonStringToMap\u0026#34;, filtered_df.col(\u0026#34;dataFields\u0026#34;))); } ì´ë ‡ê²Œ UDF í•¨ìˆ˜ë¥¼ ê° Workerì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ ë¨ìœ¼ë¡œì„œ, ë¶„ì‚°ì €ì¥ëœ DataFrameì„ ë³‘ë ¬ë¡œ Processingí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nConclusion ì—¬ê¸°ê¹Œì§€ Sparkë¥¼ ì‚¬ìš©í•´ Elasticsearch ë°ì´í„°ë¥¼ Hiveì— ì—°ë™í•˜ëŠ” ê³¼ì •ê¹Œì§€ ì§„í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 4ê°€ì§€ ë°©ì‹ì¤‘ ì €ì˜ ë‹ˆì¦ˆì— ë§ëŠ” Spark-SQLë§Œ ì„¤ëª…ë“œë ¸ì§€ë§Œ, ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ë‚˜ë¨¸ì§€ë„ ë¹„ìŠ·ë¹„ìŠ·í•©ë‹ˆë‹¤. ìƒí™©ì— ë§ëŠ” ì ì ˆí•œ ë°©ì‹ì„ ì„ íƒí•´ì„œ ì§„í–‰í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.\nGuide ë¬¸ì„œë§Œ ë³´ê³  ì‹œì‘ì„ í—€ëŠ”ë°, ì‹¤ë ¥ì´ ë¶€ì¡±í•´ì„œ ê·¸ëŸ°ì§€ ì‚½ì§ˆ ì¢€ í–ˆì—ˆìŠµë‹ˆë‹¤. ğŸ« \nì´ì™€ ë¹„ìŠ·í•œ ì¼ì„ í•˜ì…”ì•¼í•˜ëŠ” ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•´ì„œ ê¸°ë¡ìœ¼ë¡œ ë‚¨ê²¨ë´…ë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\nReference Spark-SQL ì—°ë™ ê³µì‹ë¬¸ì„œ : https://www.elastic.co/guide/en/elasticsearch/hadoop/7.17/spark.html#spark-sql Configuration ê³µì‹ë¬¸ì„œ : https://www.elastic.co/guide/en/elasticsearch/hadoop/7.17/configuration.html Dependency Elasticsearch-spark-30 : https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch-spark-30 Elasticsearch-hadoop : https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch-hadoop ","date":"2023-08-11T00:09:54+09:00","permalink":"https://korcasus.github.io/p/elasticsearch-spark/","title":"Elasticsearch Spark"},{"content":"Previous to Start ì•ˆë…•í•˜ì„¸ìš”. ì´ë²ˆ ê¸€ì€ Twitchì—ì„œ ê³µì‹ ì œê³µí•˜ëŠ” ë¬¸ì„œì¸ Handling Webhook Eventsë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\nì§€ê¸ˆë³´ë‹ˆ ì–´ë–¤ ë¬¸ì„œë“¤ë³´ë‹¤ ìƒì„¸í•˜ê²Œ ì˜ ì‘ì„±ë˜ì–´ìˆëŠ”í¸ì´ì§€ë§Œ, ì²˜ìŒì— ì‚¬ìš©í•˜ê³ ì í–ˆì„ë•Œ í—¤ë§¤ì—ˆë˜ ê²½í—˜ì´ ìˆì–´ ë‹¤ë¥¸ì‚¬ëŒë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ë°”ë¨ìœ¼ë¡œ ê°„ë‹¨íˆ Guideë¬¸ì„œë¥¼ ì‘ì„±í•´ë³´ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì¸ì¦ì— ëŒ€í•œ ë°©ë²•ì€ ë”°ë¡œ ê¸°ìˆ í•˜ì§€ì•Šì•˜ìŠµë‹ˆë‹¤. ì¶”í›„ì— ê¸°íšŒê°€ ëœë‹¤ë©´ ê¸°ìˆ í•  ì˜ˆì •ì…ë‹ˆë‹¤.\nOverview Event Subscriptionì€ Twitchì—ì„œ ë°œìƒí•œ Eventë¥¼ êµ¬ë…í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ë§í•©ë‹ˆë‹¤.\nì—¬ëŸ¬ê°€ì§€ì˜ í˜•íƒœë“¤ì˜ Eventë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\nì´ ì¤‘ì—ì„œ EventSubì„ í†µí•´ êµ¬ë…ë°›ê¸° ì›í•˜ëŠ” Eventë¥¼ Twitch ì„œë²„ì— ë“±ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në“±ë¡í•´ ë‘ì—ˆë˜ Eventê°€ íŠ¸ìœ„ì¹˜ì—ì„œ ë°œìƒí•˜ë©´ Applicationì— ì•Œë¦¼ì„ ì „ì†¡í•´ ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ì•„ë˜ ì¢…ë¥˜ì˜ notificationì„ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì˜¨ë¼ì¸ ìƒíƒœì¼ë•Œ ìŠ¤íŠ¸ë¦¬ë¨¸ì˜ ìƒˆë¡œìš´ followerê°€ ìƒê²¼ì„ë•Œ ìŠ¤íŠ¸ë¦¬ë¨¸ì˜ ìƒˆë¡œìš´ êµ¬ë…ìê°€ ìƒê²¼ì„ë•Œ ì‹œì²­ìê°€ ì±„ë„ ì‘ì›í• ë•Œ ì‹œì²­ìê°€ í¬ì¸íŠ¸ë¥¼ ê¸°ë¶€í–ˆì„ë•Œ? TwitchëŠ” ì „ì†¡í•˜ëŠ”ë° 2ê°€ì§€ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤.\nWebhook WebSocket ì´ ë¬¸ì„œì—ì„œ ì„¤ëª…í•˜ê³ ì í•˜ëŠ” ë°©ì‹ì€ Webhookì— í•´ë‹¹ë©ë‹ˆë‹¤.\nRequired 3 API Event Subscriptionì„ ì‚¬ìš©í•˜ì—¬ Eventë¥¼ ìˆ˜ì‹ ë°›ê³  ì‹¶ë‹¤ë©´ 3ê°€ì§€ API(Callback)ì´ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. ì´ Callbackë“¤ì€ ë¬´ì¡°ê±´ SSLì„ ì‚¬ìš©í•´ì•¼í•˜ë©°, 443 portë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\nRequest Headerì— Twitch-Eventsub-Message-Typeê°€ í¬í•¨ë˜ëŠ”ë°, ì•„ë˜ì˜ 3ê°€ì§€ Notification Typeì„ Valueë¡œ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nwebhook_callback-verification : Callbackìœ¼ë¡œ ë“±ë¡í•œ Event Handlerê°€ êµ¬ë… ìš”ì²­í•œ ì‚¬ëŒì˜ ì†Œìœ ì¸ì§€ ì¦ëª…í•˜ëŠ”ë° ì‚¬ìš©í•©ë‹ˆë‹¤. Event êµ¬ë…ì„ í•˜ë©´, ì²˜ìŒìœ¼ë¡œ ìˆ˜ì‹ ë°›ëŠ” Event ì…ë‹ˆë‹¤. notification : Event ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ Eventë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ì— í•´ë‹¹í•©ë‹ˆë‹¤. revocation : ì–´ë–¤ ì‚¬ìœ ë¡œ, Twitch ì„œë²„ì—ì„œ êµ¬ë…ì„ ì·¨ì†Œí•˜ê²Œ ë˜ë©´ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ìœ ë¥¼ í¬í•¨í•˜ê²Œ ë©ë‹ˆë‹¤. ìœ„ 3ê°œ Typeì˜ Requestê°€ ìœ ì…ë˜ë©´, ëª‡ì´ˆë‚´ì— ì‘ë‹µí•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ë©´ Timeoutìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì§§ì€ ì‹œê°„ì•ˆì— ë§ì€ ì‹¤íŒ¨ê°€ ë°œìƒí•œë‹¤ë©´, Subscription ìƒíƒœëŠ” notification_failures_exceeded ìœ¼ë¡œ ë°”ë€Œê³  TwitchëŠ” Event Subscriptionì„ í•´ì§€í•  ê²ƒì…ë‹ˆë‹¤.\në§Œì•½ ì„œë²„ì—ì„œ ë¹ ë¥¸ ì‹œê°„ì•ˆì— ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤ë©´, ì´ë²¤íŠ¸ë¥¼ ì„ì‹œì €ì¥ì†Œì— ì €ì¥í•˜ê±°ë‚˜ 2XXë¡œ ì‘ë‹µí•œí›„ ì²˜ë¦¬í•˜ëŠ”ê²ƒì„ ê³ ë ¤í•´ì•¼í•©ë‹ˆë‹¤.\nCommon (Verifying the Event Message) í•¸ë“¤ëŸ¬ì—ê²Œ ì „ì†¡ëœ ë©”ì‹œì§€ë¡œ ì–´ë–¤ ì‘ì—…ì„ í•˜ê¸° ì „ì—, ì•…ì˜ë¥¼ ê°€ì§„ì‚¬ëŒì´ ë©”ì‹œë¥¼ ì „ì†¡í•œ ê²ƒì¼ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ë©”ì‹œì§€ê°€ Twitchì—ì„œ ë³´ë‚¸ ê²ƒì¸ì§€ ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë²¤íŠ¸ì— êµ¬ë…í• ë•Œ ì´ë²¤íŠ¸ì— Secretì„ í¬í•¨í•˜ê²Œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. Twitchì—ì„œëŠ” HMAC-SHA256(í•´ì‹œ ê¸°ë°˜ ë©”ì‹œì§€ ì¸ì¦ ì½”ë“œ) ì„œëª…ì„ ìƒì„±í•  ë•Œ Secretì„ í‚¤ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. TwitchëŠ” Twitch-Eventsub-Message-Signature ìš”ì²­ í—¤ë”ì—ì„œ í•¸ë“¤ëŸ¬ì—ê²Œ HMAC ì„œëª…ì„ ì „ë‹¬í•˜ì—¬, ì¸ì¦í•©ë‹ˆë‹¤.\nSecretê³¼ Twitch-Eventsub-Message-Id í—¤ë”, Twitch-Eventsub-Message-Timestamp í—¤ë”, Request Bodyì˜ ê°’ì„ ì—°ê²°í•œ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ HMAC ì„œëª…ì„ ìƒì„±í•©ë‹ˆë‹¤.(ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤)\nTwitch-Eventsub-Message-Signature í—¤ë”ì— Twitchê°€ ì „ì†¡í•œ HMACê³¼ ë‚´ê°€ ë§Œë“  HMACì„ ë¹„êµí•©ë‹ˆë‹¤.\nì„œëª…ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ 4XX ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•´ì•¼í•©ë‹ˆë‹¤.\nì•„ë˜ëŠ” Twitchì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì œê³µí•œ ì„œëª… ìƒì„±ì½”ë“œ ì˜ˆì œì…ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 const crypto = require(\u0026#39;crypto\u0026#39;) // Notification request headers const TWITCH_MESSAGE_ID = \u0026#39;Twitch-Eventsub-Message-Id\u0026#39;.toLowerCase(); const TWITCH_MESSAGE_TIMESTAMP = \u0026#39;Twitch-Eventsub-Message-Timestamp\u0026#39;.toLowerCase(); const TWITCH_MESSAGE_SIGNATURE = \u0026#39;Twitch-Eventsub-Message-Signature\u0026#39;.toLowerCase(); // Prepend this string to the HMAC that\u0026#39;s created from the message const HMAC_PREFIX = \u0026#39;sha256=\u0026#39;; app.use(express.raw({ // Need the raw message body for signature verification type: \u0026#39;application/json\u0026#39; })) . . . let secret = getSecret(); let message = getHmacMessage(req); let hmac = HMAC_PREFIX + getHmac(secret, message); // Signature to compare to Twitch\u0026#39;s if (true === verifyMessage(hmac, req.headers[TWITCH_MESSAGE_SIGNATURE])) { console.log(\u0026#34;signatures match\u0026#34;); // Get JSON object from body, so you can process the message. let notification = JSON.parse(req.body); // Handle notification... } else { console.log(\u0026#39;403\u0026#39;); res.sendStatus(403); } . . . function getSecret() { // TODO: Get your secret from secure storage. This is the secret you passed // when you subscribed to the event. return \u0026#39;\u0026lt;your secret goes here\u0026gt;\u0026#39;; } // Build the message used to get the HMAC. function getHmacMessage(request) { return (request.headers[TWITCH_MESSAGE_ID] + request.headers[TWITCH_MESSAGE_TIMESTAMP] + request.body); } // Get the HMAC. function getHmac(secret, message) { return crypto.createHmac(\u0026#39;sha256\u0026#39;, secret) .update(message) .digest(\u0026#39;hex\u0026#39;); } // Verify whether your signature matches Twitch\u0026#39;s signature. function verifyMessage(hmac, verifySignature) { return crypto.timingSafeEqual(Buffer.from(hmac), Buffer.from(verifySignature)); } ëª¨ë“  Requestì— ëŒ€í•´ì„œ ì´ ê²€ì¦ì‘ì—…ì´ ìˆ˜í–‰ë˜ì–´ì•¼í•©ë‹ˆë‹¤. ë³´ì•ˆìƒìœ¼ë¡œ ì¤‘ìš”í•œ ì´ìŠˆì´ê¸° ë•Œë¬¸ì—, ì˜ ë§Œë“¤ì–´ ì£¼ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.\nResponding to Challenge Request ì´ë²¤íŠ¸ë¥¼ ì •ê¸°êµ¬ë…í•˜ë©´ TwitchëŠ” ìš”ì²­ì— ì§€ì •ëœ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì†Œìœ í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ Authentification Challengeë¥¼ ë³´ëƒ…ë‹ˆë‹¤.\nì±Œë¦°ì§€ ë©”ì‹œì§€ëŠ” Twitch-Eventsub-Message-Type í—¤ë”ë¥¼ webhook_callback_verificationìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 Twitch-Eventsub-Message-Type: webhook_callback_verification ìš”ì²­ ë³¸ë¬¸ì˜ challenge í•„ë“œì—ëŠ” ì‘ë‹µí•´ì•¼ í•˜ëŠ” challenge ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { \u0026#34;challenge\u0026#34;: \u0026#34;pogchamp-kappa-360noscope-vohiyo\u0026#34;, \u0026#34;subscription\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;f1c2a387-161a-49f9-a165-0f21d7a4e1c4\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;webhook_callback_verification_pending\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;channel.follow\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cost\u0026#34;: 1, \u0026#34;condition\u0026#34;: { \u0026#34;broadcaster_user_id\u0026#34;: \u0026#34;12826\u0026#34; }, \u0026#34;transport\u0026#34;: { \u0026#34;method\u0026#34;: \u0026#34;webhook\u0026#34;, \u0026#34;callback\u0026#34;: \u0026#34;https://example.com/webhooks/callback\u0026#34; }, \u0026#34;created_at\u0026#34;: \u0026#34;2019-11-16T10:11:12.634234626Z\u0026#34; } } ì‘ë‹µì€ 200 ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•´ì•¼ í•˜ë©°, Response Headerì— Content-Type: text/plainì´ í¬í•¨ë˜ì–´ì•¼ í•˜ê³  Response BodyëŠ” challengeë§Œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ì„±ê³µí•˜ë©´ êµ¬ë…ì´ í™œì„±í™”ëœ ê²ƒì…ë‹ˆë‹¤.\nì„œë²„ì—ì„œ ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì›¹ í”„ë ˆì„ì›Œí¬ê°€ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë‹µì„ ìˆ˜ì •í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”.\nProcessing an event ì •ê¸°êµ¬ë…í•œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ TwitchëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ê°€ í¬í•¨ëœ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì´ë²¤íŠ¸ ì²˜ë¦¬ìì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤. ì•Œë¦¼ ë©”ì‹œì§€ëŠ” Twitch-Eventsub-Message-Type í—¤ë”ë¥¼ ì•Œë¦¼ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Twitch-Eventsub-Message-Type: notification ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nRequest bodyì—ëŠ” subscriptionì™€ eventì— ì •ë³´ê°€ í¬í•¨ë˜ì–´ìˆìŠµë‹ˆë‹¤.\nsubscription.type í•„ë“œëŠ” ì´ë²¤íŠ¸ ìœ í˜•ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nevent í•„ë“œì—ëŠ” êµ¬ë…í•œ ì´ë²¤íŠ¸ íƒ€ì…ì—ì„œ ì‹¤ì œë¡œ ë°œìƒí•œ ì´ë²¤íŠ¸ì˜ ë°ì´í„°ê°€ í¬í•¨ë©ë‹ˆë‹¤.\nì•„ë˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \u0026#34;subscription\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;f1c2a387-161a-49f9-a165-0f21d7a4e1c4\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;enabled\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;channel.follow\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;cost\u0026#34;: 1, \u0026#34;condition\u0026#34;: { \u0026#34;broadcaster_user_id\u0026#34;: \u0026#34;12826\u0026#34; }, \u0026#34;transport\u0026#34;: { \u0026#34;method\u0026#34;: \u0026#34;webhook\u0026#34;, \u0026#34;callback\u0026#34;: \u0026#34;https://example.com/webhooks/callback\u0026#34; }, \u0026#34;created_at\u0026#34;: \u0026#34;2019-11-16T10:11:12.634234626Z\u0026#34; }, \u0026#34;event\u0026#34;: { \u0026#34;user_id\u0026#34;: \u0026#34;1337\u0026#34;, \u0026#34;user_login\u0026#34;: \u0026#34;awesome_user\u0026#34;, \u0026#34;user_name\u0026#34;: \u0026#34;Awesome_User\u0026#34;, \u0026#34;broadcaster_user_id\u0026#34;: \u0026#34;12826\u0026#34;, \u0026#34;broadcaster_user_login\u0026#34;: \u0026#34;twitch\u0026#34;, \u0026#34;broadcaster_user_name\u0026#34;: \u0026#34;Twitch\u0026#34;, \u0026#34;followed_at\u0026#34;: \u0026#34;2020-07-15T18:16:11.17106713Z\u0026#34; } } ì‘ë‹µì€ 2XX ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.\nì´ë²¤íŠ¸ ì²˜ë¦¬ì— 1~2ì´ˆ ì´ìƒ ê±¸ë¦¬ëŠ” ê²½ìš° ì´ë²¤íŠ¸ë¥¼ ì„ì‹œ ì €ì¥ì†Œì— ì“°ê³  2XXë¡œ ì‘ë‹µí•œ í›„ ì•Œë¦¼ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\në„ˆë¬´ ë§ì´ ë¹ ë¥´ê²Œ ì‘ë‹µí•˜ì§€ ì•Šìœ¼ë©´ ì •ê¸°êµ¬ë… ìƒíƒœê°€ notification_failures_exceededë¡œ ë³€ê²½ë˜ê³  Twitchì—ì„œ êµ¬ë…ì„ ì·¨ì†Œí•´ë²„ë¦½ë‹ˆë‹¤.\nì´ë²¤íŠ¸ ë°œìƒì‹œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì€ ì´ ë¶€ë¶„ì— Requestë¥¼ ì²˜ë¦¬í•˜ë©° í¬í•¨í•˜ë©´ ë©ë‹ˆë‹¤.\nRevoking your subscription ì •ê¸°êµ¬ë…ì€ ë§Œë£Œë˜ì§€ ì•Šì§€ë§Œ TwitchëŠ” ì •ê¸°êµ¬ë…ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. TwitchëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì— ì •ê¸°êµ¬ë…ì„ ì·¨ì†Œí•©ë‹ˆë‹¤\nì •ê¸°êµ¬ë…ì— ì–¸ê¸‰ëœ ìœ ì €ê°€ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°. ì•Œë¦¼ ìƒíƒœê°€ user_removedë¡œ ì„¤ì •ëœ ê²½ìš°. ì‚¬ìš©ìê°€ ì¸ì¦ í† í°ì„ í•´ì§€í–ˆê±°ë‚˜ ë‹¨ìˆœíˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•œ ê²½ìš°. ì•Œë¦¼ì˜ ìƒíƒœê°€ authorization_revokedë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì½œë°±ì´ ì ì‹œì— ì‘ë‹µí•˜ì§€ ì•Šì€ íšŸìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì•Œë¦¼ì˜ ìƒíƒœê°€ ì•Œë¦¼_ì‹¤íŒ¨_ì´ˆê³¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. êµ¬ë…í•œ êµ¬ë… ìœ í˜• ë° ë²„ì „ì´ ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•Œë¦¼ì˜ ìƒíƒœê°€ version_removedë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. TwitchëŠ” ì–¸ì œë“ ì§€ ì •ê¸°êµ¬ë…ì„ ì·¨ì†Œí•  ìˆ˜ ìˆëŠ” ê¶Œë¦¬ë¥¼ ë³´ìœ í•©ë‹ˆë‹¤. í•´ì§€ ë©”ì‹œì§€ëŠ” Twitch-Eventsub-Message-Type í—¤ë”ë¥¼ revocationë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 Twitch-Eventsub-Message-Type: revocation ìš”ì²­ ë³¸ë¬¸ì˜ status í•„ë“œì—ëŠ” Twitchê°€ ì •ê¸°êµ¬ë…ì„ ì·¨ì†Œí•œ ì´ìœ ê°€ í‘œì‹œë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;subscription\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;f1c2a387-161a-49f9-a165-0f21d7a4e1c4\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;authorization_revoked\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;channel.follow\u0026#34;, \u0026#34;cost\u0026#34;: 1, \u0026#34;version\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;condition\u0026#34;: { \u0026#34;broadcaster_user_id\u0026#34;: \u0026#34;12826\u0026#34; }, \u0026#34;transport\u0026#34;: { \u0026#34;method\u0026#34;: \u0026#34;webhook\u0026#34;, \u0026#34;callback\u0026#34;: \u0026#34;https://example.com/webhooks/callback\u0026#34; }, \u0026#34;created_at\u0026#34;: \u0026#34;2019-11-16T10:11:12.634234626Z\u0026#34; } } ì‘ë‹µì€ 2XX ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.\nTesting your Handler Twitchì˜ ëª…ë ¹ì¤„ ì¸í„°í˜ì´ìŠ¤(CLI)ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ ëª…ë ¹ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì€ SSLì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë©°, ì†ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në„ì „ ì´ë²¤íŠ¸(Testing Challenge events) ì•Œë¦¼ ì´ë²¤íŠ¸(Testing notification events) Testing challenge Events ì´ë²¤íŠ¸ì— ê°€ì…í•˜ë©´ TwitchëŠ” ìš”ì²­ì— ì§€ì •ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬ìì—ê²Œ webhook_callback-verification ì•Œë¦¼ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´, Event Handlerë¥¼ ì†Œìœ í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.\në‹¤ìŒ CLI ì˜ˆì œëŠ” Challenge Eventì— ëŒ€í•œ ì‘ë‹µì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.\nì‹¤í–‰í•˜ê¸° ì „ì— -F í”Œë˜ê·¸ì˜ ê°’ì„ í•¸ë“¤ëŸ¬ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ë³€ê²½í•˜ê³  -s í”Œë˜ê·¸ì˜ ê°’ì„ ë¹„ë°€ë¡œ ë³€ê²½í•˜ì„¸ìš”.\në¹„ë°€ í”Œë˜ê·¸ëŠ” ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ í•­ìƒ ì§€ì •í•´ì•¼ í•¸ë“¤ëŸ¬ì—ì„œ ë©”ì‹œì§€ê°€ Twitchì—ì„œ ì™”ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë¶€ë¶„ì´ ì‘ë™í•©ë‹ˆë‹¤.\nê·¸ëŸ° ë‹¤ìŒ í„°ë¯¸ë„ ì°½ì„ ì—´ê³  ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.\n1 twitch event verify-subscription subscribe -F http://localhost:8080/eventsub/ -s 5f1a6e7cd2e7137ccf9e15b2f43fe63949eb84b1db83c1d5a867dc93429de4e4 ëª¨ë“  ì‘ì—…ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜í–‰í–ˆë‹¤ë©´ ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\n1 2 âœ” Valid response. Received challenge 5e784545-5a59-a05a-6ae6-cfaf260532f1 in body âœ” Valid status code. Received status 200 verify-subscription í•˜ìœ„ ëª…ë ¹ ì‚¬ìš©ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì´ë²¤íŠ¸ ì²˜ë¦¬ê¸°ì˜ ì±Œë¦°ì§€ ì‘ë‹µ í™•ì¸í•˜ê¸°ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.\nTesting notification events íŠ¸ë¦¬ê±° í•˜ìœ„ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ëª¨ì˜ ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ëª…ë ¹ì˜ ì¸ìˆ˜ëŠ” íŠ¸ë¦¬ê±°í•  ì´ë²¤íŠ¸ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.\nì‹¤í–‰í•˜ê¸° ì „ì— -F í”Œë˜ê·¸ì˜ ê°’ì„ í•¸ë“¤ëŸ¬ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ë³€ê²½í•˜ê³  -s í”Œë˜ê·¸ì˜ ê°’ì„ ì‹œí¬ë¦¿ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”.\në¹„ë°€ í”Œë˜ê·¸ëŠ” ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ í•­ìƒ ì§€ì •í•´ì•¼ í•¸ë“¤ëŸ¬ì—ì„œ ë©”ì‹œì§€ê°€ Twitchì—ì„œ ì™”ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë¶€ë¶„ì´ ì‘ë™í•©ë‹ˆë‹¤.\nê·¸ëŸ° ë‹¤ìŒ í„°ë¯¸ë„ ì°½ì„ ì—´ê³  ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.\n1 twitch event trigger subscribe -F http://localhost:8080/eventsub/ -s 5f1a6e7cd2e7137ccf9e15b2f43fe63949eb84b1db83c1d5a867dc93429de4e4 Conclusion Twtich EventSubscriptionì„ ì–´ë–»ê²Œ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ì§€, ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í•´ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. Twitch ê³µì‹ë¬¸ì„œì— ì˜ ì„¤ëª… ë˜ì–´ìˆê¸°ë•Œë¬¸ì—, ë§ë¶™ì¼ ë‚´ìš©ì´ ë§ì§„ ì•Šì•˜ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì²˜ìŒë³´ëŠ” ì‚¬ëŒìœ¼ë¡œì„œ ì–´ë–¤ ìˆœì„œë¡œ ì‚¬ìš©í•˜ëŠ”ì§€, ì–´ë–¤ ìš©ë„ë¡œ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ê±´ì§€ íŒŒì•…í•˜ê¸° í˜ë“¤ì–´ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤. (ê²½í—˜ì´ ë¶€ì¡±í•œê²ƒì¼ìˆ˜ë„ìˆê² ì§€ë§Œìš”\u0026hellip;)\në‹¤ë¥¸ ë¶„ë“¤ê»˜ ë„ì›€ì´ ë˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\nReference Twitch Event Subscription ê³µì‹ë¬¸ì„œ : https://dev.twitch.tv/docs/eventsub/handling-webhook-events/ ","date":"2023-04-09T14:34:00+09:00","permalink":"https://korcasus.github.io/p/twitch-eventsub/","title":"Twitch Eventsub"},{"content":"How to Build Fat Jar Build Toolì„ ì–´ë–¤ ì¢…ë¥˜ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ì— ë”°ë¼ ë°©ë²•ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\nMavenì€ maven-assembly-plugin\nGradle Shadow Plugin ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.\nëŒ€ë¶€ë¶„ì€ ìœ„ì˜ 2ê°œ Pluginì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ë©´ í•´ê²°ë˜ì§€ë§Œ, Spring BootëŠ” êµ¬ë™ë°©ì‹ì´ ë‹¬ë¼ì„œ, ë³„ë„ì˜ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.\nBoot-Jar Springì—ì„œ ê³µì‹ì ìœ¼ë¡œ ê¶Œì¥í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.\nì„¤ëª…ì— ë”°ë¥´ë©´ JavaëŠ” nested-jaríŒŒì¼ì„ loadí•˜ëŠ” ë°©ë²•ì„ ì œê³µí•˜ì§€ì•ŠìŠµë‹ˆë‹¤. ì´ë•Œë¬¸ì— ì••ì¶• í’€ì§€ì•Šê³ , ì‹¤í–‰í•´ì•¼í•˜ëŠ” í™˜ê²½ì´ë¼ë©´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ ë•Œë¬¸ì— Shaded Jar(Fat Jar)ë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. ëª¨ë“  JarsíŒŒì¼ë¡œë¶€í„° ëª¨ë“  Classë¥¼ ëª¨ì•„ì„œ Pacakageí•˜ì—¬ í•˜ë‚˜ì˜ JaríŒŒì¼ë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.\nì‹¤ì œë¡œ Applicationì— ì¡´ì¬í•˜ëŠ” libraryë¥¼ ë³´ê¸°ì— í˜ë“¤ì–´ì§€ê¸°ë•Œë¬¸ì—, Springì€ ë‹¤ë¥¸ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.\nì–´ë–¤ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆëŠ”ì§€ê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ ìƒì„¸í•œ ë‚´ìš©ì€ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.\nConfiguration 1. Module ì¶”ê°€ implementation 'org.springframework.boot:spring-boot-loader'\nìœ„ì˜ ëª¨ë“ˆì€ Spring boot ë¥¼ Excutable Jar ë˜ëŠ” Warë¡œ ë§Œë“¤ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.\n2. Manifest ë³€ê²½ JarLauncherë¥¼ í†µí•´ ì‹¤í–‰ë˜ì–´ì•¼í•˜ê¸° ë•Œë¬¸ì—, Manifest ë³€ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.\nMETA-INF/MANIFEST.MF ì— ë‚´ìš©ì´ ì¡´ì¬í•˜ëŠ”ë°. Buildí•˜ë©° ê¸°ë¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\nê³µì‹ë¬¸ì„œì—ëŠ” ì•„ë˜ì™€ê°™ì´ ê°€ì´ë“œ í•˜ê³  ìˆìŠµë‹ˆë‹¤.\n1 2 Main-Class: org.springframework.boot.loader.JarLauncher Start-Class: com.mycompany.project.MyApplication ì €ì˜ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 jar { manifest { attributes \u0026#34;Main-Class\u0026#34;: \u0026#34;org.springframework.boot.loader.JarLauncher\u0026#34; attributes \u0026#34;Start-Class\u0026#34;: \u0026#34;com.mycompany.team.batch.SparkSpringBatchClient\u0026#34; } } ë¬¸ì œì  java -jar xxx.jar ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•  ê²½ìš°, ì •ìƒë™ì‘í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ Sparkì—ì„œ ì‹¤í–‰í•  ê²½ìš°, ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.\nì´ìœ ëŠ” Dependency version ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.\nì¬ì§ì¤‘ì¸ íšŒì‚¬ì—ì„œ ìš´ì˜ì¤‘ì¸ SparkëŠ” 2.4ë²„ì „ì„ ì‚¬ìš© ì¤‘ì¸ë°, ì—¬ê¸°ì— í¬í•¨ë˜ì–´ìˆëŠ” gson ë²„ì „ì´ Applicationì—ì„œ ì‚¬ìš©í•´ì•¼í•  ë²„ì „ë³´ë‹¤ ë‚®ì•˜ìŠµë‹ˆë‹¤. ì´ë•Œë¬¸ì— êµ¬ë²„ì „ì˜ Gsonìœ¼ë¡œ ì‚¬ìš©ë˜ë©´ì„œ Applicationêµ¬ë™ ì‹¤íŒ¨ í•˜ì˜€ìŠµë‹ˆë‹¤.\nê°•ì œë¡œ ìµœì‹ ë²„ì „ì˜ Gsonì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ì•ˆì„ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.\nì²«ë²ˆì§¸ë¡œëŠ” ì‚¬ìš©í•  Dependencyë²„ì „ì„ ëª…ì‹œí•˜ëŠ” ë°©ë²•ì´ì˜€ìŠµë‹ˆë‹¤.\n(ì°¸ê³ ë¡œ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ì•Šì•„ë„ ë¹„êµì  ìµœì‹  gsonì„ ì‚¬ìš©í•©ë‹ˆë‹¤.) í•˜ì§€ë§Œ sparkì— ë‚´ì¥ë˜ì–´ìˆëŠ” libraryë¥¼ ìš°ì„ ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ë•Œë¬¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.\në‘ë²ˆì§¸ ë°©ë²•ì€ Sparkê³µì‹ë¬¸ì„œì—ì„œ ì œê³µí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. (ì°¸ê³ )\nspark.driver.userClassPathFirst\nspark.executor.userClassPathFirst\nìœ„ì˜ 2ê°œ ë³€ìˆ˜ëŠ” ê¸°ë³¸ê°’ì´ Falseë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.\në¬¸ì„œì— ë”°ë¥´ë©´, ì‚¬ìš©ìê°€ ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€í•œ --jars ë¥¼ ìš°ì„ ì‹œ ì‚¬ìš©í•œë‹¤ê³  ë˜ì–´ìˆìŠµë‹ˆë‹¤.\nì‹œí—˜ ê¸°ëŠ¥ì¸ ë¬¸ì œë„ ìˆê³ , ì¶”ê°€í•´ì•¼í•  jarì´ ì¦ê°€í•˜ë©´ ê´€ë¦¬í•  í¬ì¸íŠ¸ê°€ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•˜ì§€ë„ ì•Šì•˜ê³ , ì˜ë„í–ˆë˜ ë°”ê°€ ì•„ë‹ˆë¼ ë”ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì´ë¥¼ í•´ê²°í•˜ë ¤ë©´ relocate(ì„ì˜ë¡œ ì´ë¦„ë³€ê²½?)ì„ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ë°, Shadow Pluginì—ì„œëŠ” ì§€ì›í•©ë‹ˆë‹¤.\nShadow Plugin í”„ë¡œì íŠ¸ ë‚´ì— ìˆëŠ” Dependency Classsì™€ Resourceë¥¼ í•˜ë‚˜ì˜ Jarë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.\nì´ë¡œ ì¸í•´ ì–»ì„ìˆ˜ ìˆëŠ” ì¥ì ì€ 2ê°€ì§€ì…ë‹ˆë‹¤.\nì‹¤í–‰ê°€ëŠ¥í•œ Jarë°°í¬ë¥¼ ë§Œë“ ë‹¤. Libraryì— ìˆëŠ” ê³µí†µ Dependencyë¥¼ bundling, relocatingí•˜ì—¬ classpath conflictë¥¼ íšŒí”¼í•œë‹¤. ì¥ì ì„ ì¢€ë” ì˜ í’€ì–´ì“´ê¸€ì„ ì°¸ê³ í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\nAdd Option For Spring Shadow Pluginìœ¼ë¡œ Spring Applicationì„ Buildí•˜ë ¤ë©´ ì¶”ê°€ ì˜µì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.\nì•„ë˜ì˜ ë‚´ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import com.github.jengelman.gradle.plugins.shadow.transformers.* shadowJar { // Required for Spring mergeServiceFiles() append \u0026#39;META-INF/spring.handlers\u0026#39; append \u0026#39;META-INF/spring.schemas\u0026#39; append \u0026#39;META-INF/spring.tooling\u0026#39; transform(PropertiesFileTransformer) { paths = [\u0026#39;META-INF/spring.factories\u0026#39; ] mergeStrategy = \u0026#34;append\u0026#34; } } ìƒì„¸í•œ ë‚´ìš©ì€ Git Issueë¥¼ ì½ì–´ë³´ë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nRelocating Packages Classpathì— ë™ì¼í•œ Dependencyê°€ ì¡´ì¬í•˜ì—¬, ì˜ë„í•˜ê³ ìí•œ ë²„ì „ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì¼ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. Hadoop, Sparkì—ì„œ ë¹ˆë²ˆíˆ ë°œìƒí•©ë‹ˆë‹¤.\nì´ ì•„ì´ë””ì–´ëŠ” ê°„ë‹¨í•©ë‹ˆë‹¤. ì¶©ëŒë‚˜ëŠ” Dependencyë¥¼ Projectì—ì„œ ì°¾ì•„ë‚¸ë’¤, ì´ë¦„(ê²½ë¡œ)ì„ ë°”ê¿”ì¤ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë¦„ì˜ Dependencyë¥¼ ì‚¬ìš©í•˜ê¸°ë•Œë¬¸ì— ë¬¸ì œê°€ ìƒê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤.\nêµ¬í˜„ë°©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.\n1 2 3 4 // Relocating a Package shadowJar { relocate \u0026#39;junit.framework\u0026#39;, \u0026#39;shadow.junit\u0026#39; } juni.frameworkë¥¼ shadow.junit ìœ¼ë¡œ ë³€ê²½í•´ ì¤ë‹ˆë‹¤.\ní•„ìš”ì— ë§ê²Œ ì•„ë˜ì²˜ëŸ¼ ì ìš©í•©ë‹ˆë‹¤.\n1 2 relocate \u0026#39;com.google.gson\u0026#39;, \u0026#39;shadow.google.gson\u0026#39; relocate \u0026#39;com.fasterxml.jackson\u0026#39;, \u0026#39;shadow.fasterxml.jackson\u0026#39; Shadow Pluginì—ì„œ relocationì„ ì‚´í´ë³´ê³ ì‹¶ë‹¤ë©´ ë§í¬ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.\nClasspath ë³€ê²½ ì‚¬ì‹¤ ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ê³  ë‚˜ì„œ, ì˜ ì‹¤í–‰í•˜ëŠ”ê²ƒì„ ê¸°ëŒ€í–ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ java -jar project-all.jar ë¡œ ì‹¤í–‰í•´ë³´ë©´, ì´ìƒí•¨ì„ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Springìì²´ëŠ” ì‹¤í–‰ë˜ì—ˆì§€ë§Œ, Main Applicationì´ ì‹¤í–‰ë˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì°¾ì•„ë³´ë‹ˆ, ì›ì¸ì„ ì•Œê¸° ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\në‹¤í–‰íˆ try and error ê±°ì¹˜ë©° ì•Œì•„ëƒˆëŠ”ë°, ì•„ë˜ì˜ ë§í¬ì™€ ê´€ë ¨ìˆì—ˆìŠµë‹ˆë‹¤. https://imperceptiblethoughts.com/shadow/configuration/dependencies/\nê¸°ë³¸ìœ¼ë¡œ runtimeClassPathë§Œ í¬í•¨ë˜ì„œ Buildë˜ì—ˆê³ , ì•„ë˜ì²˜ëŸ¼ compileClassPathë¥¼ í¬í•¨í•˜ë‹ˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.\n1 configurations = [project.configurations.compileClasspath, project.configurations.productionRuntimeClasspath] ë¬¸ì œí•´ê²°ì´ ìš°ì„ ì´ë¼, ì™œ compileClassPathë„ í¬í•¨í•´ì•¼ë§Œ ì •ìƒë™ì‘í•˜ëŠ”ì§€ëŠ” í™•ì¸í•´ë³´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nConclusion Springì„ ì‚¬ìš©í• ë•Œ, ì–´ë–»ê²Œ Fat Jar(Shaded Jar)ì„ ë¹Œë“œí•  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.\nBoot-Jarì€ ìŠ¤í”„ë§ì—ì„œ ê¶Œì¥í•˜ëŠ” ë°©ë²•ì´ê³  ê°„ë‹¨í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, Dependency ì¶©ëŒí•˜ëŠ” ìƒí™©ì´ë¼ë©´ í•´ê²°í• ê¸° ì–´ë µë‹¤ëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\nì´ëŸ°ê²½ìš°ëŠ” í•˜ë‘¡ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²½ìš°ì— í•´ë‹¹ë©ë‹ˆë‹¤.\nShadow Pluginì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ìŠ¤í”„ë§ì— ì ìš©í•˜ë ¤ë©´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€ë¡œ ì‘ì„±í•´ì£¼ì–´ì•¼ í•˜ì§€ë§Œ, Boot-Jarì—ì„œ ê²ªì—ˆë˜ ë¬¸ì œë¥¼ íšŒí”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nSparkë‚˜ í•˜ë‘¡ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²½ìš°ë¼ë©´ Shadow Pluginì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ì™€ ê°™ì€ ë¬¸ì œë¥¼ ë¶€ë”ªíŒ ìƒí™©ì´ ì•„ë‹ˆë¼ë©´, ë³¸ì¸ì˜ ìƒí™©ì— ë§ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\nReference Spring Official Guide : https://docs.spring.io/spring-boot/docs/current/reference/html/executable-jar.html#appendix.executable-jar.alternatives ê³µì‹ë¬¸ì„œ ë²ˆì—­ Article : https://wordbe.tistory.com/entry/Spring-Boot-2-Executable-JAR-ìŠ¤í”„ë§-ë¶€íŠ¸-ì‹¤í–‰ Spring fat jar Git Issue for shadow plugin : https://github.com/spring-projects/spring-boot/issues/1828#issuecomment-231104288 ì „ë°˜ì ì¸ ì´í•´ì— ë„ì›€ì„ ì£¼ì—ˆë˜ StackOverflow : https://stackoverflow.com/questions/51206959/classnotfound-when-submit-a-spring-boot-fat-jar-to-spark ","date":"2023-02-20T23:16:51+09:00","permalink":"https://korcasus.github.io/p/spring-fat-jar-for-spark/","title":"Spring Fat-jar for Spark"},{"content":"ê°œìš” ì•ì„œ ì„¤ëª…í•´ì™”ë˜ ë‚´ìš©ê³¼ëŠ” ë°˜ëŒ€ë¡œ Hiveì—ì„œ Kafkaì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” ê³¼ì •ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nKafka ì…ì¥ì—ì„œëŠ” Hiveê°€ Producer ì—­í• ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.\në‹¨ì  Hiveì—ì„œ Kafkaë¡œ ì „ì†¡í• ë•Œ í•„ìˆ˜ì ì¸ ê¸°ëŠ¥ë“¤ì€ ì œê³µí•˜ë‹¤ë³´ë‹ˆ, ì¼ë°˜ì ì¸ ê²½ìš°ì—ëŠ” ì‚¬ìš©í•˜ëŠ”ë° ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì¼ë¶€ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ì•ŠëŠ”ë°, ê·¸ ì¤‘ í•˜ë‚˜ê°€ Headerì…ë‹ˆë‹¤.\nHeaderë„ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ë©´, Hive ë§ê³  ë‹¤ë¥¸ Applicationì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\nKafkaWritable Kafka Record ê³µì‹ë¬¸ì„œ kafka metadata ì£¼ì˜ì‚¬í•­ Producerì—ì„œ Kafkaë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í• ë•ŒëŠ” ë©”íƒ€ ë°ì´í„°ë“¤ì„ í¬í•¨ì‹œì¼œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní¬í•¨ì‹œí‚¤ì§€ ì•Šì„ ê²½ìš°, Kafkaì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\nHiveì—ì„œë„ ë§ˆì°¬ê°€ì§€ ì…ë‹ˆë‹¤. __timestamp, __partition, __offsetì€ kafkaì—ì„œ ê¸°ë¡í•˜ëŠ” ì •ë³´ì´ë¯€ë¡œ ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•˜ë©´ Kafkaì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n__timestamp : -1 __partition : null __offset : -1 í•˜ì§€ë§Œ __keyëŠ” ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°’ì˜ ë²”ìœ„ëŠ” í•œì •ì ì´ë‹¤ë³´ë‹ˆ ì„ íƒì§€ê°€ ì œí•œì ì´ì§€ë§Œ, ì‹ ì¤‘í•˜ê²Œ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\nKafkaëŠ” keyë¥¼ partitionì„ ê²°ì •í•˜ëŠ”ë° ì‚¬ìš©í•˜ë¯€ë¡œ ë©”ì‹œì§€ ë¶„ì‚°ì— ì˜í–¥ì„ ë¯¸ì¹ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  cleanup.policy ì„¤ì •ê°’ì— ë”°ë¼ key í™œìš©ì—¬ë¶€ê°€ ê²°ì •ë©ë‹ˆë‹¤.\nKafkaì—ì„œ keyê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼í•œ partitionì— ë„£ì–´ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ê³  ìˆìœ¼ë©° , log.cleanup.policy = compact ë¡œ ì„¤ì •í• ê²½ìš° keyë¥¼ í™œìš©í•˜ê¸° ë•Œë¬¸ì— byte arrayë¡œ ë„£ì–´ì£¼ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.\nInteger to byte array : cast(cast(1 AS STRING) AS BINARY) String to byte array : cast(\u0026lsquo;1\u0026rsquo; AS BINARY) JSON í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ JSON í¬ë§· ë©”ì‹œì§€ë¥¼ Kafkaì— ì „ì†¡í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\ní† í”½ ìƒì„± í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì €ì¥í•´ë‘˜ í† í”½ì„ ìƒì„±í•©ë‹ˆë‹¤.\nì•„ë˜ì˜ ì˜ˆì‹œëŠ” Kafka ì„¤ì¹˜ì‹œ í•¨ê»˜ ì œê³µë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ topicì„ ë§Œë“­ë‹ˆë‹¤.\n./kafka-topics.sh --create --topic \u0026quot;${í† í”½í† í”½}\u0026quot; --replication-factor 1 --partitions 1 --bootstrap-server \u0026quot;{ì„œë²„ì„œë²„}\u0026quot;\ní…Œì´ë¸” ìƒì„± Kafkaì— ì „ì†¡í•  topicì„ ë§Œë“¤ì–´ë³´ì•˜ìœ¼ë‹ˆ, ì´ì œëŠ” ì‹¤ì œ ì „ì†¡ì—­í• ì„ ìˆ˜í–‰í•´ì¤„ tableì„ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. Kafka Handlerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ KafkaStorageHandlerë¥¼ ì§€ì •í•´ì¤ë‹ˆë‹¤.\nTBLPROPERTIESì—ëŠ” ì•ì„œ ì„¤ëª…ë“œë ¸ë˜ ê¸€ê³¼ ë¹„ìŠ·í•˜ê²Œ ì§„í–‰í•©ë‹ˆë‹¤.\në‹¤ë§Œ, ë©”ì‹œì§€ ì „ì†¡í•˜ëŠ” ì—­í• ì´ë‹ˆ consumerê°€ ì•„ë‹Œ producerë¡œ ì§€ì •í•´ì¤ë‹ˆë‹¤.\nì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 CREATE EXTERNAL TABLE test_export_to_kafka( `id` STRING, `value` STRING ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES( \u0026#34;kafka.serde.class\u0026#34; = \u0026#34;org.apache.hadoop.hive.serde2.JsonSerDe\u0026#34;, \u0026#34;kafka.topic\u0026#34; = \u0026#34;${í† í”½í† í”½}\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;${ì„œë²„ì„œë²„}\u0026#34;, \u0026#34;kafka.producer.security.protocol\u0026#34; = \u0026#34;PLAINTEXT\u0026#34; ); í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡ ë§Œë“¤ì–´ì¤€ í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í…Œì´ë¸”ì— ëª…ì‹œí•œ ì»¬ëŸ¼ì¸ id, valueì— ëŒ€í•œ ê°’ì„ í•„ìˆ˜ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ê·¸ ì™¸ì—ëŠ” Kafka MetataData ì´ë©° key, partition, offset, timestamp ìˆœì„œëŒ€ë¡œ ìƒê°í•˜ê³  ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\ninsert into test_export_to_kafka values ('1', '1', null, null, -1, -1);\nONLY LONG TYPE í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì´ë²ˆì—ëŠ” JSONì´ ì•„ë‹Œ PLAIN TEXT Formatìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•´ë³´ë„ë¡í•˜ê² ìŠµë‹ˆë‹¤.\ní† í”½ ìƒì„± ì•ì„œ ì„¤ëª…ë“œë ¸ë˜ JSON í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤.\ní…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì €ì¥í•´ë‘˜ í† í”½ì„ ìƒì„±í•©ë‹ˆë‹¤.\nì•„ë˜ì˜ ì˜ˆì‹œëŠ” Kafka ì„¤ì¹˜ì‹œ í•¨ê»˜ ì œê³µë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ topicì„ ë§Œë“­ë‹ˆë‹¤.\n./kafka-topics.sh --create --topic \u0026quot;${í† í”½í† í”½}\u0026quot; --replication-factor 1 --partitions 1 --bootstrap-server \u0026quot;{ì„œë²„ì„œë²„}\u0026quot;\ní…Œì´ë¸” ìƒì„± Kafka Handlerì™€ TBLPROPERTIESëŠ” ì•ì„œ ì„¤ëª…ë“œë ¸ë˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.\në‹¤ë§Œ ì´ë²ˆì—” PLAIN TEXT Formatì¸ ë§Œí¼, ì»¬ëŸ¼ì€ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ ì£¼ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 CREATE EXTERNAL TABLE test_export_to_kafka_long( id bigint ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES( \u0026#34;kafka.serde.class\u0026#34; = \u0026#34;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\u0026#34;, \u0026#34;kafka.topic\u0026#34; = \u0026#34;${í† í”½í† í”½}\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;${ì„œë²„ì„œë²„}\u0026#34;, \u0026#34;kafka.producer.security.protocol\u0026#34; = \u0026#34;PLAINTEXT\u0026#34; ); í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡ ë§Œë“¤ì–´ë‘” í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\ní…Œì´ë¸”ì— ëª…ì‹œí•œ ì»¬ëŸ¼ì¸ idì— ëŒ€í•œ ê°’ì„ í•„ìˆ˜ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ê·¸ ì™¸ì—ëŠ” Kafka MetaDataì— ëŒ€í•œ ì •ë³´ë¡œ ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ì¶”ê°€í•´ì¤ë‹ˆë‹¤. insert into test_export_to_kafka_long values (1, null, null, -1, -1);\në™ì¼í•œ keyë¥¼ ê°€ì§„ ë©”ì‹œì§€ê°€ ë™ì¼í•œ partitionì— ë“¤ì–´ê°€ëŠ” í…ŒìŠ¤íŠ¸ Producerë¡œ ì‚¬ìš©í•  Applicationì„ ë§Œë“¤ë•Œ ë³´ë©´, Kafkaì— ì „ì†¡í•  Messageê°€ ì–´ë–¤ Partitionì— ì €ì¥ë ì§€ Partitionerë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ Hiveì—ì„œëŠ” ë³„ë„ë¡œ Partitionerë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nDefault Partitionerë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒìœ¼ë¡œ ìƒê°í•˜ê³  ì§„í–‰í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.\nMessageì˜ Keyê°€ ë™ì¼í•˜ë‹¤ë©´, ë™ì¼í•œ Partitionì— ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ Hiveë¥¼ í†µí•´ ì „ì†¡í•´ë³´ëŠ” ê²ƒì€ ì²˜ìŒì´ê¸° ë•Œë¬¸ì— ë™ì¼í•œ Partitionì— ì „ì†¡ë˜ëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•˜ì˜€ìŠµë‹ˆë‹¤.\nì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\nê°ê¸° ë‹¤ë¥¸ Keyë¥¼ ê°€ì§„ ì—¬ëŸ¬ê°œì˜ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ ë’¤, ì•ì„œ ë³´ë‚¸ ë©”ì‹œì§€ì™€ ë™ì¼í•œ Keyë¥¼ ê°€ì§€ì§€ë§Œ ë‹¤ë¥¸ ë‚´ìš©ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.\nìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ì˜ ì¿¼ë¦¬ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 CREATE EXTERNAL TABLE test_export_to_kafka_partition( id INT, value STRING ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES( \u0026#34;kafka.serde.class\u0026#34; = \u0026#34;org.apache.hadoop.hive.serde2.JsonSerDe\u0026#34;, \u0026#34;kafka.topic\u0026#34; = \u0026#34;${í† í”½í† í”½}\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;${ì„œë²„ì„œë²„}\u0026#34;, \u0026#34;kafka.producer.security.protocol\u0026#34; = \u0026#34;PLAINTEXT\u0026#34; ); ./kafka-topics.sh --create --topic ${í† í”½í† í”½} --bootstrap-server {ì„œë²„ì„œë²„} --config \u0026#34;cleanup.policy=compact\u0026#34; --partitions 4 --replication-factor 2 INSERT INTO TABLE test_export_to_kafka_partition VALUES (1, \u0026#39;1\u0026#39;, CAST(\u0026#39;1\u0026#39; AS BINARY), NULL, -1, -1), (\u0026#34;2\u0026#34;, \u0026#34;2\u0026#34;, CAST(\u0026#39;2\u0026#39; AS binary), -1, -1, -1), (\u0026#34;3\u0026#34;, \u0026#34;3\u0026#34;, CAST(\u0026#39;3\u0026#39; AS binary), -1, -1, -1), (\u0026#34;4\u0026#34;, \u0026#34;4\u0026#34;, CAST(\u0026#39;4\u0026#39; AS binary), -1, -1, -1); CREATE TEMPORARY TABLE test_partition(id INT, value STRING); INSERT INTO TABLE test_partition VALUES (2, \u0026#39;2\u0026#39;), (3, \u0026#39;3\u0026#39;), (4, \u0026#39;4\u0026#39;); INSERT INTO table test_export_to_kafka_partition SELECT id, value, CAST(CAST(id AS string) AS binary) AS `_key`, NULL AS `_partition`, -1, -1 FROM test_partition; ê²°ê³¼í™”ë©´ì€ ì²¨ë¶€í•˜ì§€ ì•Šì•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë‹ˆ ë™ì¼í•œ Keyê°’ì„ ê°€ì§„ê²½ìš°, ë™ì¼í•œ Partitionì— ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nì •ë¦¬ ì´ë²ˆ ê¸€ì„ í†µí•´ Hive Table ë°ì´í„°ë¥¼ Kafkaë¡œ ì „ì†¡ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nì‚¬ì‹¤ ì´ë ‡ê²Œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ”ê²Œ ìœ ì¼í•œ ë°©ë²•ë„ ì•„ë‹ˆê³ , ë‹¤ë¥¸ ì¢‹ì€ ë°©ë²•ë“¤ë„ ì¡´ì¬í•©ë‹ˆë‹¤.\n(ì˜ˆë¥¼ ë“¤ë©´ HiveServer2ì— JDBCë¡œ ì—°ê²°í•  ìˆ˜ë„ ìˆê³ , Sparkë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)\nì„¤ëª…í•œ ë‚´ìš©ë“¤ì„ ì½ìœ¼ì…¨ë‹¤ë©´ ì œì•½ì´ ë§ë‹¤ëŠ” ê²ƒì„ ëŠë¼ì…¨ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê¸°ëŠ¥ ì„¤ëª…ì— ì‘ì„±í•˜ì§„ ì•Šì•˜ì§€ë§Œ, ë‹¨ìˆœíˆ ì „ì†¡í•˜ëŠ” ê²½ìš°ë¼ë©´ ë¬¸ì œì—†ì§€ë§Œ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ JOINí•´ì„œ ë°”ë¡œ ì „ì†¡í•˜ê²Œë” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤ë©´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ ë¬¸ì œë¥¼ íšŒí”¼í•˜ê¸°ìœ„í•´ì„œëŠ” ì„ì‹œ í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ë°ì´í„°ë¥¼ ì €ì¥í•œ ë’¤, ì„ì‹œí…Œì´ë¸”ì„ ì‚¬ìš©í•´ ë°ì´í„° ì „ì†¡í•˜ê²Œë” ì¿¼ë¦¬ ì‘ì„±í•´ì•¼í•©ë‹ˆë‹¤.\nì´ ì™¸ì—ë„ ì œê°€ íŒŒì•…í•˜ì§€ ëª»í•œ ì œì•½ì´ ìˆì„ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\nì´ì²˜ëŸ¼ ë§ì€ ì œì•½ì´ ì¡´ì¬í•˜ì§€ë§Œ, ë³„ë„ë¡œ Applicationì„ ë§Œë“¤ í•„ìš”ê°€ ì—†ë‹¤ëŠ”ê²Œ í° ì¥ì  ì…ë‹ˆë‹¤.\nì´ëŸ¬í•œ ë°©ë²•ë„ ì—¬ëŸ¬ ì„ íƒì§€ì¤‘ í•˜ë‚˜ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ëŠ” ê³„ê¸°ê°€ ë˜ì—ˆìœ¼ë©´ í•©ë‹ˆë‹¤.\nì—¬ê¸°ê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2022-12-01T22:45:04+09:00","permalink":"https://korcasus.github.io/p/hive-kafka-integration3/","title":"Write message to kafka using hive"},{"content":"ê°œìš” ì´ì „ ê¸€ì—ì„œ Kafkaì™€ Hive ì—°ë™ì— ì‚¬ìš©í•˜ëŠ” ì„¤ì •ë“¤ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.\nì´ì œë¶€í„°ëŠ” Kafkaì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ë“¤ì´ê³ , ì“°ëŠ” ì‘ì—…ì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” Kafkaì— ìˆëŠ” ë°ì´í„°ë“¤ì„ ì½ì–´ë“¤ì´ëŠ” ê²ƒë¶€í„° ì§„í–‰í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nHiveë¥¼ Kafka Consumerë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²™ë¦¬ë¼ ìƒê°í•˜ì‹œë©´ ì´í•´í•˜ê¸° ì‰¬ìš°ì‹¤ ê²ë‹ˆë‹¤.\nì°¨ì´ì ì´ ìˆë‹¤ë©´, ì¼ë°˜ Consumerì™€ëŠ” ë‹¤ë¥´ê²Œ Consumer Groupìœ¼ë¡œ ì§€ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nJSON Kafkaë¡œë¶€í„° ì½ì–´ë“¤ì¼ ë°ì´í„°ë“¤ì´ json format ì¼ ê²½ìš°ë¥¼ ê°€ì •í•˜ê³ , ì§„í–‰í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.\nSample data ì•„ë˜ì™€ ê°™ì€ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ì˜ˆì‹œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\ní•„ìš”ì— ë”°ë¼ ë” ë§ì€ í•„ë“œë“¤ì„ ì¶”ê°€í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 { \u0026#34;id\u0026#34;: 12345678, \u0026#34;value:\u0026#34;: \u0026#34;hello\u0026#34; } í…Œì´ë¸” ì •ì˜ json ìŠ¤í‚¤ë§ˆì™€ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. id í•„ë“œëŠ” ì •ìˆ˜ê°’ì„ ê°€ì§€ê³ , value í•„ë“œëŠ” ë¬¸ìì—´ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. Hiveì—ì„œ ì •ìˆ˜ê°’ì€ INT ë˜ëŠ” BIGINT Data Typeìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¬¸ìì—´ì€ STRINGìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤.\nì´ ì •ë³´ë“¤ì„ í† ëŒ€ë¡œ DDLì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 CREATE EXTERNAL TABLE test_export_to_kafka( `id` BIGINT, `value` STRING ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES( \u0026#34;kafka.serde.class\u0026#34; = \u0026#34;org.apache.hadoop.hive.serde2.JsonSerDe\u0026#34;, \u0026#34;kafka.topic\u0026#34; = \u0026#34;etl.hive.catalog.used\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;{brokerì„œë²„}\u0026#34;, \u0026#34;kafka.consumer.security.protocol\u0026#34; = \u0026#34;PLAINTEXT\u0026#34; ); test_export_to_kafkaì€ í…Œì´ë¸”ëª…ìœ¼ë¡œ, ì›í•˜ëŠ”ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní…Œì´ë¸”ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì»¬ëŸ¼ë“¤ì€ ì½ì–´ë“¤ì¼ json êµ¬ì¡°ëŒ€ë¡œ ì‘ì„±í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\nì»¬ëŸ¼ëª…ì€ json keyì™€ ë™ì¼í•˜ê²Œ ì‘ì„±í•˜ê³ , ì»¬ëŸ¼ì˜ íƒ€ì…ì€ json valueì˜ ë°ì´í„° íƒ€ì…ê³¼ ë™ì¼í•˜ê²Œ ë§ì¶°ì£¼ë©´ ë©ë‹ˆë‹¤.\nhive ë°ì´í„° íƒ€ì…ì€ jsonë³´ë‹¤ ë‹¤ì–‘í•˜ë¯€ë¡œ, ë¬¸ì„œë¥¼ ì°¸ê³ í•´ ì ì ˆí•œ íƒ€ì…ì„ ì„ íƒí•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. \u0026quot;kafka.serde.class\u0026quot; = \u0026quot;org.apache.hadoop.hive.serde2.JsonSerDe\u0026quot;ìœ¼ë¡œ ì§€ì •í•´ì¤Œìœ¼ë¡œì„œ, hiveê°€ jsonë°ì´í„°ë¥¼ deserializeí•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nê·¸ ì™¸ì— íŠ¹ë³„íˆ TBLPROPERTIESì—ì„œ ì‚´í´ë´ì•¼í•  ë‚´ìš©ì€ ì—†ìŠµë‹ˆë‹¤.\nkafka.topicë§Œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ kafka topicëª…ìœ¼ë¡œ ë³€ê²½í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\nREAD 1 2 SELECT * FROM test_export_to_kafka ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆë‹¤ë©´, topicì— ë“¤ì–´ìˆëŠ” ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ”ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆë‹¤ë©´ ì—ëŸ¬ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ê±°ë‚˜, ê° ì»¬ëŸ¼ì´ NULLë¡œ ì¶œë ¥ ë  ê²ƒì…ë‹ˆë‹¤.\nì—¬ê¸°ê¹Œì§€ ì„¤ëª…í–ˆë˜ ë‚´ìš©ê³¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•œ ë‚´ìš©ì´ ìˆì§€ì•Šì€ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\nTEXT JSONì²˜ëŸ¼ êµ¬ì¡°í™”ëœ ë°ì´í„°ê°€ ì•„ë‹ˆë¼, PLAIN TEXTë¥¼ ì½ì–´ì˜¤ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.\nSample data PLAIN TEXTë¼, ì˜ˆì œë„ íŠ¹ë³„í•  ê²ƒì€ ì—†ìŠµë‹ˆë‹¤.\në‹¨ìˆœíˆ ìˆ«ìê°’ì„ ì˜ˆì‹œë¡œ ì‚¬ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n1 2 3 1234 5678 91011 í…Œì´ë¸” ì •ì˜ 1 2 3 4 5 6 7 8 9 10 CREATE EXTERNAL TABLE test_export_to_kafka( `id` BIGINT ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES( \u0026#34;kafka.serde.class\u0026#34; = \u0026#34;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\u0026#34;, \u0026#34;kafka.topic\u0026#34; = \u0026#34;etl.hive.catalog.used\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;{ì„œë²„ì„œë²„}\u0026#34;, \u0026#34;kafka.consumer.security.protocol\u0026#34; = \u0026#34;PLAINTEXT\u0026#34; ); ì•ì„œ ì„¤ëª…í–ˆë˜ JSON í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì™€ ìœ ì‚¬í•©ë‹ˆë‹¤.\në‹¤ë¥¸ì ì´ ìˆë‹¤ë©´ Serdeì™€ ì»¬ëŸ¼ì„ ë‹¤ë¥´ê²Œ ì§€ì •í•´ì¤€ ê²ƒì…ë‹ˆë‹¤.\nSerdeì˜ ê²½ìš° \u0026quot;kafka.serde.class\u0026quot; = \u0026quot;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\u0026quot; ë¡œ ë³€ê²½í•˜ë©´ ë©ë‹ˆë‹¤.\nREAD 1 2 SELECT * FROM test_export_to_kafka ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆë‹¤ë©´, topicì— ë“¤ì–´ìˆëŠ” ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ”ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆë‹¤ë©´ ì—ëŸ¬ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ê±°ë‚˜, ê° ì»¬ëŸ¼ì´ NULLë¡œ ì¶œë ¥ ë  ê²ƒì…ë‹ˆë‹¤.\nì—¬ê¸°ê¹Œì§€ ì„¤ëª…í–ˆë˜ ë‚´ìš©ê³¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•œ ë‚´ìš©ì´ ìˆì§€ì•Šì€ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\nKafka Metadata í™œìš© Kafkaì—ëŠ” ë©”ì‹œì§€ì™€ í•¨ê»˜ ë©”íƒ€ ë°ì´í„°ë“¤ì´ í•¨ê»˜ ê¸°ë¡ë©ë‹ˆë‹¤.\ní…Œì´ë¸”ì„ ì •ì˜í• ë•Œ ë©”íƒ€ ë°ì´í„°ë“¤ë„ ìë™ìœ¼ë¡œ ì»¬ëŸ¼ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. Hiveì—ì„œ ë©”ì‹œì§€ë¥¼ ì½ì–´ì˜¬ë•Œ, ë©”íƒ€ ë°ì´í„°ë„ í•¨ê»˜ ê°€ì ¸ì˜¤ê²Œ ë©ë‹ˆë‹¤.\në©”íƒ€ ë°ì´í„°ê°€ ì»¬ëŸ¼ìœ¼ë¡œ ì •ì˜ë˜ë‹¤ë³´ë‹ˆ, SQL ì¡°ê±´ë¬¸ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ë©´ íŠ¹ì • ì‹œê°„ ì´í›„ë¡œ ìœ ì…ëœ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ë˜ê°€, íŠ¹ì • íŒŒí‹°ì…˜ì— ìˆëŠ” ë°ì´í„°ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n__partitionì™€ __offsetì˜ ê²½ìš°ì—ëŠ” ì •ìˆ˜ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ê¸° í¸ë¦¬í•©ë‹ˆë‹¤.\nex1) __partition = 0 ex2) __offset \u0026gt; 5000 í•˜ì§€ë§Œ __timestampì˜ ê²½ìš°ì—ëŠ” unix_timestampë¥¼ ì‚¬ìš©í•˜ê¸°ì— int64ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.\nì´ëŠ” ì¼ìƒì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹œê°„ í‘œê¸°ë°©ì‹ê³¼ ë‹¤ë¥´ê³ , ë³€í™˜ì´ í•„ìš”í•˜ê¸°ì— ì‚¬ìš©í•˜ê¸° ë¶ˆí¸í•©ë‹ˆë‹¤. í¸í•˜ê²Œ ì¡°ê±´ë¬¸ìœ¼ë¡œ í™œìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì²˜ëŸ¼ ë³€ê²½í•´ì„œ ì‚¬ìš©í•˜ëŠ”ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.\nunix_timestampë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš© í•˜ë©´ ë˜ëŠ”ë° ì•„ë˜ ì˜ˆì œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.\nunix_timestamp('2022-03-08 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS') * 1000\nì²«ë²ˆì§¸ ì¸ìëŠ” ë³€í™˜í•˜ê³  ì‹¶ì€ ì‹œê°„ì„ ì‘ì„±í•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ ì¸ìëŠ” ì²«ë²ˆì§¸ ì¸ìì— ì…ë ¥í•œ ì‹œê°„í¬ë§·ì„ ì‘ì„±í•©ë‹ˆë‹¤. í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ì‹œê°„ì„ unix_timestampë¡œ ë³€ê²½ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆê³ , __timestamp ë¹„êµ ì—°ì‚°ì„ í•  ìˆ˜ ìˆê²Œë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ hiveë¡œ í†µí•´ ì½ì–´ë“¤ì¸ __timestampëŠ” ë§ˆì´í¬ë¡œì´ˆ ë‹¨ìœ„ì´ê¸° ë•Œë¬¸ì— ë‹¨ìœ„ë¥¼ ë§ì¶°ì£¼ëŠ” ì¶”ê°€ì—°ì‚°ì´ í•„ìš”í•©ë‹ˆë‹¤.\nì´ë•Œë¬¸ì— 1000ì„ ê³±í•˜ì˜€ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì‚¬ìš© ì˜ˆì œì…ë‹ˆë‹¤.\nex) unix_timestamp('2022-03-08 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS') * 1000 \u0026lt; __timestamp\nì¶”ê°€ ì˜ˆì œ\n1 2 3 4 5 6 7 8 9 -- print to UTC timestamp select FROM_UTC_TIMESTAMP(`__timestamp`, \u0026#39;JST\u0026#39;) from test_kafka_product_received limit 1; -- print timestamp, unixtime to timestamp select current_timestamp(), from_unixtime(unix_timestamp(), \u0026#39;yyyy-MM-dd HH:mm:ss.SSS\u0026#39;); -- print converted unixtime select unix_timestamp(\u0026#39;2022-03-07 14:00:00.000\u0026#39;, \u0026#39;yyyy-MM-dd HH:mm:ss.SSS\u0026#39;); select unix_timestamp(\u0026#39;2022-03-07 06:11:41\u0026#39;, \u0026#39;yyyy-MM-dd HH:mm:ss\u0026#39;); ì •ë¦¬ ì´ë²ˆ ê¸€ì„ í†µí•´ Hiveì—ì„œ Kafkaì— ì €ì¥ëœ JSON ë˜ëŠ” PLAIN-TEXTë¥¼ ì½ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nmetadataë¥¼ í•„í„°ë§ ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤ë©´, Kafkaì— ì›í•˜ëŠ” ì¡°ê±´ì„ ê°€ì§„ ë©”ì‹œì§€ë¥¼ ì†ì‰½ê²Œ ì¶”ì¶œí•´ ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.\nì•„ì‰¬ìš´ ì ìœ¼ë¡œëŠ” Hiveì— ì €ì¥ë˜ì–´ìˆëŠ” ë‹¤ë¥¸ í…Œì´ë¸”ë“¤ê³¼ joinì´ ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. (ì œê°€ ì‹œë„í–ˆì„ë•ŒëŠ” ì¸ì¦ìœ¼ë¡œ ì¸í•œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.)\nì´ ë•Œë¬¸ì— ì‚¬ìš©ìš©ë„ê°€ ë§ì´ ì œì•½ë˜ì—ˆì§€ë§Œ, ê°œì„ ëœë‹¤ë©´ í™œìš©ë„ê°€ ë†’ì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.\në‹¤ìŒ ê¸€ì—ì„œëŠ” Hiveë°ì´í„°ë“¤ì„ Kafkaë¡œ ì „ì†¡í•˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•´ë³´ê² ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2022-12-01T22:45:01+09:00","permalink":"https://korcasus.github.io/p/hive-kafka-integration2/","title":"Read message from kafka using hive"},{"content":"ê°œìš” HiveëŠ” Hadoopì— ì €ì¥ëœ ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ë“¤ì„ SQL ë¬¸ë²•ìœ¼ë¡œ ì½ê³  ì“¸ìˆ˜ìˆê²Œ í•´ì£¼ëŠ” data warehouse softwareì…ë‹ˆë‹¤.\nê°„ë‹¨í•˜ê²Œ Hadoopì—ì„œ ë™ì‘í•˜ëŠ” ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ Databaseë¼ê³  ìƒê°í•´ ë³¼ ìˆ˜ ìˆì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê¸°ë³¸ìœ¼ë¡œ HDFSë¥¼ ì§€ì›í•˜ë©°, Hbase ë˜ëŠ” ê¸°íƒ€ DBMSì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ê°œë°©ì ì¸ DataSourcing ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. Message Queueë¡œ ë§ì´ í™œìš©ë˜ëŠ” Kafkaë„ ì§€ì›í•©ë‹ˆë‹¤. ì´ë²ˆ ì‹œë¦¬ì¦ˆì—ì„œëŠ” Hiveì™€ Kafka ì—°ë™ì„ ìœ„í•œ ì„¤ì •ë¶€í„° Messageë¥¼ ì½ê³  ì“°ëŠ” ê³¼ì •ê¹Œì§€ ê¸°ë¡í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.\nì´ë²ˆ ê¸€ì—ì„œëŠ” ì‚¬ìš©í• ë•Œ í•„ìš”í•œ ì„¤ì •ë“¤ê³¼ ì•Œì•„ì•¼í•˜ëŠ” ì •ë³´ë“¤ì„ ìœ„ì£¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤. ì‚¬ìš© ì˜ˆì‹œê°€ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ë‹¤ìŒ ê¸€ì„ ì½ì–´ì£¼ì„¸ìš”.\nê³µì‹ë¬¸ì„œë¥¼ í† ëŒ€ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\në¬¸ì„œì—ëŠ” ì‘ì„±ë˜ì–´ìˆì§€ì•Šìœ¼ë‚˜, ì‚¬ìš©í•˜ë ¤ë©´ ì¶”ê°€ë¡œ ì•Œì•„ì•¼í•  ë‚´ìš©ê³¼ ì§ì ‘ í…ŒìŠ¤íŠ¸í•œ ì˜ˆì œë“¤ì„ ìƒì„¸íˆ ê¸°ë¡í•˜ê³ ì í•©ë‹ˆë‹¤.\nHive 3.x ë²„ì „ì—ì„œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\nì„¤ì¹˜ ì‚¬ì‹¤ ë³„ë„ì˜ ì„¤ì¹˜ëŠ” í•„ìš”í•˜ì§€ì•ŠìŠµë‹ˆë‹¤.\nê³µì‹ë¬¸ì„œë¥¼ í•œë²ˆ ì‚´í´ë³´ì…¨ë‹¤ë©´ ì•„ì‹œê² ì§€ë§Œ, Hiveì— ì´ë¯¸ ë‚´ì¥ ë˜ì–´ìˆìŠµë‹ˆë‹¤.\nì–´ë–»ê²Œ í•  ì§€ ìƒìƒì´ ì•ˆë ìˆ˜ë„ ìˆì§€ë§Œ, SQLì„ ì‚¬ìš©í•˜ë©´ Kafkaì— ì—°ë™ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní…Œì´ë¸” ìƒì„± Hiveì™€ Kafkaë¥¼ ì—°ë™í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” ì—°ê²°ê³ ë¦¬ë¥¼ ë§Œë“¤ì–´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nSpringì—ì„œëŠ” Binderì™€ Bindingì„ ì‚¬ìš©í•˜ë©´ ì†ì‰½ê²Œ ì—°ê²°ê³ ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë“¯ì´, Hiveì—ì„œëŠ” StorageHandlerë¥¼ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nStorageHandlerëŠ” tableì„ ì •ì˜í•  ë•Œ í•¨ê»˜ ëª…ì‹œí•˜ë©´ ë©ë‹ˆë‹¤. ì´ ì™¸ì—ë„ ì„¤ì •ì„ ì¶”ê°€í•˜ë©´ ì™„ë²½í•˜ê²Œ ì‚¬ìš©í•˜ì‹¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në‹¤ë§Œ Hiveì—ì„œ Kafkaì™€ ì—°ë™ëœ í…Œì´ë¸”ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ëª‡ê°€ì§€ ì£¼ì˜í•´ì•¼í•˜ëŠ” ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.\nì²«ë²ˆì§¸ë¡œëŠ” EXTERNAL í…Œì´ë¸”ë¡œ ìƒì„±í•´ì•¼í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.\nìš°ë¦¬ê°€ ì‚¬ìš©í•  ë°©ì‹ì€ Hiveì—ì„œ Kafkaì— ì ‘ê·¼í•˜ì—¬ ì €ì¥ëœ ë°ì´í„°ë“¤ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, EXTERNAL í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\në‘ë²ˆì§¸ë¡œëŠ” KafkaStorageHandler ë¥¼ ëª…ì‹œí•´ì•¼í•©ë‹ˆë‹¤.\ní…Œì´ë¸”ì„ ì •ì˜í•  ë•Œ STORED BY 'org.apache.hadoop.hive.kafka.KafkaStorageHandler' ê°€ í•¨ê»˜ ì í˜€ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\nì í˜€ ìˆì–´ì•¼ë§Œ Kafkaë¥¼ ì—°ë™í•˜ì—¬ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì„¸ë²ˆì§¸ë¡œëŠ” í…Œì´ë¸”ì„¤ì •ì„ í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nTBLPROPERTIES í‚¤ì›Œë“œ ì‚¬ìš©í•˜ë©´ í…Œì´ë¸”ì— ëŒ€í•œ Propertyë¥¼ ì„¤ì •í•  ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤. ì—¬ê¸°ì— Kafka ì—°ë™ì— í•„ìš”í•œ Configurationì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.\nì„¸ê°€ì§€ë¥¼ ëª¨ë‘ ì ìš©í•˜ì—¬ DDLì„ ì‘ì„±í•´ë³´ë©´, ì•„ë˜ì˜ ì˜ˆì‹œì²˜ëŸ¼ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 CREATE EXTERNAL TABLE kafka_table ( `timestamp` TIMESTAMP, `page` STRING, `newPage` BOOLEAN, `added` INT, `deleted` BIGINT, `delta` DOUBLE ) STORED BY \u0026#39;org.apache.hadoop.hive.kafka.KafkaStorageHandler\u0026#39; TBLPROPERTIES ( \u0026#34;kafka.topic\u0026#34; = \u0026#34;test-topic\u0026#34;, \u0026#34;kafka.bootstrap.servers\u0026#34; = \u0026#34;localhost:9092\u0026#34; ); Kafka metadata Kafkaì— ì €ì¥ëœ MessageëŠ” Payload ì™¸ì—ë„ Key, Partition, Offset, Timestamp 4ê°œì˜ metadataê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ ë°ì´í„°ë“¤ë„ Hiveì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì•ì„œ í…Œì´ë¸”ì„ ì •ì˜í•  ë•Œ ì‚¬ìš©í•˜ì˜€ë˜ KafkaStorageHandlerê°€ ìë™ìœ¼ë¡œ metadataë“¤ì„ ì»¬ëŸ¼ìœ¼ë¡œ ë“±ë¡í•´ ì¤ë‹ˆë‹¤.\n__key (byte array) __partition (int32) __offset (int64) __timestamp (int64) í™œìš©í•˜ëŠ” ë°©ì•ˆì€ ì‹¤ì‚¬ìš© ì˜ˆì œë¥¼ ì‘ì„±í•œ ë‹¤ìŒê¸€ì—ì„œ ìì„¸íˆ ì„¤ëª…ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nAvro í¬ë§· ì‚¬ìš©ì‹œ ì£¼ì˜ì‚¬í•­ ë§Œì•½ Confluent Connectorë¥¼ í†µí•´ Avroí¬ë§·ì„ ì‚¬ìš©í•œë‹¤ë©´, ë©”ì‹œì§€ì—ì„œ 5-bytesë¥¼ ì œê±°í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nì´ 5-bytesì¤‘ 1-byteëŠ” ë§¤ì§ byte, 4-byteëŠ” schema registryì˜ schema idì— í•´ë‹¹ë©ë‹ˆë‹¤.\nì´ëŠ” \u0026quot;avro.serde.type\u0026quot;=\u0026quot;skip\u0026quot; ê·¸ë¦¬ê³  \u0026quot;avro.serde.skip.bytes\u0026quot;=\u0026quot;5\u0026quot;ë¥¼ ì„¤ì •í•´ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\navroë¥¼ ì‚¬ìš©í•  ê²½ìš°, ìƒì„¸í•œ ë‚´ìš©ì€ ê°€ì´ë“œë¥¼ ê¼­ ì°¸ê³ í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\nconfluent avro format ì§€ì›ì€ Hive 4.0ë²„ì „ì— ì¶”ê°€ë  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. 3.x ë²„ì „ì„ ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ì´ë¼ë©´, ì£¼ì˜í•´ì£¼ì‹œë©´ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤. (ì œê°€ ì‚½ì§ˆí–ˆë˜ê±°ë¼ì„œìš”\u0026hellip;)\nSerde(Serializer, Deserializer) Applicationì—ì„œ Kafkaë¡œ ë°ì´í„° ì „ì†¡ì„ í•´ë³¸ ì  ìˆë‹¤ë©´, serializer, deserializerë¥¼ ì§€ì •í•´ë³´ì‹  ê²½í—˜ì´ ìˆìœ¼ì‹¤ ê²ë‹ˆë‹¤.\nHiveì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì—¬ëŸ¬ serializer, deserializerë¥¼ ì œê³µí•˜ê³ ìˆìŠµë‹ˆë‹¤.\nSupported Serializers and Deserializers description org.apache.hadoop.hive.serde2.JsonSerDe JSON í¬ë§· org.apache.hadoop.hive.serde2.OpenCSVSerde CSV í¬ë§· org.apache.hadoop.hive.serde2.avro.AvroSerDe AVRO í¬ë§· org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe binary..? org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe Plain Text ì§€ì •í•˜ëŠ” ë°©ë²•ì€ ìƒê°ë³´ë‹¤ ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤.\nTBLPROPERTIESì— ì¶”ê°€í•˜ë©´ ì†ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ë©´ Kafkaì—ì„œ ì½ì–´ë“¤ì¼ ë°ì´í„°í¬ë§·ì´ JSONì˜ ê²½ìš°ì´ê±°ë‚˜, ì „ì†¡í•  ë°ì´í„°ê°€ JSONìœ¼ë¡œ í•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. \u0026quot;kafka.serde.class\u0026quot; = \u0026quot;org.apache.hadoop.hive.serde2.JsonSerDe\u0026quot;\nì¸ì¦ Kafkaì—ë„ ì¸ì¦ì„ í•´ì•¼ ë°ì´í„° ì½ê³  ì“¸ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì£¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.\nKafka ì‚¬ìš©í•˜ëŠ”ë° í•„ìš”í•œ ì¸ì¦ì •ë³´ë“¤ ë˜í•œ Hiveë¥¼ í†µí•´ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” ë³„ë„ë¡œ ì¸ì¦ì„ ì¶”ê°€í•˜ì§€ ì•Šê³  ì‚¬ìš©í–ˆë‹¤ë³´ë‹ˆ, ì¸ì¦ì—†ì´ ì‚¬ìš©í•œ ê²½ìš°ë¡œ ê¸°ë¡í•˜ê² ìŠµë‹ˆë‹¤.\nì¸ì¦ì„ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ìƒí™©ì´ë¼ë©´, ê³µì‹ ë¬¸ì„œë¥¼ ì½ì–´ë³´ê³  ì§„í–‰í•´ ì£¼ì„¸ìš”.\nì¸ì¦ì„ ìœ„í•œ TBLPROPERTIES ê°’ì„ ì¶”ê°€í•˜ì§€ ì•Šì€ ìƒíƒœë¼ë©´, ì—°ê²°ì„ ì‹œë„í–ˆì„ë•Œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.\në³„ë„ì˜ ì„¤ì •ì„ ì•ˆí•´ë‘ì—ˆë‹¤ë©´, ë‹¹ì—°íˆ ì¸ì¦ì—†ì´ë„ ì‚¬ìš©ê°€ëŠ¥í•´ì•¼ë˜ëŠ”ê±° ì•„ë‹Œê°€? ë¼ê³  ìƒê°í•  ìˆ˜ ìˆì„í…ë°ìš”. (ì œê°€ ê·¸ë¬ìŠµë‹ˆë‹¤.) HiveëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ id, passwordë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„ ì‹œë„í•˜ë ¤ í•©ë‹ˆë‹¤.\në”°ë¼ì„œ ì¸ì¦ì„ ì‚¬ìš©í•˜ì§€ì•ŠëŠ” ì„¤ì •ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œë°ìš”.\nê³µì‹ë¬¸ì„œì— ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ë”°ë¡œ ì œì‹œí•˜ì§€ì•Šì•„ ë§ì´ ì–´ë ¤ì›€ì„ ê²ªì—ˆë˜ ë¶€ë¶„ì´ì—ˆìŠµë‹ˆë‹¤. ê²°ë¡ ë¶€í„° ì´ì•¼ê¸°í•˜ë©´ TBLPROPERTYë¥¼ ì¶”ê°€í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nproducerì¼ ê²½ìš° : \u0026quot;kafka.producer.security.protocol\u0026quot; = \u0026quot;PLAINTEXT\u0026quot; consumerì¼ ê²½ìš° : \u0026quot;kafka.consumer.security.protocol\u0026quot; = \u0026quot;PLAINTEXT\u0026quot; ì¸ì¦ì— ìƒì„¸íˆ ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´, ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì‹œë©´ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.\ní›„ì— ì„œìˆ í•˜ê² ì§€ë§Œ ì„¤ì •í• ë•Œ kafka.ë¥¼ prefixë¡œ ì§€ì •í•´ë‘ë©´, kafkaì— ì„¤ì •ê°’ì´ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nKey Serializer ì•ì„œ ì„¤ëª…ë“œë ¸ë˜ Serializerë“¤ì€ Value Serializer ì˜€ìŠµë‹ˆë‹¤.\nì˜ˆìƒí•˜ë˜ê²ƒë³´ë‹¤ ë§ì´ ì œê³µí–ˆì§€ë§Œ ë°˜ëŒ€ë¡œ Key SerializerëŠ” Byte Serializerë°–ì— ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në‹¤ë¥¸ Serializerë¡œ ë³€ê²½í•´ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ë”ë¼ë„ ë³€ê²½í•  ìˆ˜ ì—†ê²Œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\nì™œ ì´ë ‡ê²Œ êµ¬í˜„í•œì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ, ìì„¸í•œ ë‚´ìš©ì€ ì½”ë“œë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê¶ê¸ˆí•˜ì‹¤ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„, ë§í¬ë„ ì²¨ë¶€í•©ë‹ˆë‹¤.\nproducer consumer ê·¸ì™¸ ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ë‚´ìš©ë“¤ ì´ì™¸ì—ë„ Kafkaë¥¼ ì‚¬ìš©í• ë•Œ, ì¶”ê°€í•˜ê³  ì‹¶ì€ ì„¤ì •ì´ ë” ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê³µì‹ë¬¸ì„œì—ì„œëŠ” ì„¤ëª…í•˜ì§„ ì•Šì§€ë§Œ, Kafkaì— ì‚¬ìš©í•  ì„¤ì •ê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nproducerë¡œ ì‚¬ìš©í•  ê²½ìš° â€œkafka.producer.{property}â€ = â€œ{value}â€ consumerë¡œ ì‚¬ìš©í•  ê²½ìš° â€œkafka.consumer.{property}â€ = â€œ{value}â€ TBLPROPERTIESì— ì¶”ê°€í•´ì£¼ë©´, Kafkaì— ì„¤ì •ê°’ë“¤ì´ ì „ë‹¬ë˜ë©° ì›í•˜ëŠ” ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ì„¤ì •ê°’ì´ ì „ë‹¬ë  ìˆ˜ ìˆëŠ”ì§€, êµ¬í˜„ëœ ì½”ë“œê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ ì•„ë˜ì˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\nproducer consumer ì •ë¦¬ ì—¬ê¸°ê¹Œì§€ Hiveì—ì„œ Kafkaë¥¼ Read, Writeí•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•œ ì„¤ì •ë“¤ê³¼, ë„ì›€ì´ ë˜ëŠ” ì •ë³´ë“¤ì— ëŒ€í•´ ì•Œì•„ ë³´ì•˜ìŠµë‹ˆë‹¤.\në‹¤ìŒ ê¸€ì—ì„œëŠ” Kafkaì— ìˆëŠ” Messageë“¤ì„ Hiveì—ì„œ Readí•˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•´ë³´ê² ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2022-12-01T22:44:01+09:00","permalink":"https://korcasus.github.io/p/hive-kafka-integration1/","title":"Hive Kafka Integration"},{"content":"ë“¤ì–´ê°€ê¸°ì— ì•ì„œ ì•ˆë…•í•˜ì„¸ìš”.\nSynology DS220+ êµ¬ë§¤í•œ ë’¤ë¡œ Bitwarden, WebDAV, \u0026hellip; ë‹¤ì–‘í•œ ìš©ë„ë¡œ ì‚¬ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤.\nì´ì „ê¹Œì§€ëŠ” DuckDNSì™€ í•¨ê»˜ DSM 6.X ì‚¬ìš©ì¤‘ì´ì—ˆìŠµë‹ˆë‹¤ë§Œ, DSM ì—…ë°ì´íŠ¸ ì´í›„ë¡œ ë§Œë“¤ì–´ë‘ì—ˆë˜ ìë™í™” í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‘í•˜ì§€ ì•Šë”ë¼êµ¬ìš”. ì´ë²ˆ ê¸°íšŒì— ê°–ê³ ì‹¶ë˜ Domainì„ CloudFlareì—ì„œ Domain êµ¬ë§¤ë¥¼ í•œ ë’¤, ìƒˆë¡­ê²Œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.\nê³µì‹ ê°€ì´ë“œ ëŒ€ë¡œ ì§„í–‰í–ˆë˜ ê³¼ì •ì„ ìˆœì°¨ì ìœ¼ë¡œ ì •ë¦¬í•˜ë ¤ê³  í•©ë‹ˆë‹¤.\nDomain êµ¬ì…ê³¼ DDNS ì„¤ì •ì— ëŒ€í•œ ë‚´ìš©ì€ ê¸°íšŒê°€ ë˜ë©´ ì‘ì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nì‚¬ìš©í•œ í™˜ê²½ DSM 7.X Synology DS220+ Domain Provider : CloudFlare Let\u0026rsquo;s Encryptë€? HTTPSë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” CA(ì¸ì¦ê¸°ê´€)ì—ì„œ ì œê³µí•˜ëŠ” ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\nì›í•˜ëŠ” ë„ë©”ì¸ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ê³ ì í• ë•Œ, ì—…ì²´ë§ˆë‹¤ ë‹¤ë¥¸ ê°€ê²©ì„ ì§€ë¶ˆí•´ì•¼í•©ë‹ˆë‹¤. Let\u0026rsquo;s EncryptëŠ” ë¹„ì˜ë¦¬ ê¸°ê´€ìœ¼ë¡œì„œ ë¬´ë£Œë¡œ TLSì¸ì¦ì„œë¥¼ ì œê³µí•©ë‹ˆë‹¤.\nì¥ì ì€ ë¬´ë£Œë¡œ ì¸ì¦ì„œë¥¼ ì œê³µë°›ì„ ìˆ˜ ìˆì§€ë§Œ,\në‹¨ì ìœ¼ë¡œëŠ” íƒ€ì—…ì²´ëŠ” ìœ íš¨ê¸°ê°„ì´ 1ë…„ì¸ë° ë¹„í•´ ì§§ì€ 3ê°œì›”ì´ë¼ëŠ” ì ì…ë‹ˆë‹¤.\nacme.sh ëŠ” ë­”ê°€ìš”? Let\u0026rsquo;s EncryptëŠ” ACME í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë„ë©”ì¸ ì†Œìœ ìì¸ì§€ í™•ì¸í•œ ë’¤ì— ì¸ì¦ì„œë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤. ì¸ì¦ì„œ ë°œê¸‰ì„ ìœ„í•´ì„œëŠ” ACME í´ë¼ì´ì–¸íŠ¸ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„ íƒí•´ì•¼í•˜ëŠ”ë°ìš”.\nCertBot ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§€ë§Œ, ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. acme.shëŠ” bashë¥¼ ì‚¬ìš©í•´ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•´ ì¤„ ìˆ˜ ìˆëŠ” ëŒ€ì²´ ì†Œí”„íŠ¸ì›¨ì–´ì…ë‹ˆë‹¤.\në³¸ì¸ì˜ ì„ í˜¸ë„ì— ë”°ë¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìƒì„¸í•œ ë‚´ìš©ì€ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.\nCloudFlare API Token ë°œê¸‰ ì¸ì¦ì„œ ë°œê¸‰ ì ˆì°¨ì— ëŒ€í•´ ì •í™•í•˜ê²Œ ì•Œì§€ëŠ” ëª»í•´ë„, íŒŒì•…í•œ íë¦„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\nì›í•˜ëŠ” Domainì˜ ì¸ì¦ì„œ ë°œê¸‰ ìš”ì²­ (to Let\u0026rsquo;s Encrypt) í•´ë‹¹ Domainì˜ ì†Œìœ ìì„ì„ ì¦ëª…í•˜ê¸° ìœ„í•´ TXT Recordê°’ì„ ì‘ë‹µê°’ìœ¼ë¡œ ë°›ìŒ CloudFlare APIë¥¼ ì‚¬ìš©í•˜ì—¬ TXT Record ê°’ì„ ë“±ë¡ TXT Recordê°’ì„ í™•ì¸í•œ í›„, ì¸ì¦ì„œ ë°œê¸‰ ìœ„ ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” CloudFlare APIë¥¼ ì‚¬ìš©í•˜ê¸°ìœ„í•´ Token ë°œê¸‰ì„ ì§„í–‰í•©ë‹ˆë‹¤.\nGlobal Keyë¡œë„ ì‚¬ìš©ê°€ëŠ¥í•˜ì§€ë§Œ, í•„ìš”ì´ìƒì˜ ê¶Œí•œì„ ê°€ì§€ê³  ìˆê¸°ë•Œë¬¸ì— ì§„í–‰í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤.\ntokenì„ ë°œê¸‰í•˜ê³ ì í•˜ëŠ” Domainì„ ì„ íƒí•˜ë©´, ì•„ë˜ì˜ ê°™ì€ Home í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.\në¹¨ê°„ìƒ‰ í™”ì‚´í‘œë¥¼ í´ë¦­í•©ë‹ˆë‹¤.\nAPI Token ìƒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ì•„ë˜ì˜ ê°™ì€ í˜ì´ì§€ê°€ ë‚˜íƒ€ë‚˜ê²Œë©ë‹ˆë‹¤.\nìš°ë¦¬ëŠ” DNS ê´€ë ¨ëœ ìˆ˜ì • ê¶Œí•œì„ Tokenì„ ë°œí–‰í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—, ë¹¨ê°„ìƒ‰ í™”ì‚´í‘œì˜ ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.\nì•„ë˜ì˜ ì´ë¯¸ì§€ì—ì„œ 1ë²ˆì— ê¶Œí•œì´ í•„ìš”í•œ Domainì„ ì„ íƒí•©ë‹ˆë‹¤.\nê·¸ë’¤ì—ëŠ” 2ë²ˆì„ ì„ íƒí•´ ë°”ë¡œ ìƒì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.\nì •ìƒì ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆë‹¤ë©´, Tokenê°’ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ ê°’ì€ ë”ì´ìƒ ë³¼ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì˜ ê¸°ì–µí•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\nACME ì„¤ì¹˜ ë° ì¸ì¦ì„œ ë°œê¸‰ ì¸ì¦ì„œ ë°œê¸‰ì„ ì§„í–‰í•´ì¤„ Clientë¥¼ ì„¤ì¹˜í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nì•„ë˜ì˜ ëª…ë ¹ì–´ëŒ€ë¡œ ì„¤ì¹˜ë¥¼ ì§„í–‰í•˜ë„ë¡ í•©ë‹ˆë‹¤.\nê³„ì •ì€ rootë¡œ ì§„í–‰í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 $ sudo su $ cd ~ $ wget https://github.com/acmesh-official/acme.sh/archive/master.tar.gz $ tar xvf master.tar.gz $ cd acme.sh-master/ $ ./acme.sh --install --nocron --home /usr/local/share/acme.sh --accountemail \u0026#34;email@gmailcom\u0026#34; $ source ~/.profile ì´ì œ ì¸ì¦ì„œ ìƒì„±ì„ ì§„í–‰í•´ ë³¼í…ë°ìš”.\nì•„ë˜ì˜ í™˜ê²½ ë³€ìˆ˜ë“¤ì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.\n1 2 3 4 # ë°œê¸‰í•´ë‘” API Token export CF_Token=\u0026#34;MY_SECRET_TOKEN_SUCH_SECRET\u0026#34; # CloudFlare Email export CF_Email=\u0026#34;myemail@example.com\u0026#34; ì•„ë˜ì˜ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•´ì„œ ì¸ì¦ì„œë¥¼ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 $ cd /usr/local/share/acme.sh # ì—¬ê¸°ì— ì‚¬ìš©í•  Domainì„ ì§€ì • í•´ì¤ë‹ˆë‹¤. # Ex) *.my-domain.com $ export CERT_DOMAIN=\u0026#34;your-domain.tld\u0026#34; $ export CERT_DNS=\u0026#34;dns_cf\u0026#34; $ /usr/local/share/acme.sh/acme.sh --issue --home . -d \u0026#34;$CERT_DOMAIN\u0026#34; --dns \u0026#34;$CERT_DNS\u0026#34; ìœ„ì˜ ë§ˆì§€ë§‰ ëª…ë ì–´ë¥¼ ì‹¤í–‰í–ˆì„ë•Œ, ì—ëŸ¬ì—†ì´ ë§ˆë¬´ë¦¬ë˜ì—ˆë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ëœ ê²ƒì…ë‹ˆë‹¤.\në§Œì•½ emailì„ updateí•˜ë¼ëŠ” ë¬¸êµ¬ê°€ ì¶œë ¥ëœë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ì§„í–‰í•´ì£¼ì„¸ìš”.\n1 $ /usr/local/share/acme.sh//usr/local/share/acme.sh/acme.sh --register-account -m ì´ë©”ì¼ --issue --home . -d \u0026#39;*.ë„ë©”ì¸\u0026#39; --dns \u0026#34;$CERT_DNS\u0026#34; í˜¹ì—¬ë‚˜ ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´ ëŒ“ê¸€ë¡œ ë¬¸ì˜ì£¼ì„¸ìš”.\nê¸°ë³¸ ì¸ì¦ì„œ êµì²´ ì‹ ê·œë¡œ ìƒì„±í•œ ì¸ì¦ì„œë¥¼ ê¸°ë³¸ ì¸ì¦ì„œë¡œ êµì²´í•´ë³´ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 $ cd /usr/local/share/acme.sh $ export SYNO_Username=\u0026#39;ê´€ë¦¬ì ê³„ì •\u0026#39; $ export SYNO_Password=\u0026#39;ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸\u0026#39; $ export SYNO_Certificate=\u0026#34;ì¸ì¦ì„œ ì„¤ëª…\u0026#34; $ /usr/local/share/acme.sh/acme.sh --deploy --home . -d \u0026#34;$CERT_DOMAIN\u0026#34; --deploy-hook synology_dsm Successê°€ ì¶œë ¥ëœë‹¤ë©´, ì •ìƒì ìœ¼ë¡œ ë§ˆë¬´ë¦¬ëœ ê²ƒì…ë‹ˆë‹¤.\nì‹œë†€ë¡œì§€ ì œì–´íŒ-\u0026gt; ë³´ì•ˆ -\u0026gt; ì¸ì¦ì„œë¡œ ë“¤ì–´ê°€ì„œ ì˜ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë´…ë‹ˆë‹¤.\në˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ DSMì— ì ‘ì†í•œ ë’¤ ìƒˆë¡œê³ ì¹¨í•´ì„œ ì¸ì¦ì„œ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.\në§Œì•½ OTPë¥¼ ì„¤ì •í•´ë‘ì…¨ë‹¤ë©´, ìœ„ ê³¼ì •ì„ ì§„í–‰í•˜ë©´ì„œ SYNO_TOTP_SECRET ê°’ì„ ì„¤ì •í•´ì£¼ë¼ëŠ” ì¶œë ¥ê³¼ í•¨ê»˜ ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì…ë‹ˆë‹¤.\nê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í• ë•Œ, OTP ì¸ì¦ì„ ê±°ì¹˜ê²Œ ì„¤ì •ì„ í•´ë‘ì—ˆê¸°ë•Œë¬¸ì— ë‹¹ì—°í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶œë ¥ëœ ë©”ì‹œì§€ëŒ€ë¡œ ê°’ì„ ì§€ì •í•´ì£¼ëŠ” ê²ƒë„ ë°©ë²•ì´ê² ì§€ë§Œ, ì¤‘ìš”í•œ ì •ë³´ì´ê¸° ë•Œë¬¸ì— ì„ ëœ» ì‘ì„±í•˜ê¸°ì—” ë‚´í‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤. (ê´€ë¦¬ì ëš«ë¦¬ë©´ ì–´ì°¨í”¼ ì†Œìš©ì—†ì§€ë§Œ, ê´œíˆ ê·¸ë ‡ë”ë¼êµ¬ìš”..;;)\nì´ë¥¼ ëŒ€ì²´í•  ìˆ˜ ìˆëŠ” ê°’ì´ ìˆëŠ”ë°, SYNO_DID ì…ë‹ˆë‹¤.\nDeviceIDê°’ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ ê°’ì„ ì–»ê¸°ìœ„í•´ì„œëŠ” DSMì— ë¡œê·¸ì¸ì‹œ Remember this deviceì— ì²´í¬í•œ í›„, ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ Cookieë¡œ ì €ì¥ë©ë‹ˆë‹¤.\nê°œë°œì ëª¨ë“œë¡œ ë“¤ì–´ê°€ì„œ ì´ ê°’ì„ ë³µì‚¬í•œë’¤, í™˜ê²½ë³€ìˆ˜ë¡œ ì§€ì •í•´ ì¤ë‹ˆë‹¤.\nìœ„ì˜ ì„¤ëª…í•œ ë°©ì‹ì€ http í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ localhostì— ì¸ì¦ì„œ êµì²´ ìš”ì²­ì„ í•©ë‹ˆë‹¤.\níŠ¹ë³„íˆ ë¬¸ì œë ê±´ ì—†ì§€ë§Œ, í˜¹~~~~~ì‹œë‚˜ ë¬´ì¡°ê±´ https í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ì•¼í•œë‹¤!!! ë¼ê³  ìƒê°í•˜ì‹œëŠ” ë¶„ì´ ê³„ì‹œë‹¤ë©´\nì•„ë˜ì˜ 2ê°œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì§€ì •í•´ì¤€ë’¤, --insecure argumentë¥¼ ì¶”ê°€í•œë’¤ ì‹¤í–‰í•´ì£¼ë©´ https í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.\n1 2 3 4 # ì•ì„œ ì§€ì •í•œ í™˜ê²½ë³€ìˆ˜ë„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. $ export SYNO_Scheme=\u0026#34;https\u0026#34; $ export SYNO_Port=\u0026#34;5001\u0026#34; $ /usr/local/share/acme.sh/acme.sh --deploy --insecure --home . -d \u0026#34;$CERT_DOMAIN\u0026#34; --deploy-hook synology_dsm ì¸ì¦ì„œ ê°±ì‹  ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • ì¸ì¦ì„œ ìœ íš¨ê¸°ê°„ì´ 3ê°œì›”ì´ê¸° ë•Œë¬¸ì—, 3ê°œì›”ë§ˆë‹¤ ê°±ì‹ ì‘ì—…ì„ í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ ì‘ì—…ì„ ë§¤ë²ˆ ìˆ˜í–‰í•˜ê¸°ì—”\u0026hellip; ë†€ëë„ë¡ ê·€ì°®ìŠµë‹ˆë‹¤.\në§Œë£Œì¼ì— ê°€ê¹Œì›Œì§€ë©´ ê°±ì‹ í•´ì•¼ë˜ëŠ” ì´ˆì¡°í•¨ì€ ë¤ ì…ë‹ˆë‹¤.\nì´ ë²ˆê±°ë¡œìš´ ì¼ì—ì„œ ë²—ì–´ë‚˜ê¸° ìœ„í•´ ìë™í™”ë¥¼ í•˜ê² ìŠµë‹ˆë‹¤.\nì œì–´í•œ -\u0026gt; ì„œë¹„ìŠ¤ -\u0026gt; ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ -\u0026gt; ìƒì„± -\u0026gt; ì˜ˆì•½ëœ ì‘ì—… -\u0026gt; ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì„ íƒí•©ë‹ˆë‹¤.\nì´ë¯¸ì§€ë¡œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ë¹¨ê°„ì› ìˆ«ì ìˆœì„œëŒ€ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.\ní•˜ë‚˜ì˜ íŒì—…ì°½ ë‚˜íƒ€ë‚ í…ë°ìš”.\nì´ë¯¸ì§€ì²˜ëŸ¼ 3ê°€ì§€ ê°’ì„ í™•ì¸í•´ì¤ë‹ˆë‹¤.\nDSM6 ë²„ì „ê¹Œì§€ëŠ” rootë¡œ ì§„í–‰í•´ì•¼ ì¸ì¦ì„œ êµì²´ê°€ ê°€ëŠ¥í–ˆëŠ”ë°ìš”.\n7 ë²„ì „ì—ì„œ ë‹¤ë¥¸ê³„ì •ìœ¼ë¡œ ì‹¤í–‰í•´ë„ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë³´ì§„ ì•Šì•˜ìŠµë‹ˆë‹¤.\në‹¤ìŒìœ¼ë¡œëŠ” ì–¸ì œì‹¤í–‰í• ì§€ ìŠ¤ì¼€ì¤„ì„ ì§€ì •í•  ì°¨ë¡€ì…ë‹ˆë‹¤.\nì´ë¯¸ì§€ì²˜ëŸ¼ ì„¤ì •í•  ê²½ìš° ë§¤ì£¼ í† ìš”ì¼ ì˜¤ì „ 1ì‹œì— ê°±ì‹ ì„ ì‹œë„í•˜ë ¤ê³  í• ê²ë‹ˆë‹¤.\nì„ í˜¸í•˜ëŠ” ìš”ì¼, ì‹œê°„ì„ ì§€ì •í•´ì£¼ì„¸ìš”.\në§¤ë‹¬ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë³€ê²½ ê°€ëŠ¥í•˜ì§€ë§Œ, ê°±ì‹ ì€ ë§Œë£Œ 1ê°œì›” ì „ë¶€í„° ê°€ëŠ¥í•©ë‹ˆë‹¤.\nì²«ë²ˆì§¸ì´ì ë§ˆì§€ë§‰ ê°±ì‹  ì‹œë„í•˜ëŠ” ë‚ ì— ëª¨ì¢…ì˜ ì´ìœ ë¡œ ì‹¤íŒ¨í•  ê²½ìš°, ìœ„ì—ì„œ ì§„í–‰í•˜ì…¨ë˜ê±¸ ë‹¤ì‹œí•´ì£¼ì…”ì•¼í•©ë‹ˆë‹¤.\nê·¸ë˜ì„œ ì•ˆì „í•˜ê²Œ ë§¤ì£¼ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œëŠ” ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.\nì•Œë¦¼ ì„¤ì •í•´ë‘ì‹  ë¶„ì´ë¼ë©´, ì‹¤í–‰ ìƒì„¸ì •ë³´ë¥¼ ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°ë¥¼ ì²´í¬í•´ì£¼ë©´ ì¢‹ìŠµë‹ˆë‹¤.\nì˜ ì‹¤í–‰ë˜ëŠ”ê±¸ ë©”ì¼ ì˜¤ëŠ”ê²ƒìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆì„ í…Œë‹ˆê¹Œìš”.\nì €ì˜ê²½ìš°ì—ëŠ” ë©”ì¼ ëŒ€ì‹ ì— í…”ë ˆê·¸ë¨ìœ¼ë¡œ ë©”ì‹œì§€ ì˜¤ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ì´ì™€ ê´€ë ¨í•´ì„œëŠ” ë”°ë¡œ í¬ìŠ¤íŠ¸ í•˜ê² ìŠµë‹ˆë‹¤.\nì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ë¯¸ì§€ì²˜ëŸ¼ ì¸ì¦ì„œë¥¼ ê°±ì‹ í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.\nê°„ë‹¨í•©ë‹ˆë‹¤. í•œì¤„ì˜ ì»¤ë§¨ë“œë§Œ ì…ë ¥í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\n1 /usr/local/share/acme.sh/acme.sh --cron --home /usr/local/share/acme.sh/ ì´ì œ ì„¤ì • ì™„ë£Œí•˜ì‹œë©´ ì•„ë˜ì˜ ê°™ì€ íŒì—…ì´ ì¶œë ¥ë©ë‹ˆë‹¤.\nì‚¬ë¿íˆ í™•ì¸ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\nì•Œë¦¼ ì™¸ì—ë„ ì‹¤í–‰í•œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ê³  ì‹¶ìœ¼ì‹¤ìˆ˜ ìˆëŠ”ë°ìš”.\nì•„ë˜ ì´ë¯¸ì§€ì²˜ëŸ¼ ë¡œê·¸ ê²½ë¡œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ì˜ê²½ìš°ì— log ë””ë ‰í† ë¦¬ë¡œ ì§€ì •í–ˆìŠµë‹ˆë‹¤.\nì´ì™€ê°™ì´ ì§€ì •í–ˆì„ ê²½ìš° ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸ëŠ” /volume1/log/synoscheduler ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤.\nìš°ë¦¬ê°€ ì‹¤í–‰í•œ ì‘ì—…ì˜ ë¡œê·¸ëŠ” /volume1/log/synoscheduler/${task_number}/${ì‹¤í–‰ì‹œê°„} ê²½ë¡œì—ì„œ í™•ì¸í•˜ì‹¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ntask_numberëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ëª‡ë²ˆì§¸ë¡œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ ì˜ë¯¸í•˜ëŠ” ê°’ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.\noutput.logëŠ” ì‹¤í–‰í•˜ë©° ì¶œë ¥ëœ ê²°ê³¼ì´ê³ , script.logëŠ” ì‹¤í–‰í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì •ë¦¬ ì™œ ì´ë ‡ê²Œ ê¹Œì§€ í•´ì•¼ë˜ë‚˜ ê¶ê¸ˆí•´ í•˜ì‹¤ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\nì§‘ì—ì„œë§Œ ì‚¬ìš©í•˜ë„ë¡ í•˜ì‹ ê²½ìš°ë¼ë©´ ì´ ê³¼ì • ì „í˜€ í•„ìš”ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë‹ˆê¹Œìš”.\ní•˜ì§€ë§Œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì„ í—ˆìš©í•˜ëŠ” ê²½ìš°ë¼ë©´ ì´ì•¼ê¸°ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\nì„¤ì •ì„ í•´ë‘ì‹  ì‹œì  ì´í›„ë¡œ, ìˆ˜ì‹œë¡œ íƒ€êµ­ê°€ì—ì„œ ì ‘ê·¼ì„ ì‹œë„í•©ë‹ˆë‹¤. ë³´ì•ˆ í—ˆì ì„ ì°¾ìœ¼ë ¤ê³  í•˜ëŠ” ê±°ì£ . http í†µì‹ ì€ ë³´ì•ˆìƒ ë¬¸ì œê°€ ìˆê¸° ë•Œë¬¸ì—, ì´ ìƒí™©ì—ì„œ httpë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ë©´\u0026hellip; ë” ì´ì•¼ê¸° ì•ˆí•´ë„ ì•„ì‹¤ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤.\nì´ëŸ¬í•œ ì´ìœ ë¡œ httpsë¥¼ ì‚¬ìš©í•˜ê²Œëœê±°ê³ , ìµœì†Œí•œì˜ ë°©ì–´ìˆ˜ë‹¨ì„ ê°–ì¶˜ ì…ˆì…ë‹ˆë‹¤.\nì—¬íŠ¼ ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ì…¨ë‹¤ë©´, CloudFlareì˜ Domainì— TLSì¸ì¦ì„œ ê¸°ë°˜ì˜ httpsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“œì‹  ê²ë‹ˆë‹¤. ì§„í–‰í•˜ëŠë¼ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.ğŸ‘ğŸ‘\nì €ë„ ì´ë²ˆì— ìƒˆë¡­ê²Œ ì„¤ì •í•˜ë‹¤ë³´ë‹ˆ, ìë™ ê°±ì‹ ì´ ì˜ ë˜ëŠ”ì§€ëŠ” í™•ì¸í•˜ì§„ ëª»í–ˆìŠµë‹ˆë‹¤.\n2ê°œì›” ë’¤ì— ë‚´ìš©ì„ ë³´ì¶© í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n","date":"2022-11-21T22:23:00+09:00","permalink":"https://korcasus.github.io/p/automate-synology-lets-encrypt-certificate/","title":"Automate Synology Let's Encrypt Certificate"},{"content":"Hugo Blog ë§Œë“¤ê¸°-2 ê°œìš” ì§€ë‚œë²ˆ ê¸€ì„ í†µí•´, Hugoë¡œ Blogë¥¼ ë§Œë“¤ì–´ ë³´ì•˜ìŠµë‹ˆë‹¤.\nì´ë²ˆì—ëŠ” ë¸”ë¡œê·¸ ìš´ì˜í•˜ëŠ”ë° ìˆì–´, í•„ìˆ˜ë¼ê³  ìƒê°ë˜ëŠ” ë‚´ìš©ë“¤ì„ ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nCustom ì„¤ì •í•˜ê¸° Stack í…Œë§ˆë¥¼ Git SubModuleë¡œ ë“±ë¡í•˜ì—¬ ë¸”ë¡œê·¸ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\nì‚¬ìš©í•˜ëŠ”ê±´ ì¢‹ì§€ë§Œ ì…ë§›ì— ë§ê²Œ ìˆ˜ì •í•˜ë ¤ë©´ í…Œë§ˆë¥¼ ë³€ê²½í•´ ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì§ì ‘ ìˆ˜ì •í•œë‹¤ë©´ í…Œë§ˆë¥¼ ì—…ë°ì´íŠ¸í• ë•Œë§ˆë‹¤ ì¶©ëŒì´ ë°œìƒí• í…Œê³ , SubModuleë¡œ ë“±ë¡í•œ ì˜ë¯¸ê°€ í‡´ìƒ‰ ë©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë°©ë²•ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nthemes/hugo-theme-stack/layouts/partials/header.html íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ìƒí™©ì„ ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì„ layouts/partials/header.htmlë¡œ ë³µì‚¬í•œë’¤, ì›í•˜ëŠ” ëŒ€ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.\nbuildë¥¼ í•  ê²½ìš° ë³µì‚¬í•´ì˜¨ íŒŒì¼ì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.\nassetê³¼ staticë„ ë™ì¼í•©ë‹ˆë‹¤.\ní…Œë§ˆì— ì‚¬ìš©ëœ ë™ì¼í•œ ë””ìì¸ì˜ ì•„ì´ì½˜ì„ ì¶”ê°€í• ë•Œ ìœ„ì™€ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¢€ ë” ì„¸ì‹¬íˆ ìˆ˜ì •í•´ë³´ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´, ì´ ê¸€ì„ ì°¸ê³ í•˜ì‹œë©´ í° ë„ì›€ì´ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nGoogle ê²€ìƒ‰ ë…¸ì¶œ í•´ë‹¹ ê¸€ì„ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤ êµ¬ê¸€ ê²€ìƒ‰ ê²°ê³¼ì— ë…¸ì¶œë˜ê¸° ìœ„í•´ì„œëŠ”, êµ¬ê¸€ ê²€ìƒ‰ì—”ì§„ì— ìš°ë¦¬ í™ˆí˜ì´ì§€ë„ ê²€ìƒ‰ë˜ê²Œí•´ì¤˜~~ ë¼ê³  ìš”ì²­ì„ í•´ì•¼í•©ë‹ˆë‹¤.\nì´ ì‘ì—…ì€ í™ˆí˜ì´ì§€ ì†Œìœ ìê°€ Google Search Console ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní™ˆí˜ì´ì§€ í˜•íƒœì— ë”°ë¼ ì†Œìœ ìì„ì„ ì¦ëª…í•˜ëŠ” ë°©ë²•ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\nì‹œì‘í•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì•„ë˜ì™€ ê°™ì€ í˜ì´ì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. URL ì ‘ë‘ì–´ì— Github blog ì£¼ì†Œë¥¼ ì‘ì„±í•´ì¤ë‹ˆë‹¤. ë„ë©”ì¸ì„ ë§Œë“¤ì–´ì„œ ìš´ì˜ì¤‘ì´ì‹œë¼ë©´ ë„ë©”ì¸ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.\nURL ì ‘ë‘ì–´ë¡œ ì‹ ì²­í–ˆë‹¤ë©´, í•´ë‹¹ í˜ì´ì§€ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. HTMLíŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬, static ë””ë ‰í† ë¦¬ì— ì¶”ê°€í•´ì¤ë‹ˆë‹¤. buildí•˜ë©´ ìë™ìœ¼ë¡œ public ë””ë ‰í† ë¦¬ì— í¬í•¨ë©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  public ë””ë ‰í† ë¦¬ì— sitemap.xmlì´ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.\në§Œì•½ ì—†ë‹¤ë©´, buildë¥¼ í•œë²ˆ í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\n\u0026lt;ê³„ì •\u0026gt;.github.io/sitemap.xmlë¡œ ì ‘ì†í–ˆì„ë•Œ, ì–´ë–¤ ê²°ê³¼ë“¤ì´ ë‚˜ì˜¨ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ëœ ê²ë‹ˆë‹¤.\nê²€ìƒ‰ ë…¸ì¶œë˜ê¸°ê¹Œì§€ëŠ” ì‹œê°„ì´ ì¢€ ê±¸ë¦¬ë‹ˆ, ëŠê¸‹í•˜ê²Œ ê¸°ë‹¤ë¦°ë’¤ Search Consoleì—ì„œ í™•ì¸í•´ ë´…ì‹œë‹¤.\nGoogle Analytics ì ìš© Github ìœ¼ë¡œ ë¸”ë¡œê·¸ë¥¼ ìš´ì˜í•  ê²½ìš°, í‰ê·  ë°©ë¬¸ì ìˆ˜ê°€ ì–¼ë§ˆì¸ì§€ ê°„ë‹¨í•œ í†µê³„ì¡°ì°¨ë„ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì§€í‘œëŠ” ë¸”ë¡œê·¸ ìš´ì˜í•˜ëŠ”ë° ìˆì–´ ì¬ë¯¸(?)ë¥¼ ëŠë¼ê²Œ í•˜ëŠ”ë° í° ì—­í• ì„ í•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.\nì´ëŸ° ì œì•½ì‚¬í•­ì„ í•´ê²°í•˜ê³ , ë¸”ë¡œê·¸ì— ì ‘ì†í•˜ëŠ” ì‚¬ìš©ìë“¤ì„ ë¶„ì„(?)í•´ë³´ê³  ì‹¶ì–´ Google Analytics ë¥¼ ì ìš©í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\ní•´ë‹¹ ê¸€ì„ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤ ì§„í–‰í•˜ì‹œê¸° ì „ì—, ê´‘ê³ ì°¨ë‹¨ì„ í•´ì œí•´ë‘ì‹œëŠ”ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. (ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ”ë° ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.) Google Analytics ì‹ ì²­ ìƒì„¸í•œ ì‹ ì²­ ê³¼ì •ì„ ì„¤ëª…í•˜ìë‹ˆ, ì´ë¯¸ ì§„í–‰í•´ë²„ë ¤ ë™ì¼í•˜ê²Œ ì„¤ëª…í•˜ê¸´ ì–´ë ¤ìš¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê°œì¸ì •ë³´ë„ í¬í•¨ë˜ì–´ìˆêµ¬ìš”.\nëŒ€ì‹  ì €ë³´ë‹¤ ë” ìƒì„¸íˆ ì‘ì„±í•´ì£¼ì‹  ë¶„ë“¤ë„ ë§ìœ¼ë‹ˆ, ì°¸ê³ í•´ì„œ ì‹ ì²­í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\nì• ë„ë¦¬í‹±ìŠ¤ ê³„ì •, ì†ì„± ë° ì•± ê¹Œì§€ ëª¨ë‘ ì‹ ì²­í•˜ì…¨ë‹¤ë©´ ì‚¬ì „ ì¤€ë¹„ëŠ” ëª¨ë‘ ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.\nì´ì œëŠ” analyticsê°€ ì ìš©ëœ scriptì™€ GA Tracking IDë¥¼ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.\nì• ë„ë¦¬í‹±ìŠ¤ë¥¼ ì ìš©í•  ì†ì„± ë° ì•±ì˜ ë°ì´í„°ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•´ ì¤ë‹ˆë‹¤.\nìƒì„±í•´ì¤€ ë’¤ ì›¹ ìŠ¤íŠ¸ë¦¼ ì„¸ë¶€ì •ë³´ë¥¼ ë“¤ì–´ê°€ë©´ ì•„ë˜ì™€ ê°™ì€ ì´ë¯¸ì§€ë¥¼ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¸¡ì • ID ì•„ë˜ì— ì íŒ ê°’ì´ GA Tracking IDë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.\nscriptëŠ” ë¹¨ê°„ìƒ‰ í™”ì‚´í‘œë¥¼ í´ë¦­í•´ë³´ë©´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní´ë¦­í•´ë³´ë©´ ì•„ë˜ì™€ ì´ë¯¸ì§€ì˜ ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nëª¨ìì´í¬ í•œ ë¶€ë¶„ì´ analyticsë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” scriptì…ë‹ˆë‹¤.\nScriptì™€ GA Tracking ID ì˜ ì €ì¥í•´ì£¼ì„¸ìš”.\nInternal Templateì„ ì‚¬ìš©í•˜ì—¬ Google Analytics í™œì„±í™” Hugo ê³µì‹ Guideì—ì„œëŠ” config.yamlì— ì„¤ì •ë§Œ í•´ì¤€ë‹¤ë©´, ì†ì‰½ê²Œ ì ìš©í• ìˆ˜ ìˆë‹¤ê³  ì•ˆë‚´ í•©ë‹ˆë‹¤. ì„¤ì • í•˜ëŠ”ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 googleAnalytics: G-MEASUREMENT_ID blogì— ë°°í¬í•œ ë’¤ ì‹¤ì‹œê°„ ì ‘ì†ì countingì´ ë˜ëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤. ë’¤ì—ì„œ ì„¤ëª…í•˜ê² ì§€ë§Œ, í™ˆ í™”ë©´ì—ì„œ ì‹¤ì‹œê°„ ì ‘ì†ì ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì˜ ì ìš©ë˜ì—ˆë‹¤ë©´, Script ìˆ˜ë™ ì„¤ì¹˜ëŠ” ì§„í–‰í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.\nScript ìˆ˜ë™ ì„¤ì¹˜ ì‹ ì²­í•˜ë©° ë³µì‚¬í•´ë‘ì—ˆë˜ scriptë¥¼ layoutì— ì¶”ê°€í•˜ì—¬ ì ìš©í•©ë‹ˆë‹¤.\nscriptë¥¼ ë³µì‚¬í•˜ë©° ì˜ ì‚´í´ë³´ì…¨ë‹¤ë©´ ì•„ì‹œê² ì§€ë§Œ head íƒœê·¸ì— ì¶”ê°€í•´ì•¼ëœë‹¤ê³  ì•ˆë‚´í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nì‚¬ìš©ì¤‘ì¸ í…Œë§ˆì˜ head íƒœê·¸ ë¶€ë¶„ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. (stack í…Œë§ˆë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.)\nìš°ì„  ë¸”ë¡œê·¸ë¥¼ êµ¬ì„±í•˜ëŠ” ê°€ì¥ ìƒìœ„(?)ì˜ htmlì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. themes/hugo-theme-stack/layouts/_default/baseof.html ì…ë‹ˆë‹¤.\ní˜„ ê¸°ì¤€ìœ¼ë¡œëŠ” ì•„ë˜ì²˜ëŸ¼ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;{{ .Site.LanguageCode }}\u0026#34; dir=\u0026#34;{{ default `ltr` .Language.LanguageDirection }}\u0026#34;\u0026gt; \u0026lt;head\u0026gt; {{- partial \u0026#34;head/head.html\u0026#34; . -}} {{- block \u0026#34;head\u0026#34; . -}}{{ end }} \u0026lt;/head\u0026gt; \u0026lt;body class=\u0026#34;{{ block `body-class` . }}{{ end }}\u0026#34;\u0026gt; {{- partial \u0026#34;head/colorScheme\u0026#34; . -}} {{/* The container is wider when there\u0026#39;s any activated widget */}} {{- $hasWidget := false -}} {{- range .Site.Params.widgets -}} {{- if gt (len .) 0 -}} {{- $hasWidget = true -}} {{- end -}} {{- end -}} \u0026lt;div class=\u0026#34;container main-container flex on-phone--column {{ if $hasWidget }}extended{{ else }}compact{{ end }}\u0026#34;\u0026gt; {{- block \u0026#34;left-sidebar\u0026#34; . -}} {{ partial \u0026#34;sidebar/left.html\u0026#34; . }} {{- end -}} \u0026lt;main class=\u0026#34;main full-width\u0026#34;\u0026gt; {{- block \u0026#34;main\u0026#34; . }}{{- end }} \u0026lt;/main\u0026gt; {{- block \u0026#34;right-sidebar\u0026#34; . -}}{{ end }} \u0026lt;/div\u0026gt; {{ partial \u0026#34;footer/include.html\u0026#34; . }} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; head íƒœê·¸ ì•ˆì— ì¶”ê°€í•˜ê¸°ìœ„í•´ head/head.htmlë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\nthemes/hugo-theme-stack/layouts/partials/head/head.htmlì„ ë³´ì‹œë©´ ë©ë‹ˆë‹¤.\nì•„ë˜ì²˜ëŸ¼ ë§Œë“¤ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;meta charset=\u0026#39;utf-8\u0026#39;\u0026gt; \u0026lt;meta name=\u0026#39;viewport\u0026#39; content=\u0026#39;width=device-width, initial-scale=1\u0026#39;\u0026gt; {{- $description := partialCached \u0026#34;data/description\u0026#34; . .RelPermalink -}} \u0026lt;meta name=\u0026#39;description\u0026#39; content=\u0026#39;{{ $description }}\u0026#39;\u0026gt; {{- $title := partialCached \u0026#34;data/title\u0026#34; . .RelPermalink -}} \u0026lt;title\u0026gt;{{ $title }}\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#39;canonical\u0026#39; href=\u0026#39;{{ .Permalink }}\u0026#39;\u0026gt; {{- partial \u0026#34;head/style.html\u0026#34; . -}} {{- partial \u0026#34;head/script.html\u0026#34; . -}} {{- partial \u0026#34;head/opengraph/include.html\u0026#34; . -}} {{- range .AlternativeOutputFormats -}} \u0026lt;link rel=\u0026#34;{{ .Rel }}\u0026#34; type=\u0026#34;{{ .MediaType.Type }}\u0026#34; href=\u0026#34;{{ .Permalink | safeURL }}\u0026#34;\u0026gt; {{- end -}} {{ with .Site.Params.favicon }} \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;{{ . }}\u0026#34; /\u0026gt; {{ end }} {{- template \u0026#34;_internal/google_analytics.html\u0026#34; . -}} {{- partial \u0026#34;head/custom.html\u0026#34; . -}} scriptë¥¼ ì¶”ê°€í•´ì•¼ë˜ë‹ˆê¹Œ head/script.htmlì— ì¶”ê°€í•˜ë©´ ì¢‹ì„ê²ƒìœ¼ë¡œ ë³´ì´ë„¤ìš”. ì‹¤ì œë¡œ íŒŒì¼ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. ê²½ë¡œëŠ” themes/hugo-theme-stack/layouts/partials/head/head.html ì…ë‹ˆë‹¤.\nì—´ì–´ë³´ë©´ ì•„ì‹œê² ì§€ë§Œ, ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\në¬´ìŠ¨ ë‚´ìš©ì´ ìˆì—ˆë‹¤ë©´ customí•˜ë©° ë³´ì™„í•´ì£¼ì–´ì•¼ê² ì§€ë§Œ, ë¹„ì–´ìˆìœ¼ë¯€ë¡œ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.\nlaygouts/partials/head/script.htmlì„ ë§Œë“¤ì–´, ë³µì‚¬í•´ë‘” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\nì ìš© í™•ì¸ ì• ë„ë¦¬í‹±ìŠ¤ í™ˆ í™”ë©´ì„ ë“¤ì–´ê°‘ë‹ˆë‹¤.\nì •ìƒ ì ìš©ë˜ì—ˆë‹¤ë©´, ì§€ë‚œ 30ë¶„ ë™ì•ˆì˜ ì‚¬ìš©ìì— counting ë©ë‹ˆë‹¤.\nì •ë¦¬ ì²«ë²ˆì§¸ ê¸€ë¡œ Hugoë¡œ Static Site Generate, í…Œë§ˆì ìš©, ëŒ“ê¸€ ì‹œìŠ¤í…œ ì—°ë™ê¹Œì§€ ì§„í–‰í•´ë³´ì•˜ê³  ì´ë²ˆ ê¸€ì„ í†µí•´ ë¸”ë¡œê·¸ë¥¼ ê³ ë„í™”(Custom ë°©ë²•, êµ¬ê¸€ ê²€ìƒ‰ë…¸ì¶œ, êµ¬ê¸€ analytics) í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\në‹¤ìŒ ê¸€ì€ ì• ë“œì„¼ìŠ¤ì™€ github action ì ìš©ì„ ì£¼ì œë¡œ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2022-11-15T20:23:45+09:00","permalink":"https://korcasus.github.io/p/hugo-blog-customize/","title":"Hugo Blog Customizeí•˜ê¸°"},{"content":"Hugo Blog ë§Œë“¤ê¸°-1 Hugoë€? Goë¡œ êµ¬í˜„ëœ ë¹ ë¥´ê³  í˜„ëŒ€ì ì¸ Static Site Generatorì…ë‹ˆë‹¤.\nVisitor Requestê°€ ë°œìƒí• ë•Œë§ˆë‹¤ ë™ì ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì‹œìŠ¤í…œê³¼ëŠ” ë‹¤ë¥´ê²Œ, Contentë¥¼ ë§Œë“¤ê±°ë‚˜ ì—…ë°ì´íŠ¸í• ë•Œ Buildê°€ ë©ë‹ˆë‹¤. ì‚¬ì „ì— Buildëœ Pageë¥¼ ë³´ì—¬ì£¼ê¸° ë•Œë¬¸ì—, viewerì—ê²Œ ìµœì ì˜ ê²½í—˜ì„ ì œê³µí•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Hostingì—ë„ ì œì•½ì´ ì—†ìœ¼ë©°, CDNì—ë„ ë¬¸ì œì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.\nHugoëŠ” Databaseê°€ í•„ìš”ì—†ê³  Ruby, Python or PHPì™€ ê°™ì€ Expensive Runtimeì— Dependencyê°€ ì—†ìŠµë‹ˆë‹¤.\níŠ¹ì§•ì„ ì •ë¦¬í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\nBuildê°€ ê·¹ë‹¨ì ìœ¼ë¡œ ë¹ ë¥´ë‹¤. (í˜ì´ì§€ë§ˆë‹¤ 1ms ì´í•˜) cross platform ì§€ì› liveReloadì§€ì› ê°•ë ¥í•œ í…Œë§ˆ ì–´ë””ì„œë“  Hostingí•  ìˆ˜ ìˆë‹¤. â€¦ ìƒì„¸í•œ ë‚´ìš©ì€ Hugo ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.\nHugo ì„¤ì¹˜ Macì„ ì£¼ë ¥ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, Mac ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\níƒ€ ìš´ì˜ì²´ì œë¥¼ ì‚¬ìš©í•œë‹¤ë©´, Referenceë¥¼ ì°¸ê³ í•´ì„œ ì„¤ì¹˜ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.\nPrerequisites Git Hugo module Git submodule â€¦ GoLang â‰¥ 1.18 Goë¥¼ ì‚¬ìš©í•˜ë©°, Gitì„ í†µí•´ Submoduleì„ ê´€ë¦¬í•˜ê¸°ë•Œë¬¸ì— ìœ„ì˜ 2ê°œë¥¼ ì‚¬ì „ì— ì„¤ì¹˜í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 # Hombrew Package manager ì‚¬ìš© $ brew install hugo # ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸ $ hugo version hugo v0.104.3+extended darwin/arm64 BuildDate=unknown Apple Siliconì„ ì‚¬ìš©ì¤‘ì´ë¼ë©´, ìœ„ì²˜ëŸ¼ darwin/arm64ë¡œ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸í•´ì¤ë‹ˆë‹¤.\nGithub repository 2ê°œ ìƒì„± User Github Pageë¡œ ì‚¬ìš©í•  Repositoryì™€ Markdownì„ ê¸°ë¡í•  Repositoryë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì…ë‹ˆë‹¤.\n1ê°œì˜ Repositoryë¡œ í†µí•©í•´ë„ ë˜ì§€ë§Œ, ì‘ì„±í•´ë‘” contentë¥¼ ì‰½ê²Œ copyí•´ê°ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‚¬ì „ì— ë°©ì§€í•˜ê¸° ìœ„í•´ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ë ¤ í•©ë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” ì•„ë˜ì˜ 2ê°œì˜ respositoryë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.\ntechnical-blog .github.io (ex. korcasus.github.io) Hugoë¡œ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° Hugoë¥¼ ì‚¬ìš©í•´ì„œ default projectë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.\nìƒì„±ë˜ëŠ” í”„ë¡œì íŠ¸ëŠ” ì•„ë˜ì²˜ëŸ¼ êµ¬ì„±ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 $ hugo new site technical-blog $ tree . â”œâ”€â”€ archetypes â”œâ”€â”€ config.toml â”œâ”€â”€ content â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ public â”œâ”€â”€ static â””â”€â”€ themes ìì„¸í•˜ê²Œ ì•Œì•„ë³´ê³  ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ Referenceë¥¼ í•œë²ˆ ì½ì–´ë³´ëŠ”ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤.\në¸”ë¡œê·¸ì— ì´ìœ ì˜·ì„ ì…í˜€ì¤„ ì°¨ë¡€ì…ë‹ˆë‹¤.\në³¸ì¸ì´ ì§ì ‘ í…Œë§ˆë¥¼ ë§Œë“¤ê²ƒì´ ì•„ë‹ˆë¼ë©´, ê³µê°œëœ í…Œë§ˆë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.\në‹¤ì–‘í•œ í…Œë§ˆê°€ ì¡´ì¬í•˜ë¯€ë¡œ, ë¬¸ì„œì—ì„œ ì°¾ì•„ë³´ê³  ë³¸ì¸ì— ë§ëŠ” í…Œë§ˆë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” Stackì´ ê°€ì¥ ì´ì˜ê³ , ë¬¸ì„œí™”ê°€ ì˜ ë˜ì–´ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.\nê·¸ë˜ì„œ Stackì„ ê¸°ì¤€ìœ¼ë¡œ ë¸”ë¡œê·¸ êµ¬í˜„í•œ ê²ƒì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n1 2 3 4 5 $ cd technical-blog # ë‹¤ë¥¸ í…Œë§ˆì˜ ê²½ìš° # git submodule add https://github.com/${í…Œë§ˆRepository}.git themes/${í…Œë§ˆì´ë¦„} $ git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack ìœ„ì—ì²˜ëŸ¼ Submoduleë¡œ ì¶”ê°€í•´ë‘”ë‹¤ë©´, ì¶”í›„ í…Œë§ˆ ì—…ë°ì´íŠ¸ í•˜ê¸°ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.\nHugoì— Moduleì´ë¼ëŠ” ê²ƒë„ ìˆëŠ”ë°, ì´ ë°©ë²•ìœ¼ë¡œë„ ëŒ€ì²´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê´€ì‹¬ìˆë‹¤ë©´ ì ìš©í•´ë³´ëŠ”ê²ƒë„ ì¢‹ì•„ë³´ì…ë‹ˆë‹¤.\ní…Œë§ˆê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´, í…Œë§ˆì˜ ì„¤ì •íŒŒì¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¸°ë³¸ config fileì„ ë³µì‚¬í•´ì™€ì•¼ í•©ë‹ˆë‹¤.\n${project}/themes/hugo-theme-stack/exampleSite/config.yaml íŒŒì¼ì„ ë³µì‚¬í•´ ${project}/config.yaml ì— ì˜®ê²¨ì¤ë‹ˆë‹¤.\nGithub Pageë¡œ ì‚¬ìš©í•˜ê¸°ìœ„í•´ì„œëŠ” config.yamlì˜ ì¼ë¶€ë¥¼ ë³€ê²½í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\nì•„ë˜ì˜ ì˜ˆì‹œì— ì£¼ì„ì— í•´ë‹¹ë˜ëŠ” ë¶€ë¶„ì„ ë³€ê²½í•´ì£¼ë„ë¡ í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Github pageë¡œ ì‚¬ìš©í•  URLë¡œ ë³€ê²½í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. baseurl: https://korcasus.github.io/ languageCode: en-us theme: hugo-theme-stack paginate: 5 title: Read Write languages: en: languageName: English title: Read Write weight: 1 disqusShortname: hugo-theme-stack ... ì¶”ê°€í•œ í…Œë§ˆê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ project ë””ë ‰í† ë¦¬ì—ì„œ build ë° ì„œë²„ ì‹¤í–‰ì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nì´ë¯¸ ì–´ëŠì •ë„ blogë¥¼ ë§Œë“ ë’¤ì— ì‘ì„±í•˜ëŠ”ê±°ë¼, ì™„ì „ ì•„ë˜ì™€ ë™ì¼í•˜ê²Œ ë‚˜ì˜¤ì§„ ì•Šì§€ë§Œ ë¹„ìŠ·í•˜ê²Œ ì¶œë ¥ë˜ì—ˆë˜ ê²ƒìœ¼ë¡œ ê¸°ì–µí•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 $ hugo server -D Start building sites â€¦ hugo v0.104.3+extended darwin/arm64 BuildDate=unknown | EN -------------------+----- Pages | 41 Paginator pages | 2 Non-page files | 4 Static files | 0 Processed images | 18 Aliases | 18 Sitemaps | 1 Cleaned | 0 Built in 1494 ms Watching for changes in /Users/user/Workspace/technical-blog/{archetypes,assets,content,data,layouts,static,themes} Watching for config changes in /Users/user/Workspace/technical-blog/config.yaml, /Users/user/Workspace/technical-blog/themes/hugo-theme-stack/config.yaml Environment: \u0026#34;development\u0026#34; Serving pages from memory Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender Web Server is available at http://localhost:1313/ (bind address 127.0.0.1) Press Ctrl+C to stop Buildëœ ê²°ê³¼ë¥¼ ë³´ê¸° ìœ„í•´ http://localhost:1313 ìœ¼ë¡œ ì ‘ì†í–ˆì„ë•Œ í˜ì´ì§€ê°€ ë³´ì¸ë‹¤ë©´, ì—¬ê¸°ê¹Œì§€ëŠ” ì˜ ì§„í–‰ë˜ì—ˆë‹¤ê³  íŒë‹¨í•˜ì‹œë©´ ë©ë‹ˆë‹¤.\nGit Repo ì—°ê²° ë° ShellScipt ì‘ì„± Hugoë¡œ ë§Œë“¤ì–´ì§„ Projectë¥¼ ê°œì¸(Privarte) Repositoryì— ë“±ë¡í•˜ê³ , Hugoë¡œ Buildëœ ê²°ê³¼ë¥¼ Github Pageë¡œ ì—°ë™í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.\nê·¸ ë’¤ë¡œëŠ” ë°°í¬ì— ì‚¬ìš©í•˜ê¸° ìœ„í•œ ShellScriptì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\nì•„ë˜ì˜ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•˜ë©´, ì²˜ìŒì— ë§Œë“¤ì–´ë‘” 2ê°œ Repositoryì— ìš©ë„ì— ë§ê²Œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 # í˜„ì¬ ìœ„ì¹˜ í™•ì¸ $ pwd /Users/user/Workspaces/blog # blog -\u0026gt; blog ë ˆí¬ì§€í† ë¦¬ ì—°ê²° # git remote add origin http://github.com/\u0026lt;username\u0026gt;/technical-blog.git $ git remote add origin http://github.com/korcasus/technical-blog.git # blog/public -\u0026gt; \u0026lt;username\u0026gt;.github.io ì—°ê²° # git submodule add -b master http://github.com/\u0026lt;username\u0026gt;/\u0026lt;username\u0026gt;.github.io.git public $ git submodule add -b master http://github.com/korcasus/korcasus.github.io.git public ë°œí–‰í•  Contentsë¥¼ ì‘ì„±ì„ ì™„ë£Œí•œ í›„, Hugoë¡œ Buildí•´ì£¼ëŠ” ê³¼ì •ì´ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.\nBuildëœ ê²°ê³¼ë¬¼ì€ public ë””ë ‰í† ë¦¬ì— ìƒì„±ë©ë‹ˆë‹¤. ì´ë¥¼ Github Pageì— ë°˜ì˜í•´ì£¼ëŠ” ê³¼ì •ì´ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.\në§¤ë²ˆ ë”°ë¡œ ìˆ˜í–‰í•˜ê¸°ë³´ë‹¤ëŠ” ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë§Œë“¤ì–´ ì‹¤í–‰í•˜ëŠ”ê²ƒì´ ìš´ì˜í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.\nì €ì˜ ê²½ìš°ì—ëŠ” ì•„ë˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´, ë°°í¬ë¥¼ í•©ë‹ˆë‹¤. (Reference)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #!/bin/bash echo -e \u0026#34;\\033[0;32mDeploying updates to GitHub...\\033[0m\u0026#34; # Build the project. # hugo -t \u0026lt;ì—¬ëŸ¬ë¶„ì˜ í…Œë§ˆ\u0026gt; hugo -t hugo-tranquilpeak-theme # Go To Public folder, sub module commit cd public # Add changes to git. git add . # Commit changes. msg=\u0026#34;rebuilding site `date`\u0026#34; if [ $# -eq 1 ] then msg=\u0026#34;$1\u0026#34; fi git commit -m \u0026#34;$msg\u0026#34; # Push source and build repos. git push origin master # Come Back up to the Project Root cd .. # blog ì €ì¥ì†Œ Commit \u0026amp; Push git add . msg=\u0026#34;rebuilding site `date`\u0026#34; if [ $# -eq 1 ] then msg=\u0026#34;$1\u0026#34; fi git commit -m \u0026#34;$msg\u0026#34; git push origin master 1 2 3 4 5 # deploy.sh ì‹¤í–‰ íŒŒì¼ ê¶Œí•œ ë¶€ì—¬ $ chmod 777 deploy.sh # ë°°í¬ ì‹¤í–‰ $ ./deploy.sh Post ì‘ì„± ë°œí–‰í•  ê¸€ì„ ì‘ì„±í• ë•Œ ì•„ë˜ì²˜ëŸ¼ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ Hugoì—ì„œ Markdownì„ ìƒì„±í•´ì¤ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 $ cd $project # hugo new ${contentë‚´ directory}/${ì‚¬ìš©í•  íŒŒì¼ëª…}.md $ hugo new post/hugo-blog-2/index.md Content \u0026#34;/Users/user/Workspace/technical-blog/content/post/hugo-blog-2/index.md\u0026#34; created $ cat content/post/hugo-blog-2/index.md --- title: \u0026#34;Hugo Blog 2\u0026#34; date: 2022-11-14T23:58:09+09:00 draft: true --- ì£¼ì˜í•´ì•¼í•  ì ì´ 2ê°€ì§€ ìˆìŠµë‹ˆë‹¤.\ncontent directoryë‚´ì— ìƒì„±ëœë‹¤ëŠ” ì ì…ë‹ˆë‹¤. í™•ì¥ìë¥¼ mdë¡œ í•´ì•¼í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ëŠ” ìƒì„±ë˜ëŠ” ê²½ë¡œë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê¸° ìœ„í•´ ì£¼ì˜í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\në‘ë²ˆì§¸ëŠ” í™•ì¥ìë¥¼ mdë¡œ í•˜ì§€ì•Šì„ ê²½ìš°, ëª…ë ¹ì–´ë¡œ postìƒì„±í• ë•Œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.\nHugoì—ì„œ archetypes ë””ë ‰í† ë¦¬ë¥¼ í¬í•¨í•˜ê³ ìˆëŠ”ë°, default.md íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\nëª…ë ¹ì–´ë¥¼ í†µí•´ í™•ì¥ì mdíŒŒì¼ì„ ë§Œë“¤ë•Œ, ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì—¬ê¸°ì— í¬í•¨ë˜ì§€ì•Šì€ í™•ì¥ì íŒŒì¼ì„ ë§Œë“¤ê²½ìš°, ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•  íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ì•Šìœ¼ë¯€ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. default.md íŒŒì¼ì„ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n1 2 3 4 5 --- title: \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date: {{ .Date }} draft: true --- Utterences(Github ëŒ“ê¸€ ìœ„ì ¯) ì—°ë™ Stack í…Œë§ˆì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ëŒ“ê¸€ ì‹œìŠ¤í…œë“¤ì„ ì§€ì›í•©ë‹ˆë‹¤. (ì°¸ê³ )\nCactus Cusdis Disqus DisqusJS Giscus Gitalk Remark42 Twikoo utterances Vssue Waline ì´ ì¤‘ì— OpenSourceì´ê³ , githubê³¼ ì—°ë™í•˜ì—¬ ì‰½ê²Œ ì‚¬ìš©ê°€ëŠ¥í•œ Utterencesë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\nì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë³„ë„ì˜ Repositoryê°€ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì‚¬ìš©í•œ Repoì´ë¦„ì€ blog-comments ì…ë‹ˆë‹¤.\nì²¨ë¶€í•œ GIFëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ìŠì§€ë§ê³  utterances appì—°ë™ ì§„í–‰í•´ì£¼ì„¸ìš”!\nBlog Postì™€ Issue Mapping ë°©ì‹ì„ ë‹¤ë¥´ê²Œ í•˜ê³ ì‹¶ë‹¤ë©´, ì„ í˜¸í•˜ì‹œëŠ” ê²ƒìœ¼ë¡œ ì„ íƒí•˜ì‹œë©´ ë©ë‹ˆë‹¤. ë§Œë“¤ì–´ì§„ Scriptë¥¼ í…Œë§ˆì— ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nblog/themes/${í…Œë§ˆ}/layouts/partials/comments/provider ê²½ë¡œì— ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ëŒ“ê¸€ ì‹œìŠ¤í…œì— ì§ì ‘ ìˆ˜ì •ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ëŠ” ì¶”í›„ í…Œë§ˆ ì—…ë°ì´íŠ¸ í•˜ëŠ”ë° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì œì™¸í•©ë‹ˆë‹¤.\ní…Œë§ˆì—ì„œ ì œê³µí•˜ëŠ” config.yamlë¥¼ ìˆ˜ì •í•´ì„œ ëŒ“ê¸€ ì‹œìŠ¤í…œì— ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.\ní”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•´ë‘” config.yamlì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ commentsë¥¼ ì‚¬ìš©í• ê±´ì§€, ì‚¬ìš©í•  providerë¥¼ ì§€ì •í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 params: comments: enabled: true provider: disqus disqusjs: shortname: apiUrl: apiKey: admin: adminLabel: utterances: repo: issueTerm: pathname label: ì¶”ì¶œí•œ Scriptë¥¼ ì ìš©í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ ë©ë‹ˆë‹¤.\në§Œì•½ Issue Mappingì„ ì„¤ëª…í•œ ë°©ë²•ê³¼ ë‹¤ë¥´ê²Œ í•˜ì…¨ë‹¤ë©´ blog/themes/${í…Œë§ˆ}/layouts/partials/comments/provider/utterances.html ë¥¼ í™•ì¸í•´ì„œ Scriptì— ë§ê²Œë” ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n1 2 3 4 5 6 7 params: comments: enabled: true provider: utterances utterances: repo: Korcasus/blog-comments issueTerm: title ì •ìƒì ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ ê²Œì‹œê¸€ í•˜ë‹¨ì— ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€ë˜ì–´ìˆëŠ”ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nëŒ“ê¸€ì´ ì˜ ì‘ì„±ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\në¡œê·¸ì¸í›„ í…ŒìŠ¤íŠ¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\nì‘ì„±ëœ ëŒ“ê¸€ì´ Github Issueë¡œ ì˜ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì •ë¦¬ ì—¬ê¸°ê¹Œì§€ Hugoë¡œ Static Site Generate, í…Œë§ˆì ìš©, ëŒ“ê¸€ ì‹œìŠ¤í…œ ì—°ë™ê¹Œì§€ ì§„í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\në‹¤ìŒì—ëŠ” ë§Œë“  ë¸”ë¡œê·¸ë¥¼ ê³ ë„í™”(Custom ë°©ë²•, êµ¬ê¸€ ê²€ìƒ‰ë…¸ì¶œ, êµ¬ê¸€ analytics) í•´ë³´ê² ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2022-11-14T23:11:35+09:00","permalink":"https://korcasus.github.io/p/hugo-blog-%EB%A7%8C%EB%93%A4%EA%B8%B0-1/","title":"Hugo Blog ë§Œë“¤ê¸°-1"}]